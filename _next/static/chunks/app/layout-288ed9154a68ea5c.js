(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{89584:function(e,t,n){Promise.resolve().then(n.bind(n,66563))},66563:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var o=n(14623);n(2778);var r=n(69064),a=n(43860);function i(e){let{children:t}=e;return(0,o.jsxs)("html",{lang:"en",className:"h-full",children:[(0,o.jsxs)("head",{children:[(0,o.jsx)("title",{children:"Kai Admin - AI Voice Agent Management"}),(0,o.jsx)("meta",{name:"description",content:"Manage your AI voice agents with Kai - the intelligent voice agent platform"}),(0,o.jsx)("meta",{name:"keywords",content:"AI, voice agent, automation, sales, customer support"}),(0,o.jsx)("meta",{name:"author",content:"KarmaLoop AI"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,o.jsx)("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),(0,o.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),(0,o.jsx)("script",{src:"/spa-redirect.js",async:!0})]}),(0,o.jsxs)("body",{className:"h-full",children:[(0,o.jsx)(a.w,{children:t}),(0,o.jsx)(r.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff",fontFamily:"Lato, sans-serif",fontWeight:"300"},success:{style:{background:"#22c55e"}},error:{style:{background:"#ef4444"}}}})]})]})}},5526:function(e,t,n){"use strict";n.d(t,{LU:function(){return l},OQ:function(){return a},k_:function(){return i},lj:function(){return u},un:function(){return s},xG:function(){return c}});var o=n(57557);let r="https://ixeqedgrusamxwsvwoho.supabase.co",a=(0,o.eI)(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),i=async function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=null===(t=(await a.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,i={headers:{"Content-Type":"application/json",...o&&{Authorization:"Bearer ".concat(o)}}},s=await fetch("".concat(r,"/functions/v1/").concat(e),{...i,...n,headers:{...i.headers,...n.headers}});if(!s.ok)throw Error(await s.text());return s.json()},s=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),c=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),u=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,n){"use strict";n.d(t,{q:function(){return c},w:function(){return u}});var o=n(14623),r=n(2265),a=n(5526);let i={user:null,profile:null,organization:null,subscription:null,agents:[],contacts:[],loading:!1,initialized:!1,error:null};function s(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,error:null};case"RESET_STATE":return{...i,initialized:!0};case"UPDATE_AGENTS":return{...e,agents:t.agents};case"UPDATE_CONTACTS":return{...e,contacts:t.contacts};case"SET_ERROR":return{...e,error:t.error,loading:!1};default:return e}}let l=(0,r.createContext)(void 0);function c(){let e=(0,r.useContext)(l);if(!e)throw Error("useApp must be used within AppProvider");return e}function u(e){let{children:t}=e,[n,c]=(0,r.useReducer)(s,i),u=(0,r.useRef)(null),d=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(u.current)return console.log("\uD83D\uDD04 fetchUserData already in progress, waiting..."),u.current;let t=(async()=>{try{e||c({type:"SET_LOADING",loading:!0}),console.log("\uD83D\uDD04 Starting fetchUserData...",{skipLoading:e}),e&&await new Promise(e=>setTimeout(e,500));let{data:{user:t},error:n}=await a.OQ.auth.getUser();if(n||!t){console.log("\uD83D\uDC64 No user found:",(null==n?void 0:n.message)||"No user"),c({type:"RESET_STATE"});return}console.log("\uD83D\uDC64 User found, fetching profile...",t.id);let{data:o,error:r}=await a.OQ.from("user_profiles").select("*").eq("id",t.id).single();if(r||!o){console.log("⚠️ No profile found:",(null==r?void 0:r.message)||"No profile data"),c({type:"AUTH_SUCCESS",payload:{user:t}});return}console.log("\uD83D\uDC64 Profile found:",o.first_name,o.last_name);let i=null,s=null,l=[];if(null==o?void 0:o.organization_id){console.log("\uD83C\uDFE2 Fetching organization data...");let[e,t,n]=await Promise.allSettled([a.OQ.from("organizations").select("*").eq("id",o.organization_id).single(),a.OQ.from("subscriptions").select("*").eq("organization_id",o.organization_id).single(),a.OQ.from("agents").select("*").eq("organization_id",o.organization_id).order("created_at",{ascending:!1})]);i="fulfilled"===e.status?e.value.data:null,s="fulfilled"===t.status?t.value.data:null,l="fulfilled"===n.status&&n.value.data||[],console.log("✅ Organization data fetched:",{organization:!!i,subscription:!!s,agentsCount:l.length})}c({type:"AUTH_SUCCESS",payload:{user:t,profile:o,organization:i,subscription:s,agents:l}}),console.log("✅ fetchUserData completed successfully")}catch(e){var t,n;console.error("❌ Error fetching user data:",e),(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("auth"))||(null==e?void 0:null===(n=e.message)||void 0===n?void 0:n.includes("JWT"))?(console.log("\uD83D\uDD10 Auth error detected, resetting state"),c({type:"RESET_STATE"})):c({type:"SET_ERROR",error:"Failed to load user data"})}finally{u.current=null}})();return u.current=t,t},g=async()=>{try{var e;if(!n.user||!(null===(e=n.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch agents: missing user or organization");return}console.log("\uD83E\uDD16 Fetching agents...");let{data:t,error:o}=await a.OQ.from("agents").select("*").eq("organization_id",n.profile.organization_id).order("created_at",{ascending:!1});if(o)throw o;c({type:"UPDATE_AGENTS",agents:t||[]}),console.log("✅ Agents fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching agents:",e)}},f=async()=>{try{var e;if(!n.user||!(null===(e=n.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch contacts: missing user or organization");return}console.log("\uD83D\uDC65 Fetching contacts...");let{data:t,error:o}=await a.OQ.from("contacts").select("*").eq("organization_id",n.profile.organization_id).order("created_at",{ascending:!1});if(o)throw o;c({type:"UPDATE_CONTACTS",contacts:t||[]}),console.log("✅ Contacts fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching contacts:",e)}},h=async()=>{try{console.log("\uD83D\uDEAA Logging out..."),await a.OQ.auth.signOut(),c({type:"RESET_STATE"}),sessionStorage.removeItem("redirect-path"),console.log("✅ Logout complete")}catch(e){console.error("❌ Error during logout:",e)}};return(0,r.useEffect)(()=>{let e=!0;(async()=>{console.log("\uD83D\uDE80 Initializing app..."),console.log("\uD83D\uDD0D Checking for session...");let{data:{session:t}}=await a.OQ.auth.getSession();(null==t?void 0:t.user)?(console.log("✅ Found existing session, fetching user data..."),await d(!0)):(console.log("\uD83D\uDD10 No session found"),c({type:"RESET_STATE"})),e&&c({type:"SET_INITIALIZED",initialized:!0})})();let{data:{subscription:t}}=a.OQ.auth.onAuthStateChange(async(t,n)=>{console.log("\uD83D\uDD10 Auth state change:",{event:t,hasUser:!!(null==n?void 0:n.user)}),e&&("SIGNED_IN"===t&&(null==n?void 0:n.user)?(console.log("\uD83D\uDD04 Auth SIGNED_IN - fetching user data..."),setTimeout(async()=>{e&&await d()},200)):"SIGNED_OUT"===t?(console.log("\uD83D\uDD04 Auth SIGNED_OUT - resetting state"),c({type:"RESET_STATE"})):"INITIAL_SESSION"===t&&console.log("\uD83D\uDD04 Auth event ignored:",t))});return()=>{e=!1,t.unsubscribe()}},[]),(0,r.useEffect)(()=>{if(!n.loading)return;let e=setTimeout(()=>{n.loading&&(console.warn("\uD83D\uDED1 Emergency loader timeout - clearing localStorage and reloading..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/auth")},3e4);return()=>clearTimeout(e)},[n.loading]),(0,o.jsx)(l.Provider,{value:{state:n,dispatch:c,actions:{fetchUserData:d,fetchAgents:g,fetchContacts:f,logout:h}},children:t})}},2778:function(){}},function(e){e.O(0,[461,216,744],function(){return e(e.s=89584)}),_N_E=e.O()}]);