(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{39706:function(e,t,n){Promise.resolve().then(n.bind(n,66563))},66563:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(14623);n(2778);var i=n(69064),a=n(43860);function o(e){let{children:t}=e;return(0,r.jsxs)("html",{lang:"en",className:"h-full",children:[(0,r.jsxs)("head",{children:[(0,r.jsx)("title",{children:"Kai Admin - AI Voice Agent Management"}),(0,r.jsx)("meta",{name:"description",content:"Manage your AI voice agents with Kai - the intelligent voice agent platform"}),(0,r.jsx)("meta",{name:"keywords",content:"AI, voice agent, automation, sales, customer support"}),(0,r.jsx)("meta",{name:"author",content:"KarmaLoop AI"}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),(0,r.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),(0,r.jsx)("script",{src:"/spa-redirect.js",async:!0})]}),(0,r.jsxs)("body",{className:"h-full",children:[(0,r.jsx)(a.w,{children:t}),(0,r.jsx)(i.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff",fontFamily:"Lato, sans-serif",fontWeight:"300"},success:{style:{background:"#22c55e"}},error:{style:{background:"#ef4444"}}}})]})]})}},5526:function(e,t,n){"use strict";n.d(t,{LU:function(){return c},OQ:function(){return a},k_:function(){return o},lj:function(){return u},un:function(){return s},xG:function(){return l}});var r=n(57557);let i="https://ixeqedgrusamxwsvwoho.supabase.co",a=(0,r.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),o=async function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null===(t=(await a.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,o={headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)}}},s=await fetch("".concat(i,"/functions/v1/").concat(e),{...o,...n,headers:{...o.headers,...n.headers}});if(!s.ok)throw Error(await s.text());return s.json()},s=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},c=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),l=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),u=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,n){"use strict";n.d(t,{q:function(){return u},w:function(){return d}});var r=n(14623),i=n(2265),a=n(5526),o=n(69064);let s={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function c(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...s,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0};default:return e}}let l=(0,i.createContext)(void 0);function u(){let e=(0,i.useContext)(l);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function d(e){var t;let{children:n}=e,[u,d]=(0,i.useReducer)(c,s),g=async()=>{try{console.log("\uD83D\uDD04 Starting fetchUserData..."),d({type:"SET_LOADING",loading:!0});let{data:{user:e},error:t}=await a.OQ.auth.getUser();if(t||!e){console.log("\uD83D\uDC64 No user found or error:",t),d({type:"RESET_STATE"});return}console.log("✅ User found:",e.email);let{data:n,error:r}=await a.OQ.from("user_profiles").select("*").eq("id",e.id).single();if(r){console.error("❌ Error fetching profile:",r),d({type:"AUTH_SUCCESS",payload:{user:e}});return}let i=null,o=null,s=[];if(null==n?void 0:n.organization_id){let{data:e}=await a.OQ.from("organizations").select("*").eq("id",n.organization_id).single();i=e;let{data:t}=await a.OQ.from("subscriptions").select("*").eq("organization_id",n.organization_id).single();o=t;let{data:r}=await a.OQ.from("agents").select("*").eq("organization_id",n.organization_id).order("created_at",{ascending:!1});s=r||[]}d({type:"AUTH_SUCCESS",payload:{user:e,profile:n,organization:i,subscription:o,agents:s}}),console.log("✅ fetchUserData completed")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),d({type:"SET_LOADING",loading:!1})}},f=(0,i.useMemo)(()=>({setLoading:e=>d({type:"SET_LOADING",loading:e}),setNavigating:e=>d({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:g,fetchAgents:async()=>{try{var e;if(!(null===(e=u.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:n}=await a.OQ.from("agents").select("*").eq("organization_id",u.profile.organization_id).order("created_at",{ascending:!1});if(n)throw n;return d({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),d({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=u.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await a.OQ.from("contacts").select("*").eq("organization_id",u.profile.organization_id).order("created_at",{ascending:!1});d({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),d({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{await a.OQ.auth.signOut(),d({type:"RESET_STATE"})}}),[null===(t=u.profile)||void 0===t?void 0:t.organization_id,d]);return(0,i.useEffect)(()=>{let e=async()=>{console.log("\uD83D\uDE80 Initializing app...");let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),n=e.get("error_description");t?(o.ZP.success("Email verified successfully! Welcome to Kai Agent."),window.history.replaceState({},document.title,window.location.pathname)):n&&(o.ZP.error("Authentication error: ".concat(n)),window.history.replaceState({},document.title,window.location.pathname));let{data:{session:r}}=await a.OQ.auth.getSession();(null==r?void 0:r.user)?await g():d({type:"RESET_STATE"}),d({type:"SET_INITIALIZED",initialized:!0})};u.initialized||e();let{data:{subscription:t}}=a.OQ.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(d({type:"SET_NAVIGATING",isNavigating:!0}),await g(),d({type:"SET_NAVIGATING",isNavigating:!1})):"SIGNED_OUT"===e&&d({type:"RESET_STATE"})});return()=>t.unsubscribe()},[u.initialized]),(0,r.jsx)(l.Provider,{value:{state:u,dispatch:d,actions:f},children:n})}},2778:function(){}},function(e){e.O(0,[461,216,744],function(){return e(e.s=39706)}),_N_E=e.O()}]);