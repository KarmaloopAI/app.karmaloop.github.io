(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{81058:function(e,t,s){Promise.resolve().then(s.bind(s,87694))},87694:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var a=s(14623),i=s(2265),n=s(43860),r=s(60429),c=s(5095),l=s(22252),o=s(65302),d=s(45131),u=s(99397),x=s(82222),m=s(12194),h=s(70525),p=s(13041),g=s(95805),N=s(89227),j=s(33276),f=s(98728),b=s(17684),v=s(2207),y=s(5526),_=s(69064);function w(e){let{onNavigate:t}=e,{state:s,actions:w,dispatch:S}=(0,n.q)(),{profile:E,agents:T}=s,[A,I]=(0,i.useState)(!1),[C,D]=(0,i.useState)(null),[k,z]=(0,i.useState)(!1);(0,i.useEffect)(()=>{O()},[E]);let O=async()=>{if(null==E?void 0:E.organization_id)try{I(!0);let{data:e}=await y.OQ.from("agents").select("*").eq("organization_id",E.organization_id).order("created_at",{ascending:!1});S({type:"SET_AGENTS",agents:e||[]})}catch(e){console.error("Error fetching agents:",e),_.ZP.error("Failed to load agents")}finally{I(!1)}},Z=async e=>{try{let t=!e.is_active,{error:s}=await y.OQ.from("agents").update({is_active:t}).eq("id",e.id);if(s)throw s;await O(),_.ZP.success("Agent ".concat(t?"activated":"deactivated"))}catch(e){console.error("Error toggling agent status:",e),_.ZP.error("Failed to update agent status")}},G=e=>{navigator.clipboard.writeText(e),_.ZP.success("Phone number copied to clipboard")},U=e=>e.phone_number?e.is_active?(0,a.jsx)(o.Z,{className:"w-5 h-5 text-success-500"}):(0,a.jsx)(d.Z,{className:"w-5 h-5 text-neutral-400"}):(0,a.jsx)(l.Z,{className:"w-5 h-5 text-warning-500"}),P=e=>e.phone_number?e.is_active?"Active":"Inactive":"No Phone Number",Q=e=>0===e.total_calls?0:Math.round(e.successful_calls/e.total_calls*100),R=e=>({Savannah:"Sandra (Savannah)",Elliot:"Jackson (Elliot)"})[e]||e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Voice Agents"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your AI voice agents and monitor their performance"})]}),(0,a.jsxs)("button",{onClick:()=>t("/dashboard"),className:"btn-primary flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Create New Agent"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Total Agents"}),(0,a.jsx)("p",{className:"kpi-value",children:T.length})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(x.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Active Agents"}),(0,a.jsx)("p",{className:"kpi-value",children:T.filter(e=>e.is_active&&e.phone_number).length})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(o.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Total Calls"}),(0,a.jsx)("p",{className:"kpi-value",children:T.reduce((e,t)=>e+t.total_calls,0)})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(m.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Success Rate"}),(0,a.jsxs)("p",{className:"kpi-value",children:[T.length>0&&Math.round(T.reduce((e,t)=>e+t.successful_calls,0)/T.reduce((e,t)=>e+t.total_calls,0)*100)||0,"%"]})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 text-white"})})]})})]}),(0,a.jsx)("div",{className:"space-y-4",children:A?(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Loading agents..."})]}):T.length>0?T.map((e,t)=>(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card hover:shadow-lg transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"w-6 h-6 text-primary-700"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-neutral-900",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[U(e),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(e.phone_number?e.is_active?"text-success-600":"text-neutral-400":"text-warning-600"),children:P(e)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-neutral-400"}),e.phone_number?(0,a.jsx)("button",{onClick:()=>G(e.phone_number),className:"text-sm text-neutral-600 hover:text-primary-600 transition-colors",title:"Click to copy",children:(0,y.un)(e.phone_number)}):(0,a.jsx)("span",{className:"text-sm text-neutral-400",children:"No phone number"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:R(e.voice_id)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsxs)("span",{className:"text-sm text-neutral-600",children:[e.total_calls," calls"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsxs)("span",{className:"text-sm text-neutral-600",children:[Q(e),"% success"]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.phone_number&&(0,a.jsx)("button",{onClick:()=>Z(e),className:"p-2 rounded-lg transition-colors ".concat(e.is_active?"text-warning-600 hover:bg-warning-50":"text-success-600 hover:bg-success-50"),title:e.is_active?"Deactivate Agent":"Activate Agent",children:e.is_active?(0,a.jsx)(N.Z,{className:"w-4 h-4"}):(0,a.jsx)(j.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{D(e),z(!0)},className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"View Details",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{className:"p-2 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"More Options",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})})]})]}),e.business_objective&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-neutral-200",children:(0,a.jsxs)("p",{className:"text-sm text-neutral-600 line-clamp-2",children:[(0,a.jsx)("strong",{children:"Objective:"})," ",e.business_objective]})})]},e.id)):(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(x.Z,{className:"w-16 h-16 text-neutral-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:"No agents configured yet"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-6",children:"Create your first AI voice agent to start handling calls automatically"}),(0,a.jsxs)("button",{onClick:()=>t("/dashboard"),className:"btn-primary flex items-center mx-auto",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Create Your First Agent"]})]})}),(0,a.jsx)(c.M,{children:k&&C&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(r.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Agent Details"}),(0,a.jsx)("button",{onClick:()=>z(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Name"}),(0,a.jsx)("p",{className:"text-text-primary font-medium",children:C.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voice"}),(0,a.jsx)("p",{className:"text-text-primary",children:R(C.voice_id)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number"}),(0,a.jsx)("p",{className:"text-text-primary",children:C.phone_number?(0,y.un)(C.phone_number):"Not assigned"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Status"}),(0,a.jsx)("p",{className:"font-medium ".concat(C.phone_number?C.is_active?"text-success-600":"text-neutral-400":"text-warning-600"),children:P(C)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-primary-600",children:C.total_calls}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Calls"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-success-600",children:[Q(C),"%"]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Success Rate"})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Business Objective"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:C.business_objective||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Target Audience"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:C.target_audience||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Value Proposition"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:C.value_proposition||"Not specified"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>z(!1),className:"btn-secondary",children:"Close"}),(0,a.jsxs)("button",{className:"btn-primary flex items-center",disabled:!0,children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Edit Agent (Coming Soon)"]})]})]})]})})})]})}var S=s(99376);function E(){let e=(0,S.useRouter)();return(0,a.jsx)(w,{onNavigate:t=>{e.push(t)}})}},5526:function(e,t,s){"use strict";s.d(t,{LU:function(){return l},OQ:function(){return n},k_:function(){return r},lj:function(){return d},un:function(){return c},xG:function(){return o}});var a=s(57557);let i="https://ixeqedgrusamxwsvwoho.supabase.co",n=(0,a.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),r=async function(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null===(t=(await n.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,r={headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}}},c=await fetch("".concat(i,"/functions/v1/").concat(e),{...r,...s,headers:{...r.headers,...s.headers}});if(!c.ok)throw Error(await c.text());return c.json()},c=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),d=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,s){"use strict";s.d(t,{q:function(){return d},w:function(){return u}});var a=s(14623),i=s(2265),n=s(5526),r=s(69064);let c={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function l(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...c,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0};default:return e}}let o=(0,i.createContext)(void 0);function d(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function u(e){let{children:t}=e,[s,d]=(0,i.useReducer)(l,c),u=async()=>{try{console.log("\uD83D\uDD04 Starting fetchUserData..."),d({type:"SET_LOADING",loading:!0});let{data:{user:e},error:t}=await n.OQ.auth.getUser();if(t||!e){console.log("\uD83D\uDC64 No user found or error:",t),d({type:"RESET_STATE"});return}console.log("✅ User found:",e.email);let{data:s,error:a}=await n.OQ.from("user_profiles").select("*").eq("id",e.id).single();if(a){console.error("❌ Error fetching profile:",a),d({type:"AUTH_SUCCESS",payload:{user:e}});return}let i=null,r=null,c=[];if(null==s?void 0:s.organization_id){let{data:e}=await n.OQ.from("organizations").select("*").eq("id",s.organization_id).single();i=e;let{data:t}=await n.OQ.from("subscriptions").select("*").eq("organization_id",s.organization_id).single();r=t;let{data:a}=await n.OQ.from("agents").select("*").eq("organization_id",s.organization_id).order("created_at",{ascending:!1});c=a||[]}d({type:"AUTH_SUCCESS",payload:{user:e,profile:s,organization:i,subscription:r,agents:c}}),console.log("✅ fetchUserData completed")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),d({type:"SET_LOADING",loading:!1})}};return(0,i.useEffect)(()=>{let e=async()=>{console.log("\uD83D\uDE80 Initializing app...");let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),s=e.get("error_description");t?(r.ZP.success("Email verified successfully! Welcome to Kai Agent."),window.history.replaceState({},document.title,window.location.pathname)):s&&(r.ZP.error("Authentication error: ".concat(s)),window.history.replaceState({},document.title,window.location.pathname));let{data:{session:a}}=await n.OQ.auth.getSession();(null==a?void 0:a.user)?await u():d({type:"RESET_STATE"}),d({type:"SET_INITIALIZED",initialized:!0})};s.initialized||e();let{data:{subscription:t}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(d({type:"SET_NAVIGATING",isNavigating:!0}),await u(),d({type:"SET_NAVIGATING",isNavigating:!1})):"SIGNED_OUT"===e&&d({type:"RESET_STATE"})});return()=>t.unsubscribe()},[s.initialized]),(0,a.jsx)(o.Provider,{value:{state:s,dispatch:d,actions:{setLoading:e=>d({type:"SET_LOADING",loading:e}),setNavigating:e=>d({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:u,fetchAgents:async()=>{try{var e;if(!(null===(e=s.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:a}=await n.OQ.from("agents").select("*").eq("organization_id",s.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;return d({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),d({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=s.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await n.OQ.from("contacts").select("*").eq("organization_id",s.profile.organization_id).order("created_at",{ascending:!1});d({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),d({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{await n.OQ.auth.signOut(),d({type:"RESET_STATE"})}}},children:t})}}},function(e){e.O(0,[216,744],function(){return e(e.s=81058)}),_N_E=e.O()}]);