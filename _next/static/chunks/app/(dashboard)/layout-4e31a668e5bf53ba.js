(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{21650:function(e,t,r){Promise.resolve().then(r.bind(r,52475))},52475:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var a=r(14623),i=r(43860),n=r(99376),s=r(2265),o=r(5095),l=r(60429),c=r(99637),d=r(82222),u=r(95805),x=r(13041),h=r(46221),g=r(98728),m=r(11),p=r(32489),f=r(98617),b=r(47692),y=r(58293);function N(e){let{currentPath:t,onNavigate:r}=e,[N,w]=(0,s.useState)(!1),{state:v,actions:S}=(0,i.q)(),{user:E,profile:_,organization:j,subscription:T}=v,A=(0,n.useRouter)(),I=[{id:"dashboard",label:"Dashboard",icon:c.Z,href:"/dashboard"},{id:"agents",label:"Voice Agents",icon:d.Z,href:"/agents"},{id:"contacts",label:"CRM",icon:u.Z,href:"/contacts"},{id:"calls",label:"Call History",icon:x.Z,href:"/calls"},{id:"reports",label:"Reports",icon:h.Z,href:"/reports"},{id:"settings",label:"Settings",icon:g.Z,href:"/settings"}],D=async()=>{await S.logout(),w(!1),A.push("/auth")},z=()=>{var e,i;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-bg-secondary border-r border-bg-tertiary",children:[(0,a.jsx)("div",{className:"p-6 border-b border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-xl flex items-center justify-center shadow-primary",children:(0,a.jsx)(m.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg text-text-primary",children:"Kai"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"AI Voice Platform"})]})]}),(0,a.jsx)("button",{onClick:()=>w(!1),className:"md:hidden p-2 rounded-lg hover:bg-bg-tertiary",children:(0,a.jsx)(p.Z,{className:"w-5 h-5 text-text-tertiary"})})]})}),(0,a.jsx)("nav",{className:"flex-1 p-4 space-y-2",children:I.map(e=>{let i=t===e.href,n=e.icon;return(0,a.jsxs)("button",{onClick:()=>{r(e.href),w(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-left transition-all duration-200 nav-item ".concat(i?"bg-bg-tertiary text-text-primary border border-primary-solid shadow-primary":"text-text-secondary hover:bg-bg-tertiary hover:text-text-primary"),disabled:e.comingSoon,children:[(0,a.jsx)(n,{className:"w-5 h-5 ".concat(i?"text-primary-solid":"text-text-tertiary")}),(0,a.jsx)("span",{className:"flex-1",children:e.label}),e.badge&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-primary-solid text-white rounded-full",children:e.badge}),e.comingSoon&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-bg-tertiary text-text-tertiary rounded-full",children:"Soon"})]},e.id)})}),T&&(0,a.jsx)("div",{className:"p-4 border-t border-bg-tertiary",children:(0,a.jsxs)("div",{className:"bg-bg-tertiary rounded-xl p-4 border border-bg-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 text-accent-warning"}),(0,a.jsxs)("span",{className:"text-sm text-text-primary capitalize",children:[T.status," Plan"]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Minutes Used:"}),(0,a.jsxs)("span",{className:"font-medium",children:[T.minutes_used," / ",T.minutes_included]})]}),"trial"===T.status&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Trial Ends:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(T.trial_end_date).toLocaleDateString()})]})]}),"trial"===T.status&&(0,a.jsx)("button",{onClick:()=>r("/upgrade"),className:"btn-primary w-full mt-2 text-xs",children:"Upgrade Plan"})]})}),(0,a.jsxs)("div",{className:"p-4 border-t border-bg-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-xl flex items-center justify-center shadow-primary",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-white",children:[null==_?void 0:null===(e=_.first_name)||void 0===e?void 0:e[0],null==_?void 0:null===(i=_.last_name)||void 0===i?void 0:i[0]]})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("p",{className:"text-sm text-text-primary truncate",children:[null==_?void 0:_.first_name," ",null==_?void 0:_.last_name]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary truncate",children:null==j?void 0:j.name})]})]}),(0,a.jsxs)("button",{onClick:D,className:"w-full flex items-center space-x-2 px-3 py-2 text-sm text-text-secondary hover:text-text-primary hover:bg-bg-tertiary rounded-lg transition-colors",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Sign Out"})]})]})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>w(!0),className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-bg-secondary rounded-lg shadow-primary border border-bg-tertiary",children:(0,a.jsx)(y.Z,{className:"w-6 h-6 text-text-secondary"})}),(0,a.jsx)("div",{className:"hidden md:flex w-80 h-screen fixed left-0 top-0 z-40",children:(0,a.jsx)(z,{})}),(0,a.jsx)(o.M,{children:N&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>w(!1)}),(0,a.jsx)(l.E.div,{initial:{x:-320},animate:{x:0},exit:{x:-320},transition:{type:"spring",damping:25,stiffness:200},className:"md:hidden fixed left-0 top-0 w-80 h-screen z-50",children:(0,a.jsx)(z,{})})]})})]})}function w(e){let{children:t,currentPath:r}=e,i=(0,n.useRouter)();return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)(N,{currentPath:r,onNavigate:e=>{i.push(e)}}),(0,a.jsx)("div",{className:"md:ml-80",children:(0,a.jsx)("main",{className:"p-4 md:p-8",children:t})})]})}function v(e){let{children:t}=e,{state:r}=(0,i.q)(),s=(0,n.usePathname)();return r.user&&r.profile&&r.organization?(0,a.jsx)(w,{currentPath:s,children:t}):null}},5526:function(e,t,r){"use strict";r.d(t,{LU:function(){return l},OQ:function(){return n},k_:function(){return s},lj:function(){return d},un:function(){return o},xG:function(){return c}});var a=r(57557);let i="https://ixeqedgrusamxwsvwoho.supabase.co",n=(0,a.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),s=async function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null===(t=(await n.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,s={headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}}},o=await fetch("".concat(i,"/functions/v1/").concat(e),{...s,...r,headers:{...s.headers,...r.headers}});if(!o.ok)throw Error(await o.text());return o.json()},o=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),c=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),d=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,r){"use strict";r.d(t,{q:function(){return d},w:function(){return u}});var a=r(14623),i=r(2265),n=r(5526),s=r(69064);let o={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function l(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...o,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0};default:return e}}let c=(0,i.createContext)(void 0);function d(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function u(e){let{children:t}=e,[r,d]=(0,i.useReducer)(l,o),u=async()=>{try{console.log("\uD83D\uDD04 Starting fetchUserData..."),d({type:"SET_LOADING",loading:!0});let{data:{user:e},error:t}=await n.OQ.auth.getUser();if(t||!e){console.log("\uD83D\uDC64 No user found or error:",t),d({type:"RESET_STATE"});return}console.log("✅ User found:",e.email);let{data:r,error:a}=await n.OQ.from("user_profiles").select("*").eq("id",e.id).single();if(a){console.error("❌ Error fetching profile:",a),d({type:"AUTH_SUCCESS",payload:{user:e}});return}let i=null,s=null,o=[];if(null==r?void 0:r.organization_id){let{data:e}=await n.OQ.from("organizations").select("*").eq("id",r.organization_id).single();i=e;let{data:t}=await n.OQ.from("subscriptions").select("*").eq("organization_id",r.organization_id).single();s=t;let{data:a}=await n.OQ.from("agents").select("*").eq("organization_id",r.organization_id).order("created_at",{ascending:!1});o=a||[]}d({type:"AUTH_SUCCESS",payload:{user:e,profile:r,organization:i,subscription:s,agents:o}}),console.log("✅ fetchUserData completed")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),d({type:"SET_LOADING",loading:!1})}};return(0,i.useEffect)(()=>{let e=async()=>{console.log("\uD83D\uDE80 Initializing app...");let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),r=e.get("error_description");t?(s.ZP.success("Email verified successfully! Welcome to Kai Agent."),window.history.replaceState({},document.title,window.location.pathname)):r&&(s.ZP.error("Authentication error: ".concat(r)),window.history.replaceState({},document.title,window.location.pathname));let{data:{session:a}}=await n.OQ.auth.getSession();(null==a?void 0:a.user)?await u():d({type:"RESET_STATE"}),d({type:"SET_INITIALIZED",initialized:!0})};r.initialized||e();let{data:{subscription:t}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(d({type:"SET_NAVIGATING",isNavigating:!0}),await u(),d({type:"SET_NAVIGATING",isNavigating:!1})):"SIGNED_OUT"===e&&d({type:"RESET_STATE"})});return()=>t.unsubscribe()},[r.initialized]),(0,a.jsx)(c.Provider,{value:{state:r,dispatch:d,actions:{setLoading:e=>d({type:"SET_LOADING",loading:e}),setNavigating:e=>d({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:u,fetchAgents:async()=>{try{var e;if(!(null===(e=r.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:a}=await n.OQ.from("agents").select("*").eq("organization_id",r.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;return d({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),d({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=r.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await n.OQ.from("contacts").select("*").eq("organization_id",r.profile.organization_id).order("created_at",{ascending:!1});d({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),d({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{await n.OQ.auth.signOut(),d({type:"RESET_STATE"})}}},children:t})}}},function(e){e.O(0,[216,744],function(){return e(e.s=21650)}),_N_E=e.O()}]);