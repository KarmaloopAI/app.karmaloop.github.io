(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{14966:function(e,t,a){Promise.resolve().then(a.bind(a,67440))},67440:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(14623),n=a(2265),i=a(43860),r=a(60429),c=a(12194),l=a(65302),o=a(91723),d=a(95805),u=a(22252),m=a(16524),x=a(22839),h=a(82222),g=a(13041),p=a(46221),y=a(5526);function N(e){let{onNavigate:t}=e,{state:a}=(0,i.q)(),{profile:N,subscription:b,agents:f,contacts:v}=a,[_,j]=(0,n.useState)(null),[w,E]=(0,n.useState)([]),[S,T]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(null==N?void 0:N.organization_id)&&A()},[N]);let A=async()=>{try{T(!0);let{data:e}=await y.OQ.rpc("get_organization_stats",{org_id:null==N?void 0:N.organization_id});if(e&&e.length>0){let t=e[0];j({totalCalls:t.total_calls||0,successfulCalls:t.successful_calls||0,totalMinutes:t.total_minutes||0,totalContacts:t.total_contacts||0,activeAgents:t.active_agents||0,minutesRemaining:t.minutes_remaining||0,callsToday:0,successRateToday:0})}let{data:t}=await y.OQ.from("calls").select("\n          id,\n          direction,\n          outcome,\n          duration_seconds,\n          started_at,\n          from_number,\n          to_number,\n          contacts (first_name, last_name),\n          agents (name)\n        ").eq("organization_id",null==N?void 0:N.organization_id).order("created_at",{ascending:!1}).limit(10);if(t){let e=t.map(e=>{let t=Array.isArray(e.contacts)?e.contacts[0]:e.contacts,a=Array.isArray(e.agents)?e.agents[0]:e.agents;return{id:e.id,contact_name:t?"".concat(t.first_name||""," ").concat(t.last_name||"").trim():"inbound"===e.direction?e.from_number:e.to_number,phone_number:"inbound"===e.direction?e.from_number:e.to_number,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,agent_name:(null==a?void 0:a.name)||"Unknown"}});E(e);let a=new Date().toDateString(),s=e.filter(e=>new Date(e.started_at).toDateString()===a),n=s.filter(e=>"success"===e.outcome).length;j(e=>e?{...e,callsToday:s.length,successRateToday:s.length>0?n/s.length*100:0}:null)}}catch(e){console.error("Error fetching dashboard data:",e)}finally{T(!1)}},C=[{title:"Total Calls",value:(null==_?void 0:_.totalCalls)||0,icon:c.Z,color:"primary",trend:(null==_?void 0:_.callsToday)?"+".concat(_.callsToday," today"):"No calls today"},{title:"Success Rate",value:_&&_.totalCalls>0?"".concat(Math.round(_.successfulCalls/_.totalCalls*100),"%"):"0%",icon:l.Z,color:"success",trend:"".concat(Math.round((null==_?void 0:_.successRateToday)||0),"% today")},{title:"Minutes Used",value:"".concat((null==_?void 0:_.totalMinutes)||0,"m"),icon:o.Z,color:"warning",trend:"".concat((null==_?void 0:_.minutesRemaining)||0,"m remaining")},{title:"Contacts",value:(null==_?void 0:_.totalContacts)||0,icon:d.Z,color:"secondary",trend:"Total in CRM"}];return S?(0,s.jsx)("div",{className:"space-y-8",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,s.jsxs)("div",{className:"card animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-neutral-600 rounded w-1/2 mb-4"}),(0,s.jsx)("div",{className:"h-8 bg-neutral-600 rounded w-1/3 mb-2"}),(0,s.jsx)("div",{className:"h-3 bg-neutral-600 rounded w-1/4"})]},e))})}):(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"dashboard-header",children:[(0,s.jsxs)(r.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"dashboard-title",children:["Welcome back, ",null==N?void 0:N.first_name,"! \uD83D\uDC4B"]}),(0,s.jsx)("p",{className:"dashboard-subtitle",children:"Here's what's happening with your AI voice agents today."})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map((e,t)=>{let a=e.icon;return(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"kpi-card p-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("div",{className:"icon-box",children:(0,s.jsx)(a,{className:"w-6 h-6"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"kpi-title",children:e.title}),(0,s.jsx)("p",{className:"kpi-value",children:e.value}),(0,s.jsx)("p",{className:"text-xs text-white/70",children:e.trend})]})]},e.title)})}),b&&(0,s.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"trial-banner p-6 rounded-2xl ".concat("trial"===b.status?"border-warning-200":"border-success-200"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(u.Z,{className:"w-6 h-6 ".concat("trial"===b.status?"text-warning-600":"text-success-600")}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-medium text-text-primary capitalize",children:[b.status," Account"]}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"trial"===b.status?"Trial ends ".concat(new Date(b.trial_end_date).toLocaleDateString()):"Active subscription"})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:[b.minutes_used," / ",b.minutes_included," minutes"]}),(0,s.jsx)("div",{className:"w-32 h-2 bg-neutral-200 rounded-full mt-1",children:(0,s.jsx)("div",{className:"h-full rounded-full ".concat("trial"===b.status?"bg-warning-500":"bg-success-500"),style:{width:"".concat(Math.min(b.minutes_used/b.minutes_included*100,100),"%")}})})]})]})}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Recent Calls"}),(0,s.jsx)("button",{onClick:()=>t("/calls"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View All"})]}),w.length>0?(0,s.jsx)("div",{className:"space-y-4",children:w.slice(0,5).map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,s.jsx)("div",{className:"icon-box w-10 h-10 ".concat((e.direction,"bg-primary-600")),children:"inbound"===e.direction?(0,s.jsx)(m.Z,{className:"w-5 h-5 text-white"}):(0,s.jsx)(x.Z,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.contact_name||e.phone_number}),(0,s.jsxs)("p",{className:"text-sm text-text-secondary",children:[e.agent_name," • ",(0,y.LU)(e.duration_seconds)]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,y.lj)(e.outcome)),children:e.outcome.replace("_"," ")}),(0,s.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:new Date(e.started_at).toLocaleTimeString()})]})]},e.id))}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(c.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"No calls yet"}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"Your call history will appear here"})]})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Your Agents"}),(0,s.jsx)("button",{onClick:()=>t("/agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Manage Agents"})]}),f.length>0?(0,s.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,s.jsx)("div",{className:"icon-box w-10 h-10",children:(0,s.jsx)(h.Z,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.name}),(0,s.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.is_active&&e.phone_number?"bg-success-500":"bg-neutral-400")})]}),(0,s.jsx)("div",{className:"text-sm text-text-secondary",children:e.phone_number?(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,s.jsx)(g.Z,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:(0,y.un)(e.phone_number)})]}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:"Savannah"===e.voice_id?"Sandra":"Jackson"})]}):(0,s.jsx)("span",{className:"text-warning-600",children:"No phone number assigned"})})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active&&e.phone_number?"text-success-100 bg-success-800":"text-warning-100 bg-warning-800"),children:e.is_active&&e.phone_number?"Active":"Setup Required"}),(0,s.jsxs)("p",{className:"text-xs text-text-tertiary mt-1",children:[e.total_calls," calls",e.total_calls>0&&(0,s.jsxs)(s.Fragment,{children:[" • ",Math.round(e.successful_calls/e.total_calls*100),"% success"]})]})]})]},e.id))}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(h.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"No agents configured"}),(0,s.jsx)("button",{onClick:()=>t("/agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium mt-2",children:"Create Your First Agent"})]})]})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-text-primary mb-6",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,s.jsxs)("button",{onClick:()=>t("/contacts"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,s.jsx)(d.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,s.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Manage Contacts"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"View detailed contact communication timeline"})]}),(0,s.jsxs)("button",{onClick:()=>t("/agents"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,s.jsx)(h.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,s.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Create Agent"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"Set up a new AI voice agent with enhanced tracking"})]}),(0,s.jsxs)("button",{onClick:()=>t("/reports"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,s.jsx)(p.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,s.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Analytics"}),(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:"Advanced call performance metrics"})]})]})]}),(0,s.jsx)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"card bg-gradient-to-r from-primary-600 to-primary-700 text-white",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:"\uD83D\uDE80 Enhanced Features Available"}),(0,s.jsx)("p",{className:"text-primary-100 mb-4",children:"Your platform now includes advanced call tracking, detailed contact timelines, and enhanced security."}),(0,s.jsxs)("ul",{className:"text-sm text-primary-100 space-y-1",children:[(0,s.jsx)("li",{children:"• Comprehensive contact communication history"}),(0,s.jsx)("li",{children:"• Call recordings with full transcripts"}),(0,s.jsx)("li",{children:"• Enhanced VAPI integration with secure webhooks"}),(0,s.jsx)("li",{children:"• Real-time call data synchronization"})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("button",{onClick:()=>t("/contacts"),className:"px-4 py-2 bg-white text-primary-600 rounded-lg font-medium hover:bg-primary-50 transition-colors",children:"Try New CRM"})})]})})]})}var b=a(99376);function f(){let e=(0,b.useRouter)();return(0,s.jsx)(N,{onNavigate:t=>{e.push(t)}})}},5526:function(e,t,a){"use strict";a.d(t,{LU:function(){return l},OQ:function(){return i},k_:function(){return r},lj:function(){return d},un:function(){return c},xG:function(){return o}});var s=a(57557);let n="https://ixeqedgrusamxwsvwoho.supabase.co",i=(0,s.eI)(n,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),r=async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null===(t=(await i.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,r={headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)}}},c=await fetch("".concat(n,"/functions/v1/").concat(e),{...r,...a,headers:{...r.headers,...a.headers}});if(!c.ok)throw Error(await c.text());return c.json()},c=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},l=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),d=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,a){"use strict";a.d(t,{q:function(){return d},w:function(){return u}});var s=a(14623),n=a(2265),i=a(5526),r=a(69064);let c={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function l(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...c,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0};default:return e}}let o=(0,n.createContext)(void 0);function d(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function u(e){var t;let{children:a}=e,[d,u]=(0,n.useReducer)(l,c),m=async()=>{try{console.log("\uD83D\uDD04 Starting fetchUserData..."),u({type:"SET_LOADING",loading:!0});let{data:{user:e},error:t}=await i.OQ.auth.getUser();if(t||!e){console.log("\uD83D\uDC64 No user found or error:",t),u({type:"RESET_STATE"});return}console.log("✅ User found:",e.email);let{data:a,error:s}=await i.OQ.from("user_profiles").select("*").eq("id",e.id).single();if(s){console.error("❌ Error fetching profile:",s),u({type:"AUTH_SUCCESS",payload:{user:e}});return}let n=null,r=null,c=[];if(null==a?void 0:a.organization_id){let{data:e}=await i.OQ.from("organizations").select("*").eq("id",a.organization_id).single();n=e;let{data:t}=await i.OQ.from("subscriptions").select("*").eq("organization_id",a.organization_id).single();r=t;let{data:s}=await i.OQ.from("agents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});c=s||[]}u({type:"AUTH_SUCCESS",payload:{user:e,profile:a,organization:n,subscription:r,agents:c}}),console.log("✅ fetchUserData completed")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),u({type:"SET_LOADING",loading:!1})}},x=(0,n.useMemo)(()=>({setLoading:e=>u({type:"SET_LOADING",loading:e}),setNavigating:e=>u({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:m,fetchAgents:async()=>{try{var e;if(!(null===(e=d.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:a}=await i.OQ.from("agents").select("*").eq("organization_id",d.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;return u({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),u({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=d.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await i.OQ.from("contacts").select("*").eq("organization_id",d.profile.organization_id).order("created_at",{ascending:!1});u({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),u({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{await i.OQ.auth.signOut(),u({type:"RESET_STATE"})}}),[null===(t=d.profile)||void 0===t?void 0:t.organization_id,u]);return(0,n.useEffect)(()=>{let e=async()=>{console.log("\uD83D\uDE80 Initializing app...");let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),a=e.get("error_description");t?(r.ZP.success("Email verified successfully! Welcome to Kai Agent."),window.history.replaceState({},document.title,window.location.pathname)):a&&(r.ZP.error("Authentication error: ".concat(a)),window.history.replaceState({},document.title,window.location.pathname));let{data:{session:s}}=await i.OQ.auth.getSession();(null==s?void 0:s.user)?await m():u({type:"RESET_STATE"}),u({type:"SET_INITIALIZED",initialized:!0})};d.initialized||e();let{data:{subscription:t}}=i.OQ.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(u({type:"SET_NAVIGATING",isNavigating:!0}),await m(),u({type:"SET_NAVIGATING",isNavigating:!1})):"SIGNED_OUT"===e&&u({type:"RESET_STATE"})});return()=>t.unsubscribe()},[d.initialized]),(0,s.jsx)(o.Provider,{value:{state:d,dispatch:u,actions:x},children:a})}}},function(e){e.O(0,[216,744],function(){return e(e.s=14966)}),_N_E=e.O()}]);