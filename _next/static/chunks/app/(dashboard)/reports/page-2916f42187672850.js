(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[960],{47586:function(e,t,a){Promise.resolve().then(a.bind(a,71995))},71995:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(14623),n=a(2265),i=a(43860),r=a(60429),l=a(12194),c=a(58896),o=a(91723),d=a(95252),u=a(92735),x=a(70525),m=a(46221),h=a(47625),g=a(77031),p=a(56940),f=a(97059),y=a(62994),N=a(8147),v=a(31699),j=a(75169),b=a(3574),_=a(20407),w=a(5526);let S=["#0ea5e9","#22c55e","#f59e0b","#ef4444","#8b5cf6"];function E(e){let{onNavigate:t}=e,{state:a}=(0,i.q)(),{profile:E,subscription:T}=a,[C,A]=(0,n.useState)(!0),[D,I]=(0,n.useState)("7d"),[z,O]=(0,n.useState)(null),[R,U]=(0,n.useState)([]),[G,M]=(0,n.useState)([]),[k,L]=(0,n.useState)([]);(0,n.useEffect)(()=>{(null==E?void 0:E.organization_id)&&Z()},[E,D]);let Z=async()=>{try{A(!0);let e=parseInt(D.replace("d","")),t=new Date;t.setDate(t.getDate()-e);let{data:a}=await w.OQ.from("calls").select("\n          id,\n          outcome,\n          duration_seconds,\n          cost_usd,\n          started_at,\n          agents!inner(name)\n        ").eq("organization_id",null==E?void 0:E.organization_id).gte("started_at",t.toISOString()).order("started_at",{ascending:!0});if(a){let e=a.length,t=a.filter(e=>"success"===e.outcome).length,s=Math.round(a.reduce((e,t)=>e+t.duration_seconds,0)/60),n=a.reduce((e,t)=>e+(t.cost_usd||0),0);O({totalCalls:e,successfulCalls:t,failedCalls:e-t,totalMinutes:s,averageDuration:e>0?Math.round(60*s/e):0,successRate:e>0?Math.round(t/e*100):0,costTotal:n,avgCostPerCall:e>0?n/e:0});let i=new Map;a.forEach(e=>{let t=new Date(e.started_at).toLocaleDateString(),a=i.get(t)||{date:t,calls:0,successful:0,minutes:0,cost:0};a.calls+=1,"success"===e.outcome&&(a.successful+=1),a.minutes+=Math.round(e.duration_seconds/60),a.cost+=e.cost_usd||0,i.set(t,a)}),U(Array.from(i.values()).slice(-7));let r=new Map;a.forEach(e=>{var t,a;let s=(null===(t=e.agents)||void 0===t?void 0:t.name)||(Array.isArray(e.agents)?null===(a=e.agents[0])||void 0===a?void 0:a.name:null)||"Unknown",n=r.get(s)||{agentName:s,totalCalls:0,successfulCalls:0,successRate:0,avgDuration:0};n.totalCalls+=1,"success"===e.outcome&&(n.successfulCalls+=1),n.avgDuration=(n.avgDuration*(n.totalCalls-1)+e.duration_seconds)/n.totalCalls,n.successRate=Math.round(n.successfulCalls/n.totalCalls*100),r.set(s,n)}),M(Array.from(r.values()));let l=new Map;a.forEach(e=>{let t=e.outcome||"unknown";l.set(t,(l.get(t)||0)+1)});let c=Array.from(l.entries()).map(t=>{let[a,s]=t;return{name:a.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),value:s,percentage:Math.round(s/e*100)}});L(c)}}catch(e){console.error("Error fetching reports data:",e)}finally{A(!1)}},Q=[{title:"Total Calls",value:(null==z?void 0:z.totalCalls)||0,icon:l.Z,color:"primary",change:"+12% vs last period"},{title:"Success Rate",value:"".concat((null==z?void 0:z.successRate)||0,"%"),icon:c.Z,color:"success",change:"+5% vs last period"},{title:"Total Minutes",value:"".concat((null==z?void 0:z.totalMinutes)||0,"m"),icon:o.Z,color:"warning",change:"".concat(((null==T?void 0:T.minutes_included)||0)-((null==T?void 0:T.minutes_used)||0),"m remaining")},{title:"Total Cost",value:(0,w.xG)((null==z?void 0:z.costTotal)||0),icon:d.Z,color:"secondary",change:"".concat((0,w.xG)((null==z?void 0:z.avgCostPerCall)||0)," avg per call")}];return C?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports"})}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,s.jsxs)("div",{className:"card animate-pulse",children:[(0,s.jsx)("div",{className:"h-4 bg-neutral-200 rounded w-1/2 mb-4"}),(0,s.jsx)("div",{className:"h-8 bg-neutral-200 rounded w-1/3 mb-2"}),(0,s.jsx)("div",{className:"h-3 bg-neutral-200 rounded w-1/4"})]},e))})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports & Analytics"}),(0,s.jsx)("p",{className:"text-neutral-600 mt-1",children:"Track performance and analyze your AI voice agent metrics"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("select",{value:D,onChange:e=>I(e.target.value),className:"input-field",children:[(0,s.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,s.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,s.jsx)("option",{value:"90d",children:"Last 90 days"})]}),(0,s.jsxs)("button",{className:"btn-secondary flex items-center",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Q.map((e,t)=>{let a=e.icon;return(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-".concat(e.color,"-100 rounded-xl flex items-center justify-center"),children:(0,s.jsx)(a,{className:"w-6 h-6 text-".concat(e.color,"-600")})}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)(x.Z,{className:"w-4 h-4 text-success-500 mb-1"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-neutral-600 mb-1",children:e.title}),(0,s.jsx)("p",{className:"text-2xl font-bold text-neutral-900 mb-1",children:e.value}),(0,s.jsx)("p",{className:"text-xs text-neutral-500",children:e.change})]})]},e.title)})}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Daily Performance"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-primary-500 rounded-full"}),(0,s.jsx)("span",{className:"text-neutral-600",children:"Total Calls"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-success-500 rounded-full"}),(0,s.jsx)("span",{className:"text-neutral-600",children:"Successful"})]})]})]}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(h.h,{width:"100%",height:"100%",children:(0,s.jsxs)(g.v,{data:R,children:[(0,s.jsx)(p.q,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),(0,s.jsx)(f.K,{dataKey:"date",stroke:"#6b7280",fontSize:12}),(0,s.jsx)(y.B,{stroke:"#6b7280",fontSize:12}),(0,s.jsx)(N.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}}),(0,s.jsx)(v.$,{dataKey:"calls",fill:"#0ea5e9",radius:[4,4,0,0]}),(0,s.jsx)(v.$,{dataKey:"successful",fill:"#22c55e",radius:[4,4,0,0]})]})})})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Call Outcomes"})}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(h.h,{width:"100%",height:"100%",children:(0,s.jsxs)(j.u,{children:[(0,s.jsx)(b.b,{data:k,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percentage:a}=e;return"".concat(t,": ").concat(a,"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:k.map((e,t)=>(0,s.jsx)(_.b,{fill:S[t%S.length]},"cell-".concat(t)))}),(0,s.jsx)(N.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}})]})})}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:k.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S[t%S.length]}}),(0,s.jsx)("span",{className:"text-sm text-neutral-600",children:e.name}),(0,s.jsx)("span",{className:"text-sm font-medium text-neutral-900",children:e.value})]},e.name))})]})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Agent Performance"})}),G.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-bg-secondary border-b border-border-subtle",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Agent"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Total Calls"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Successful"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Success Rate"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Avg Duration"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-border-subtle",children:G.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-bg-secondary",children:[(0,s.jsx)("td",{className:"py-3 px-4 font-medium text-text-primary",children:e.agentName}),(0,s.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.totalCalls}),(0,s.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.successfulCalls}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"flex-1 bg-neutral-600 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-success-500 h-2 rounded-full",style:{width:"".concat(e.successRate,"%")}})}),(0,s.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[e.successRate,"%"]})]})}),(0,s.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:(0,w.LU)(Math.round(e.avgDuration))})]},e.agentName))})]})}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(m.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-text-secondary",children:"No agent performance data available"}),(0,s.jsx)("p",{className:"text-sm text-text-tertiary",children:"Data will appear after your agents make calls"})]})]}),(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,s.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Consumption Report"})}),(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-primary-600 mb-2",children:(null==T?void 0:T.minutes_used)||0}),(0,s.jsx)("p",{className:"text-sm text-neutral-600",children:"Minutes Used"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-success-600 mb-2",children:((null==T?void 0:T.minutes_included)||0)-((null==T?void 0:T.minutes_used)||0)}),(0,s.jsx)("p",{className:"text-sm text-neutral-600",children:"Minutes Remaining"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-3xl font-bold text-neutral-900 mb-2",children:(0,w.xG)((null==z?void 0:z.costTotal)||0)}),(0,s.jsx)("p",{className:"text-sm text-neutral-600",children:"Total Cost"})]})]}),T&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-neutral-600",children:"Usage Progress"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-neutral-900",children:[Math.round(T.minutes_used/T.minutes_included*100),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-neutral-200 rounded-full h-3",children:(0,s.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat(T.minutes_used/T.minutes_included>.8?"bg-error-500":T.minutes_used/T.minutes_included>.6?"bg-warning-500":"bg-success-500"),style:{width:"".concat(Math.min(T.minutes_used/T.minutes_included*100,100),"%")}})})]})]})]})}var T=a(99376);function C(){let e=(0,T.useRouter)();return(0,s.jsx)(E,{onNavigate:t=>{e.push(t)}})}},5526:function(e,t,a){"use strict";a.d(t,{LU:function(){return c},OQ:function(){return i},k_:function(){return r},lj:function(){return d},un:function(){return l},xG:function(){return o}});var s=a(57557);let n="https://ixeqedgrusamxwsvwoho.supabase.co",i=(0,s.eI)(n,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),r=async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null===(t=(await i.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,r={headers:{"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)}}},l=await fetch("".concat(n,"/functions/v1/").concat(e),{...r,...a,headers:{...r.headers,...a.headers}});if(!l.ok)throw Error(await l.text());return l.json()},l=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},c=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),d=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,a){"use strict";a.d(t,{q:function(){return d},w:function(){return u}});var s=a(14623),n=a(2265),i=a(5526),r=a(69064);let l={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function c(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...l,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0};default:return e}}let o=(0,n.createContext)(void 0);function d(){let e=(0,n.useContext)(o);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function u(e){var t;let{children:a}=e,[d,u]=(0,n.useReducer)(c,l),x=async()=>{try{console.log("\uD83D\uDD04 Starting fetchUserData..."),u({type:"SET_LOADING",loading:!0});let{data:{user:e},error:t}=await i.OQ.auth.getUser();if(t||!e){console.log("\uD83D\uDC64 No user found or error:",t),u({type:"RESET_STATE"});return}console.log("✅ User found:",e.email);let{data:a,error:s}=await i.OQ.from("user_profiles").select("*").eq("id",e.id).single();if(s){console.error("❌ Error fetching profile:",s),u({type:"AUTH_SUCCESS",payload:{user:e}});return}let n=null,r=null,l=[];if(null==a?void 0:a.organization_id){let{data:e}=await i.OQ.from("organizations").select("*").eq("id",a.organization_id).single();n=e;let{data:t}=await i.OQ.from("subscriptions").select("*").eq("organization_id",a.organization_id).single();r=t;let{data:s}=await i.OQ.from("agents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});l=s||[]}u({type:"AUTH_SUCCESS",payload:{user:e,profile:a,organization:n,subscription:r,agents:l}}),console.log("✅ fetchUserData completed")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),u({type:"SET_LOADING",loading:!1})}},m=(0,n.useMemo)(()=>({setLoading:e=>u({type:"SET_LOADING",loading:e}),setNavigating:e=>u({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:x,fetchAgents:async()=>{try{var e;if(!(null===(e=d.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:a}=await i.OQ.from("agents").select("*").eq("organization_id",d.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;return u({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),u({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=d.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await i.OQ.from("contacts").select("*").eq("organization_id",d.profile.organization_id).order("created_at",{ascending:!1});u({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),u({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{await i.OQ.auth.signOut(),u({type:"RESET_STATE"})}}),[null===(t=d.profile)||void 0===t?void 0:t.organization_id,u]);return(0,n.useEffect)(()=>{let e=async()=>{console.log("\uD83D\uDE80 Initializing app...");let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),a=e.get("error_description");t?(r.ZP.success("Email verified successfully! Welcome to Kai Agent."),window.history.replaceState({},document.title,window.location.pathname)):a&&(r.ZP.error("Authentication error: ".concat(a)),window.history.replaceState({},document.title,window.location.pathname));let{data:{session:s}}=await i.OQ.auth.getSession();(null==s?void 0:s.user)?await x():u({type:"RESET_STATE"}),u({type:"SET_INITIALIZED",initialized:!0})};d.initialized||e();let{data:{subscription:t}}=i.OQ.auth.onAuthStateChange(async(e,t)=>{console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?(u({type:"SET_NAVIGATING",isNavigating:!0}),await x(),u({type:"SET_NAVIGATING",isNavigating:!1})):"SIGNED_OUT"===e&&u({type:"RESET_STATE"})});return()=>t.unsubscribe()},[d.initialized]),(0,s.jsx)(o.Provider,{value:{state:d,dispatch:u,actions:m},children:a})}}},function(e){e.O(0,[216,744],function(){return e(e.s=47586)}),_N_E=e.O()}]);