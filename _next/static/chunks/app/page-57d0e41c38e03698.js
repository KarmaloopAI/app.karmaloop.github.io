(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{22511:function(e,t,s){Promise.resolve().then(s.bind(s,51771))},51771:function(e,t,s){"use strict";s.d(t,{default:function(){return e4}});var a=s(14623),i=s(43860),r=s(2265),n=s(60429),l=s(5526),c=s(29090),o=s(89345),d=s(87769),m=s(42208),x=s(69064);function u(e){let{onSuccess:t,onSwitchToSignup:s,onForgotPassword:i}=e,[u,h]=(0,r.useState)({email:"",password:""}),[p,g]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!1),[b,N]=(0,r.useState)({}),v=()=>{let e={};return u.email.trim()?/\S+@\S+\.\S+/.test(u.email)||(e.email="Please enter a valid email"):e.email="Email is required",u.password||(e.password="Password is required"),N(e),0===Object.keys(e).length},f=async e=>{if(e.preventDefault(),v()){j(!0);try{console.log("\uD83D\uDD10 Attempting login...");let{data:e,error:s}=await l.OQ.auth.signInWithPassword({email:u.email,password:u.password});if(s)throw console.error("❌ Login error:",s),s;e.user&&(console.log("✅ Login successful, user:",e.user.email),x.ZP.success("Welcome back!"),setTimeout(()=>{console.log("\uD83C\uDFAF Calling onSuccess callback"),t()},100))}catch(e){console.error("\uD83D\uDCA5 Login error:",e),e.message.includes("Invalid login credentials")?x.ZP.error("Invalid email or password"):e.message.includes("Email not confirmed")?x.ZP.error("Please check your email and click the verification link"):x.ZP.error(e.message||"Failed to sign in")}finally{setTimeout(()=>{j(!1)},500)}}},w=(e,t)=>{h(s=>({...s,[e]:t})),b[e]&&N(t=>({...t,[e]:void 0}))};return(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(c.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Welcome Back"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Sign in to manage your AI voice agents"})]}),(0,a.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:u.email,onChange:e=>w("email",e.target.value),className:"input-field pl-10 ".concat(b.email?"border-error-500":""),placeholder:"john@example.com",autoComplete:"email",disabled:y})]}),b.email&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:b.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:p?"text":"password",value:u.password,onChange:e=>w("password",e.target.value),className:"input-field pr-10 ".concat(b.password?"border-error-500":""),placeholder:"••••••••",autoComplete:"current-password",disabled:y}),(0,a.jsx)("button",{type:"button",onClick:()=>g(!p),className:"absolute right-3 top-1/2 transform -translate-y-1/2",disabled:y,children:p?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),b.password&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:b.password})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("button",{type:"button",onClick:i,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",disabled:y,children:"Forgot your password?"})}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:y?"Signing in...":"Sign In"})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("p",{className:"text-text-secondary",children:["Don't have an account?"," ",(0,a.jsx)("button",{onClick:s,className:"text-primary-600 hover:text-primary-700 font-medium",disabled:y,children:"Create one"})]})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 trial-banner rounded-xl border border-primary-200",children:[(0,a.jsx)("h3",{className:"font-medium text-primary-800 mb-1",children:"Start Your Free Trial"}),(0,a.jsx)("p",{className:"text-sm text-primary-700",children:"Get 14 days and 100 minutes free to test Kai's AI voice agents"})]})]})})}var h=s(92369),p=s(13041),g=s(60044);function y(e){let{onSuccess:t,onSwitchToLogin:s}=e,[i,c]=(0,r.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:"",phoneNumber:"",organizationName:"",industry:""}),[u,y]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[N,v]=(0,r.useState)(!1),[f,w]=(0,r.useState)(1),[C,_]=(0,r.useState)({}),k=()=>{let e={};return i.firstName.trim()||(e.firstName="First name is required"),i.lastName.trim()||(e.lastName="Last name is required"),i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(e.email="Please enter a valid email"):e.email="Email is required",i.password?i.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",i.password!==i.confirmPassword&&(e.confirmPassword="Passwords do not match"),i.phoneNumber.trim()?/^\+?[\d\s\-\(\)]+$/.test(i.phoneNumber)||(e.phoneNumber="Please enter a valid phone number"):e.phoneNumber="Phone number is required",_(e),0===Object.keys(e).length},S=()=>{let e={};return i.organizationName.trim()||(e.organizationName="Organization name is required"),i.industry.trim()||(e.industry="Industry is required"),_(e),0===Object.keys(e).length},Z=()=>{k()&&w(2)},D=async e=>{if(e.preventDefault(),S()){v(!0);try{let e=i.phoneNumber.replace(/\D/g,"");10===e.length?e="+1".concat(e):11===e.length&&e.startsWith("1")?e="+".concat(e):e.startsWith("+")||(e="+1".concat(e));let{data:s,error:a}=await l.OQ.auth.signUp({email:i.email,password:i.password,options:{data:{first_name:i.firstName,last_name:i.lastName,phone_number:e,organization_name:i.organizationName,industry:i.industry},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});if(a)throw a;if(s.user){console.log("✅ User created successfully:",s.user.email),console.log("\uD83C\uDFE2 Creating organization...");let{data:a,error:r}=await l.OQ.from("organizations").insert({name:i.organizationName,industry:i.industry,default_country_code:"+1"}).select().single();if(r)throw console.error("❌ Organization creation error:",r),r;console.log("✅ Organization created:",a),console.log("\uD83D\uDCCB Updating user profile...");let{error:n}=await l.OQ.from("user_profiles").update({organization_id:a.id,phone_number:e,email_verified:!1}).eq("id",s.user.id);if(n)throw console.error("❌ Profile update error:",n),n;console.log("✅ Profile updated successfully"),console.log("\uD83D\uDCB3 Creating subscription...");let{error:c}=await l.OQ.from("subscriptions").insert({organization_id:a.id,status:"trial",minutes_included:100,minutes_used:0});if(c)throw console.error("❌ Subscription creation error:",c),c;console.log("✅ Subscription created successfully"),x.ZP.success("Account created successfully! Please check your email for verification."),t()}}catch(e){console.error("Signup error:",e),x.ZP.error(e.message||"Failed to create account")}finally{v(!1)}}},A=(e,t)=>{c(s=>({...s,[e]:t})),C[e]&&_(t=>({...t,[e]:void 0}))};return(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Create Your Account"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Join the AI voice agent revolution"}),!1]}),(0,a.jsx)("div",{className:"flex items-center justify-center mb-8",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(f>=1?"bg-primary-600 text-white":"bg-neutral-600 text-neutral-400"),children:"1"}),(0,a.jsx)("div",{className:"w-16 h-1 rounded ".concat(f>=2?"bg-primary-600":"bg-neutral-600")}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(f>=2?"bg-primary-600 text-white":"bg-neutral-600 text-neutral-400"),children:"2"})]})}),(0,a.jsx)("form",{onSubmit:1===f?e=>{e.preventDefault(),Z()}:D,children:1===f?(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-center text-text-primary",children:"Personal Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:i.firstName,onChange:e=>A("firstName",e.target.value),className:"input-field ".concat(C.firstName?"border-error-500":""),placeholder:"John"}),C.firstName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.firstName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:i.lastName,onChange:e=>A("lastName",e.target.value),className:"input-field ".concat(C.lastName?"border-error-500":""),placeholder:"Doe"}),C.lastName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.lastName})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:i.email,onChange:e=>A("email",e.target.value),className:"input-field pl-10 ".concat(C.email?"border-error-500":""),placeholder:"john@example.com"})]}),C.email&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Phone Number"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"tel",value:i.phoneNumber,onChange:e=>A("phoneNumber",e.target.value),className:"input-field pl-10 ".concat(C.phoneNumber?"border-error-500":""),placeholder:"+1 (555) 123-4567"})]}),C.phoneNumber&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.phoneNumber})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:u?"text":"password",value:i.password,onChange:e=>A("password",e.target.value),className:"input-field pr-10 ".concat(C.password?"border-error-500":""),placeholder:"••••••••"}),(0,a.jsx)("button",{type:"button",onClick:()=>y(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:u?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),C.password&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.password})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Confirm Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:j?"text":"password",value:i.confirmPassword,onChange:e=>A("confirmPassword",e.target.value),className:"input-field pr-10 ".concat(C.confirmPassword?"border-error-500":""),placeholder:"••••••••"}),(0,a.jsx)("button",{type:"button",onClick:()=>b(!j),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:j?(0,a.jsx)(d.Z,{className:"w-5 h-5 text-text-secondary"}):(0,a.jsx)(m.Z,{className:"w-5 h-5 text-text-secondary"})})]}),C.confirmPassword&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.confirmPassword})]}),(0,a.jsx)("button",{type:"submit",className:"w-full btn-primary",children:"Continue to Organization"})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-center text-text-primary",children:"Organization Details"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Organization Name"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"text",value:i.organizationName,onChange:e=>A("organizationName",e.target.value),className:"input-field pl-10 ".concat(C.organizationName?"border-error-500":""),placeholder:"Acme Corporation"})]}),C.organizationName&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.organizationName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Industry"}),(0,a.jsxs)("select",{value:i.industry,onChange:e=>A("industry",e.target.value),className:"input-field ".concat(C.industry?"border-error-500":""),children:[(0,a.jsx)("option",{value:"",children:"Select your industry"}),(0,a.jsx)("option",{value:"Technology",children:"Technology"}),(0,a.jsx)("option",{value:"Healthcare",children:"Healthcare"}),(0,a.jsx)("option",{value:"Finance",children:"Finance"}),(0,a.jsx)("option",{value:"Retail",children:"Retail"}),(0,a.jsx)("option",{value:"Real Estate",children:"Real Estate"}),(0,a.jsx)("option",{value:"Education",children:"Education"}),(0,a.jsx)("option",{value:"Manufacturing",children:"Manufacturing"}),(0,a.jsx)("option",{value:"Hospitality",children:"Hospitality"}),(0,a.jsx)("option",{value:"Marketing",children:"Marketing"}),(0,a.jsx)("option",{value:"Consulting",children:"Consulting"}),(0,a.jsx)("option",{value:"Other",children:"Other"})]}),C.industry&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:C.industry})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>w(1),className:"flex-1 btn-secondary",children:"Back"}),(0,a.jsx)("button",{type:"submit",disabled:N,className:"flex-1 btn-primary",children:N?"Creating Account...":"Create Account"})]})]})}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("p",{className:"text-text-secondary",children:["Already have an account?"," ",(0,a.jsx)("button",{onClick:s,className:"text-primary-600 hover:text-primary-700 font-medium",children:"Sign in"})]})})]})})}var j=s(65302),b=s(32660);function N(e){let{onBack:t}=e,[s,i]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),g=e=>/\S+@\S+\.\S+/.test(e),y=async e=>{if(e.preventDefault(),!s.trim()){p("Email is required");return}if(!g(s)){p("Please enter a valid email address");return}d(!0),p("");try{let{error:e}=await l.OQ.auth.resetPasswordForEmail(s,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(e)throw e;u(!0),x.ZP.success("Password reset email sent!")}catch(e){console.error("Password reset error:",e),e.message.includes("rate limit")?p("Too many requests. Please wait a moment before trying again."):p(e.message||"Failed to send password reset email")}finally{d(!1)}},N=e=>{i(e),p("")};return m?(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md text-center",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-success-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(j.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary mb-2",children:"Check Your Email"}),(0,a.jsx)("p",{className:"text-text-secondary mb-4",children:"We've sent a password reset link to:"}),(0,a.jsx)("p",{className:"font-medium text-text-primary mb-6",children:s}),(0,a.jsxs)("div",{className:"card-light rounded-xl p-4 mb-6 text-left",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-2",children:"Next Steps:"}),(0,a.jsxs)("ol",{className:"text-sm text-text-secondary space-y-1",children:[(0,a.jsx)("li",{children:"1. Check your email inbox"}),(0,a.jsx)("li",{children:"2. Click the reset password link"}),(0,a.jsx)("li",{children:"3. Create a new password"}),(0,a.jsx)("li",{children:"4. Sign in with your new password"})]})]}),(0,a.jsx)("button",{onClick:t,className:"w-full btn-primary",children:"Back to Sign In"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:["Didn't receive the email? Check your spam folder or"," ",(0,a.jsx)("button",{onClick:()=>{u(!1),i("")},className:"text-primary-600 hover:text-primary-700 font-medium",children:"try again"})]})})]})}):(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-warning-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(o.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-text-primary",children:"Reset Your Password"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Enter your email address and we'll send you a link to reset your password"})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Email Address"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(o.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-secondary"}),(0,a.jsx)("input",{type:"email",value:s,onChange:e=>N(e.target.value),className:"input-field pl-10 ".concat(h?"border-error-500":""),placeholder:"john@example.com",autoComplete:"email"})]}),h&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-error-600 text-sm mt-1",children:h})]}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"w-full btn-primary",children:c?"Sending Reset Link...":"Send Reset Link"})]}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsxs)("button",{onClick:t,className:"flex items-center justify-center text-text-secondary hover:text-text-primary mx-auto",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"Back to Sign In"]})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 card-light rounded-xl",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Security Note"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"For your security, the password reset link will expire in 1 hour. If you don't see the email, check your spam folder."})]})]})})}var v=s(82431),f=s(30401);function w(e){let{type:t,contact:s,onSuccess:i,onBack:c}=e,[d,m]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),[j,b]=(0,r.useState)(0),[N,w]=(0,r.useState)("");(0,r.useEffect)(()=>{C()},[]),(0,r.useEffect)(()=>{if(j>0){let e=setTimeout(()=>b(j-1),1e3);return()=>clearTimeout(e)}},[j]);let C=async()=>{try{y(!0),w(""),await (0,l.k_)("twilio-verify",{method:"POST",body:JSON.stringify({action:"send",type:t,contact:s})}),x.ZP.success("Verification code sent to your ".concat(t)),b(60)}catch(e){console.error("Error sending verification code:",e),x.ZP.error("Failed to send verification code: ".concat(e.message)),w(e.message)}finally{y(!1)}},_=async()=>{if(6!==d.length){w("Please enter a 6-digit code");return}try{h(!0),w(""),(await (0,l.k_)("twilio-verify",{method:"POST",body:JSON.stringify({action:"verify",type:t,contact:s,code:d})})).verified?(x.ZP.success("".concat(t," verified successfully!")),i()):w("Invalid verification code")}catch(e){console.error("Error verifying code:",e),w(e.message||"Verification failed")}finally{h(!1)}},k=e=>{let t=e.replace(/\D/g,"").slice(0,6);m(t),w(""),6===t.length&&setTimeout(()=>_(),100)};return(0,a.jsx)("div",{className:"min-h-screen auth-bg flex items-center justify-center p-4",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:"phone"===t?(0,a.jsx)(p.Z,{className:"w-8 h-8 text-white"}):(0,a.jsx)(o.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsxs)("h1",{className:"text-2xl font-bold text-text-primary",children:["Verify Your ","phone"===t?"Phone Number":"Email"]}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"We've sent a 6-digit code to"}),(0,a.jsx)("p",{className:"font-medium text-text-primary mt-1",children:s})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-4 text-center",children:"Enter Verification Code"}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("input",{type:"text",value:d,onChange:e=>k(e.target.value),className:"text-center text-2xl font-mono tracking-widest w-48 py-4 border-2 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200 bg-bg-secondary text-text-primary ".concat(N?"border-error-500":"border-border-subtle"),placeholder:"123456",maxLength:6,autoComplete:"one-time-code"})}),N&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-error-600 text-sm mt-2 text-center",children:N})]}),(0,a.jsx)("button",{onClick:_,disabled:u||6!==d.length,className:"w-full btn-primary mb-4 disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Verify Code"]})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-text-secondary text-sm mb-2",children:"Didn't receive the code?"}),(0,a.jsx)("button",{onClick:C,disabled:g||j>0,className:"text-primary-600 hover:text-primary-700 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:g?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-1 animate-spin"}),"Sending..."]}):j>0?"Resend in ".concat(j,"s"):"Resend Code"})]}),c&&(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsx)("button",{onClick:c,className:"text-text-secondary hover:text-text-primary text-sm",children:"← Back"})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mt-6 p-4 bg-bg-secondary rounded-xl border border-border-subtle",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Having trouble?"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"phone"===t?"Make sure your phone can receive SMS messages and check your spam folder.":"Check your email inbox and spam folder for the verification code."}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary mt-2",children:["Contact us at"," ",(0,a.jsx)("a",{href:"mailto:contact@karmaloop.ai",className:"text-primary-600 hover:text-primary-700",children:"contact@karmaloop.ai"})," ","if you need help."]})]})]})})}function C(e){let{onAuthSuccess:t}=e,[s,n]=(0,r.useState)("login"),[l,c]=(0,r.useState)(""),{actions:o}=(0,i.q)(),d=async()=>{console.log("\uD83D\uDE80 AuthWrapper handleAuthSuccess called"),console.log("✅ AuthWrapper delegating to auth state change handler"),t()},m=()=>{n("login")},x=()=>{d()};return(()=>{switch(s){case"login":default:return(0,a.jsx)(u,{onSuccess:d,onSwitchToSignup:()=>n("signup"),onForgotPassword:()=>n("forgot-password")});case"signup":return(0,a.jsx)(y,{onSuccess:m,onSwitchToLogin:()=>n("login")});case"forgot-password":return(0,a.jsx)(N,{onBack:()=>n("login")});case"verify-phone":return(0,a.jsx)(w,{type:"phone",contact:l,onSuccess:x,onBack:()=>n("login")});case"verify-email":return(0,a.jsx)(w,{type:"email",contact:l,onSuccess:x,onBack:()=>n("login")})}})()}var _=s(82222),k=s(95805),S=s(46221),Z=s(53417),D=s(82023),A=s(76858),E=s(11239);function I(e){let{onGetStarted:t}=e,s=[{icon:_.Z,title:"AI Voice Agents",description:"Create intelligent voice agents that can handle sales calls and customer support 24/7"},{icon:p.Z,title:"Outbound & Inbound",description:"Handle incoming customer calls and make outbound sales calls automatically"},{icon:k.Z,title:"CRM Integration",description:"Automatically log calls, update customer records, and track interactions"},{icon:S.Z,title:"Analytics & Reports",description:"Get insights into call performance, success rates, and customer interactions"}],i=[{number:1,title:"Configure Your Agent",description:"Set up your business objective, target audience, and voice preferences"},{number:2,title:"Get Your Phone Number",description:"Acquire a dedicated phone number for your AI voice agent"},{number:3,title:"Go Live",description:"Your agent starts handling calls immediately"}];return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-12",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-16",children:[(0,a.jsx)(n.E.div,{initial:{scale:.9},animate:{scale:1},transition:{delay:.1},className:"w-20 h-20 bg-primary-600 rounded-3xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(Z.Z,{className:"w-10 h-10 text-white"})}),(0,a.jsxs)(n.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-4xl md:text-5xl font-bold text-neutral-900 mb-4",children:["Welcome to"," ",(0,a.jsx)("span",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"Kai"})]}),(0,a.jsx)(n.E.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"text-xl text-neutral-600 mb-8 max-w-2xl mx-auto",children:"Transform your business with AI voice agents that handle sales calls and customer support with the intelligence and personality of your best team members."}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"flex items-center justify-center space-x-2 mb-8",children:[(0,a.jsx)(D.Z,{className:"w-5 h-5 text-warning-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-neutral-700",children:"14-day free trial • 100 minutes included • No credit card required"})]}),(0,a.jsxs)(n.E.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Set Up First Agent clicked"),t()},type:"button",className:"btn-primary text-lg px-8 py-4 group",children:["Set Up Your First Agent",(0,a.jsx)(A.Z,{className:"w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform"})]})]}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.6},className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16",children:s.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7+.1*t},className:"card text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(s,{className:"w-6 h-6 text-primary-600"})}),(0,a.jsx)("h3",{className:"text-lg font-bold text-neutral-900 mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-neutral-600 text-sm",children:e.description})]},e.title)})}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.8},className:"text-center mb-16",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-neutral-900 mb-4",children:"Get Started in 3 Simple Steps"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-12 max-w-2xl mx-auto",children:"Setting up your AI voice agent is quick and easy. You'll be handling calls in minutes."}),(0,a.jsx)("div",{className:"grid md:grid-cols-3 gap-8",children:i.map((e,t)=>(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9+.1*t},className:"relative",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("span",{className:"text-2xl font-bold text-white",children:e.number})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-neutral-900 mb-3",children:e.title}),(0,a.jsx)("p",{className:"text-neutral-600",children:e.description}),t<i.length-1&&(0,a.jsx)("div",{className:"hidden md:block absolute top-8 left-full w-full h-0.5 bg-gradient-to-r from-primary-300 to-transparent -translate-x-8"})]},e.number))})]}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:1},className:"card bg-gradient-to-r from-primary-600 to-secondary-600 text-white text-center",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsx)(E.Z,{className:"w-12 h-12 mx-auto mb-6 text-warning-300"}),(0,a.jsx)("h2",{className:"text-3xl font-bold mb-4",children:"Why Choose Kai?"}),(0,a.jsx)("p",{className:"text-primary-100 mb-8 text-lg",children:"Our AI voice agents are trained specifically for sales and customer support, with British charm and intelligence that converts prospects into customers."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 text-left",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(j.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"24/7 Availability"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"Never miss a call or opportunity"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(j.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Instant Responses"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"No wait times for customers"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(j.Z,{className:"w-6 h-6 text-success-300 mt-1 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium mb-1",children:"Cost Effective"}),(0,a.jsx)("p",{className:"text-primary-100 text-sm",children:"Fraction of hiring a sales team"})]})]})]})]})})]})})}var T=s(5095),P=s(58896),O=s(25846),z=s(81706),M=s(15001),F=s(22252),L=s(47692);function R(e){let{onComplete:t,onBack:s,onLogout:i}=e,[c,o]=(0,r.useState)(1),[d,m]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)([{id:"phone",title:"Acquiring phone number",status:"pending"},{id:"agent",title:"Creating AI agent",status:"pending"},{id:"setup",title:"Configuring voice settings",status:"pending"},{id:"deploy",title:"Deploying to production",status:"pending"}]),[N,f]=(0,r.useState)({name:"",description:"",voiceId:"Savannah",businessObjective:"",targetAudience:"",keyPainPoints:"",valuePropositon:"",callToAction:"",firstMessage:""}),[w,C]=(0,r.useState)({}),k=[{id:1,title:"Agent Identity",description:"Give your agent a name and personality",icon:_.Z},{id:2,title:"Business Setup",description:"Define your business objective and audience",icon:P.Z},{id:3,title:"Value Proposition",description:"Explain what makes you unique",icon:O.Z},{id:4,title:"Voice & Launch",description:"Choose voice and get your phone number",icon:z.Z}],S=(e,t,s)=>{y(a=>a.map(a=>a.id===e?{...a,status:t,error:s}:a))},Z=e=>{let t={};switch(e){case 1:N.name.trim()||(t.name="Agent name is required");break;case 2:N.businessObjective.trim()||(t.businessObjective="Business objective is required"),N.targetAudience.trim()||(t.targetAudience="Target audience is required");break;case 3:N.keyPainPoints.trim()||(t.keyPainPoints="Key pain points are required"),N.valuePropositon.trim()||(t.valuePropositon="Value proposition is required"),N.callToAction.trim()||(t.callToAction="Call to action is required")}return C(t),0===Object.keys(t).length},D=async()=>{if(Z(3)){m(!0),h(!0),y(e=>e.map(e=>({...e,status:"pending",error:void 0})));try{S("phone","loading");let e=(await Promise.race([(0,l.k_)("acquire-phone-number",{method:"POST",body:JSON.stringify({action:"search"})}),new Promise((e,t)=>setTimeout(()=>t(Error("Phone number search timed out. Please try again.")),3e4))])).availableNumbers;if(!e||0===e.length)throw Error("No phone numbers available in your area. Please contact support.");let s=await Promise.race([(0,l.k_)("acquire-phone-number",{method:"POST",body:JSON.stringify({action:"purchase",phoneNumberSid:e[0].phoneNumber})}),new Promise((e,t)=>setTimeout(()=>t(Error("Phone number purchase timed out. Please try again.")),3e4))]);S("phone","completed"),S("agent","loading"),await Promise.race([(0,l.k_)("create-agent",{method:"POST",body:JSON.stringify({name:N.name,description:N.description,voiceId:N.voiceId,businessObjective:N.businessObjective,targetAudience:N.targetAudience,keyPainPoints:N.keyPainPoints,valuePropositon:N.valuePropositon,callToAction:N.callToAction,firstMessage:N.firstMessage,phoneNumberId:s.phoneNumber.id})}),new Promise((e,t)=>setTimeout(()=>t(Error("Agent creation timed out. Please try again.")),45e3))]),S("agent","completed"),S("setup","loading"),await new Promise(e=>setTimeout(e,1500)),S("setup","completed"),S("deploy","loading"),await new Promise(e=>setTimeout(e,1e3)),S("deploy","completed"),x.ZP.success("Your AI voice agent is now live!"),setTimeout(()=>{t()},1500)}catch(t){console.error("Error creating agent:",t);let e=g.find(e=>"loading"===e.status);e&&S(e.id,"error",t.message),x.ZP.error(t.message||"Failed to create agent"),m(!1)}}},E=(e,t)=>{f(s=>({...s,[e]:t})),w[e]&&C(t=>({...t,[e]:void 0}))};return u?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-bg-primary to-bg-secondary flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"card rounded-3xl shadow-strong p-8 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(_.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Creating Your Agent"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Please wait while we set up your AI voice agent"})]}),(0,a.jsx)("div",{className:"space-y-4 mb-8",children:g.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center ".concat("completed"===e.status?"bg-success-600 text-white":"loading"===e.status?"bg-primary-600 text-white":"error"===e.status?"bg-error-600 text-white":"bg-neutral-600 text-white"),children:["completed"===e.status&&(0,a.jsx)(j.Z,{className:"w-4 h-4"}),"loading"===e.status&&(0,a.jsx)(M.Z,{className:"w-4 h-4 animate-spin"}),"error"===e.status&&(0,a.jsx)(F.Z,{className:"w-4 h-4"}),"pending"===e.status&&(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat("error"===e.status?"text-error-600":"text-text-primary"),children:e.title}),e.error&&(0,a.jsx)("p",{className:"text-xs text-error-500 mt-1",children:e.error})]})]},e.id))}),(!d||g.some(e=>"error"===e.status))&&(0,a.jsx)("div",{className:"flex flex-col space-y-3",children:g.some(e=>"error"===e.status)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:D,className:"btn-primary w-full",disabled:d,children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Retrying..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Try Again"]})}),(0,a.jsx)("button",{onClick:()=>{h(!1),m(!1),o(1),y(e=>e.map(e=>({...e,status:"pending",error:void 0})))},className:"btn-secondary w-full",children:"Start Over"}),i&&(0,a.jsxs)("button",{onClick:i,className:"btn-ghost w-full flex items-center justify-center",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4 mr-2"}),"Logout & Start Fresh"]})]})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-bg-primary to-bg-secondary flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"card rounded-3xl shadow-strong p-8 w-full max-w-2xl",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-text-primary",children:"Set Up Your AI Agent"}),(0,a.jsxs)("span",{className:"text-sm text-text-tertiary",children:["Step ",c," of ",4]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:k.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(c>=e.id?"bg-primary-600 text-white":"bg-neutral-600 text-white"),children:c>e.id?(0,a.jsx)(j.Z,{className:"w-5 h-5"}):e.id}),t<k.length-1&&(0,a.jsx)("div",{className:"flex-1 h-1 mx-2 rounded ".concat(c>e.id?"bg-primary-600":"bg-neutral-600")})]},e.id))})]}),(0,a.jsx)(T.M,{mode:"wait",children:(()=>{switch(c){case 1:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(_.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Meet Your AI Agent"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Give your agent a name and describe what it does"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Agent Name"}),(0,a.jsx)("input",{type:"text",value:N.name,onChange:e=>E("name",e.target.value),className:"input-field ".concat(w.name?"border-error-500":""),placeholder:"e.g., Sarah - Sales Assistant"}),w.name&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Description (Optional)"}),(0,a.jsx)("textarea",{value:N.description,onChange:e=>E("description",e.target.value),className:"input-field resize-none",rows:3,placeholder:"Brief description of what this agent will do..."})]})]},"step1");case 2:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(P.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Business Objectives"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Help us understand your business goals and audience"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What is your main business objective?"}),(0,a.jsx)("textarea",{value:N.businessObjective,onChange:e=>E("businessObjective",e.target.value),className:"input-field resize-none ".concat(w.businessObjective?"border-error-500":""),rows:3,placeholder:"e.g., Generate qualified leads for our software consultancy services..."}),w.businessObjective&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.businessObjective})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Who is your target audience?"}),(0,a.jsx)("textarea",{value:N.targetAudience,onChange:e=>E("targetAudience",e.target.value),className:"input-field resize-none ".concat(w.targetAudience?"border-error-500":""),rows:3,placeholder:"e.g., CTOs and technical leaders at mid-size companies looking to modernize their systems..."}),w.targetAudience&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.targetAudience})]})]},"step2");case 3:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(O.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Value Proposition"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Define what makes you unique and compelling"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What key pain points do you solve?"}),(0,a.jsx)("textarea",{value:N.keyPainPoints,onChange:e=>E("keyPainPoints",e.target.value),className:"input-field resize-none ".concat(w.keyPainPoints?"border-error-500":""),rows:3,placeholder:"e.g., Outdated systems slowing down operations, high technical debt, lack of automation..."}),w.keyPainPoints&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.keyPainPoints})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What's your unique value proposition?"}),(0,a.jsx)("textarea",{value:N.valuePropositon,onChange:e=>E("valuePropositon",e.target.value),className:"input-field resize-none ".concat(w.valuePropositon?"border-error-500":""),rows:3,placeholder:"e.g., We deliver modern, scalable solutions 3x faster than traditional agencies with guaranteed ROI..."}),w.valuePropositon&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.valuePropositon})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"What action do you want prospects to take?"}),(0,a.jsx)("textarea",{value:N.callToAction,onChange:e=>E("callToAction",e.target.value),className:"input-field resize-none ".concat(w.callToAction?"border-error-500":""),rows:3,placeholder:"e.g., Schedule a free 30-minute technical assessment call to discuss their specific needs..."}),w.callToAction&&(0,a.jsx)("p",{className:"text-error-600 text-sm mt-1",children:w.callToAction})]})]},"step3");case 4:return(0,a.jsxs)(n.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(z.Z,{className:"w-8 h-8 text-white"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-text-primary mb-2",children:"Voice & Launch"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Choose your agent's voice and we'll get you a phone number"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-4",children:"Choose Voice"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>E("voiceId","Savannah"),className:"p-6 rounded-xl border-2 transition-all duration-200 text-left ".concat("Savannah"===N.voiceId?"border-primary-500 bg-primary-900/20":"border-border-subtle hover:border-primary-300 bg-bg-secondary"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary",children:"Sandra"}),(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat("Savannah"===N.voiceId?"border-primary-500 bg-primary-500":"border-neutral-400")})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-3",children:"Professional, warm, and confident voice perfect for sales and customer service"}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-text-tertiary",children:[(0,a.jsx)(z.Z,{className:"w-3 h-3 mr-1"}),"British accent, friendly tone"]})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>E("voiceId","Elliot"),className:"p-6 rounded-xl border-2 transition-all duration-200 text-left ".concat("Elliot"===N.voiceId?"border-primary-500 bg-primary-900/20":"border-border-subtle hover:border-primary-300 bg-bg-secondary"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary",children:"Jackson"}),(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat("Elliot"===N.voiceId?"border-primary-500 bg-primary-500":"border-neutral-400")})]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-3",children:"Authoritative and trustworthy voice ideal for technical and business discussions"}),(0,a.jsxs)("div",{className:"flex items-center text-xs text-text-tertiary",children:[(0,a.jsx)(z.Z,{className:"w-3 h-3 mr-1"}),"British accent, professional tone"]})]})]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-2 text-center",children:"More voice options coming soon!"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"First Message (Introduction)"}),(0,a.jsx)("input",{type:"text",value:N.firstMessage,onChange:e=>E("firstMessage",e.target.value),className:"input-field",placeholder:"Hi there, my name is ".concat(N.name||"[Agent Name]",", from [Your Company]. How are you today?")}),(0,a.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"This is the first thing your agent will say when answering calls. Leave blank for the default introduction."})]}),(0,a.jsx)("div",{className:"bg-primary-900/20 border border-primary-500/30 rounded-xl p-6",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(p.Z,{className:"w-6 h-6 text-primary-400 mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Phone Number Setup"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mb-3",children:"We'll automatically acquire a US phone number for your agent and configure it for inbound calls. For outbound calling, you'll add contacts in the CRM section."}),(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:"• Instant setup • US numbers only • Inbound calls ready immediately"})]})]})})]},"step4");default:return null}})()}),(0,a.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,a.jsxs)("button",{onClick:()=>{c>1?o(c-1):s()},className:"btn-secondary flex items-center",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Back"]}),c<4?(0,a.jsxs)("button",{onClick:()=>{Z(c)&&o(c+1)},className:"btn-primary flex items-center",children:["Continue",(0,a.jsx)(A.Z,{className:"w-4 h-4 ml-2"})]}):(0,a.jsx)("button",{onClick:D,disabled:d,className:"btn-primary flex items-center",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating Agent..."]}):(0,a.jsxs)(a.Fragment,{children:["Launch Agent",(0,a.jsx)(A.Z,{className:"w-4 h-4 ml-2"})]})})]})]})})}var U=s(12194),q=s(91723),J=s(16524),K=s(22839),Q=s(37829),B=s(64972),G=s(82718);function V(e){var t,s;let{organizationId:i}=e,[l,c]=(0,r.useState)(""),[o,d]=(0,r.useState)("outbound"),[m,x]=(0,r.useState)(""),[u,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)(null),[j,b]=(0,r.useState)([]),[N,v]=(0,r.useState)(!1),f=async()=>{if(!l){alert("Please select a contact to test");return}p(!0),y(null);try{console.log("\uD83E\uDDEA Testing call context with:",{contactId:l,organizationId:i,callType:o,customObjective:m});let e=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/build-call-context",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify({contactId:l,organizationId:i,callType:o,customObjective:m||void 0})}),t=await e.json();y(t),t.success?(console.log("✅ Call context test successful!"),console.log("Context:",t.context),console.log("Introduction:",t.introduction),console.log("VAPI Context:",t.vapiContext)):console.error("❌ Call context test failed:",t.error)}catch(e){console.error("❌ Test error:",e),y({success:!1,error:e instanceof Error?e.message:String(e)})}finally{p(!1)}};return r.useEffect(()=>{b([{id:"sample-contact-1",first_name:"John",last_name:"Doe",phone_number:"+1234567890",company:"Sample Corp"}])},[]),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(Q.Z,{className:"w-6 h-6 text-blue-600"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Call Context System Test"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Test the new call context system that provides agents with rich context about contacts."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact ID to Test (use a real contact ID from your database)"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Enter contact UUID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Go to your Supabase dashboard → contacts table to find a real contact ID"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Call Type"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",value:"outbound",checked:"outbound"===o,onChange:e=>d("outbound"),className:"mr-2"}),"Outbound Call"]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",value:"inbound",checked:"inbound"===o,onChange:e=>d("inbound"),className:"mr-2"}),"Inbound Call"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Objective (Optional)"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value),placeholder:"e.g., Discuss pricing for enterprise plan",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsx)("button",{onClick:f,disabled:u||!l,className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Testing Call Context..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-2"}),"Test Call Context"]})})]}),g&&(0,a.jsx)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-6",children:g.success?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"text-green-600 font-medium",children:"✅ Test Successful!"})})}),g.context&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Contact Context"]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md text-sm",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Name:"})," ",g.context.contact.name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Company:"})," ",g.context.contact.company]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Relationship:"})," ",g.context.contact.relationshipStatus]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Total Calls:"})," ",g.context.contact.totalCalls]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Tags:"})," ",g.context.contact.tags.join(", ")||"None"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Priority:"})," ",g.context.contact.priority]})]}),g.context.contact.lastConversationSummary&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("strong",{children:"Last Conversation:"})," ",g.context.contact.lastConversationSummary]})]})]}),(null===(t=g.context)||void 0===t?void 0:t.objectives)&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Call Objectives"]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Primary Goal:"})," ",g.context.objectives.primaryGoal]}),g.context.objectives.talkingPoints.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("strong",{children:"Talking Points:"}),(0,a.jsx)("ul",{className:"list-disc list-inside ml-2",children:g.context.objectives.talkingPoints.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]})]})]}),g.introduction&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2"}),"Generated Introduction"]}),(0,a.jsx)("div",{className:"bg-purple-50 p-3 rounded-md text-sm",children:(0,a.jsxs)("em",{children:["“",g.introduction,"”"]})})]}),g.vapiContext&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-2"}),"VAPI Context (System Prompt Preview)"]}),(0,a.jsx)("div",{className:"bg-indigo-50 p-3 rounded-md text-sm",children:(0,a.jsxs)("div",{className:"whitespace-pre-wrap text-xs",children:[g.vapiContext.model.messages[0].content.substring(0,500),"..."]})})]}),g.debug&&(0,a.jsxs)("details",{className:"mt-4",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:"View Debug Information"}),(0,a.jsx)("pre",{className:"mt-2 p-3 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(g.debug,null,2)})]})]}):(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[(0,a.jsx)("div",{className:"text-red-600 font-medium",children:"❌ Test Failed"}),(0,a.jsx)("div",{className:"text-red-700 text-sm mt-1",children:g.error}),(null===(s=g.error)||void 0===s?void 0:s.includes("details"))&&(0,a.jsxs)("details",{className:"mt-2",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-xs text-red-600",children:"View Details"}),(0,a.jsx)("pre",{className:"mt-1 text-xs",children:JSON.stringify(g,null,2)})]})]})}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[(0,a.jsx)("h4",{className:"font-medium text-yellow-800",children:"How This Test Works"}),(0,a.jsxs)("div",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:[(0,a.jsx)("div",{children:"1. Enter a real contact ID from your database"}),(0,a.jsx)("div",{children:"2. System builds rich context including tags, call history, and objectives"}),(0,a.jsx)("div",{children:"3. Generates an intelligent introduction based on previous conversations"}),(0,a.jsx)("div",{children:"4. Creates VAPI-compatible context for voice agents"})]}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-yellow-700",children:[(0,a.jsx)("strong",{children:"To get a contact ID:"})," Go to Supabase Dashboard → Table Editor → contacts → copy an ID"]})]})]})}var X=s(15863),W=s(44743);function Y(e){let{organizationId:t,userId:s,onStrategyCreated:i}=e,[l,c]=(0,r.useState)([]),[o,d]=(0,r.useState)(""),[m,x]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),[b,N]=(0,r.useState)(null),[v,f]=(0,r.useState)(!1),w=(0,r.useRef)(null),C=()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{C()},[l]);let k=async()=>{y(!0);try{let e=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/kai-chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify({action:"start_conversation",organizationId:t,userId:s})}),a=await e.json();a.success?(x(a.conversation.id),c([{role:"assistant",content:a.message,timestamp:new Date().toISOString()}])):console.error("Failed to start conversation:",a.error)}catch(e){console.error("Error starting conversation:",e)}finally{y(!1)}},S=async()=>{if(!o.trim()||!m||u)return;let e=o.trim();d(""),p(!0);let a={role:"user",content:e,timestamp:new Date().toISOString()};c(e=>[...e,a]);try{let a=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/kai-chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify({action:"send_message",message:e,conversationId:m,organizationId:t,userId:s})}),r=await a.json();if(r.success){let e={role:"assistant",content:r.message,timestamp:new Date().toISOString()};c(t=>[...t,e]),r.extractedStrategy&&(N(r.extractedStrategy),f(!0),null==i||i(r.extractedStrategy))}else console.error("Failed to send message:",r.error)}catch(e){console.error("Error sending message:",e)}finally{p(!1)}};return m?(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 flex flex-col h-[600px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"Kai"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:v?"Strategy Created":"Creating Your Strategy"})]})]}),v&&(0,a.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 mr-1"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Complete"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsx)(T.M,{children:l.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3 max-w-[80%] ".concat("user"===e.role?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ".concat("user"===e.role?"bg-gray-100":"bg-gradient-to-br from-purple-500 to-blue-600"),children:"user"===e.role?(0,a.jsx)(h.Z,{className:"w-4 h-4 text-gray-600"}):(0,a.jsx)(_.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{className:"p-3 rounded-lg ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap text-sm",children:e.content}),(0,a.jsx)("div",{className:"text-xs mt-1 opacity-70 ".concat("user"===e.role?"text-blue-100":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},t))}),u&&(0,a.jsx)(n.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("div",{className:"bg-gray-100 p-3 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(X.Z,{className:"w-4 h-4 animate-spin text-gray-600"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Kai is thinking..."})]})})]})}),(0,a.jsx)("div",{ref:w})]}),b&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"border-t border-gray-200 p-4 bg-green-50",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-green-600 mr-2"}),(0,a.jsx)("h4",{className:"font-medium text-green-900",children:"Strategy Created"})]}),(0,a.jsxs)("div",{className:"text-sm text-green-800 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Target:"})," ",b.targetAudience.join(", ")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Goals:"})," ",b.communicationGoals.join(", ")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Frequency:"})," ",b.frequency]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Confidence:"})," ",Math.round(100*b.confidence),"%"]})]})]}),!v&&(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())},placeholder:"Tell Kai about your outbound strategy...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",disabled:u}),(0,a.jsx)("button",{onClick:S,disabled:!o.trim()||u,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:(0,a.jsx)(W.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Press Enter to send • Shift+Enter for new line"})]})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-8 h-8 text-white"})})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Meet Kai"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Your intelligent controller agent that helps create personalized outbound communication strategies through conversation."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 mb-8 text-sm",children:[(0,a.jsxs)("div",{className:"p-4 bg-purple-50 rounded-lg",children:[(0,a.jsx)(D.Z,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-purple-900",children:"Smart Analysis"}),(0,a.jsx)("p",{className:"text-purple-700",children:"Analyzes your contacts and call history"})]}),(0,a.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)(G.Z,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-blue-900",children:"Natural Conversation"}),(0,a.jsx)("p",{className:"text-blue-700",children:"Talk naturally about your business goals"})]}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)(j.Z,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-green-900",children:"Automated Strategy"}),(0,a.jsx)("p",{className:"text-green-700",children:"Creates and executes outbound plans"})]})]}),(0,a.jsx)("button",{onClick:k,disabled:g,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-medium hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center mx-auto",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Starting conversation..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Start Strategy Discussion"]})})]})}function H(e){var t,s,i,l,c;let{organizationId:o,userId:d}=e,[m,x]=(0,r.useState)("chat"),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(null),N=async()=>{g(!0),h(null);try{console.log("\uD83E\uDDEA Testing Kai API with:",{organizationId:o,userId:d});let e=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/kai-chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify({action:"start_conversation",organizationId:o,userId:d})}),t=await e.json();h(t),t.success?(console.log("✅ Kai API test successful!"),console.log("Conversation:",t.conversation),console.log("Message:",t.message)):console.error("❌ Kai API test failed:",t.error)}catch(e){console.error("❌ Test error:",e),h({success:!1,error:e instanceof Error?e.message:String(e)})}finally{g(!1)}};return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Controller Agent “Kai” Test"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:"Test the new Controller Agent “Kai” that creates outbound communication strategies through natural conversation."}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsxs)("button",{onClick:()=>x("chat"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("chat"===m?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2 inline"}),"Full Chat Interface"]}),(0,a.jsxs)("button",{onClick:()=>x("api"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("api"===m?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,a.jsx)(Q.Z,{className:"w-4 h-4 mr-2 inline"}),"API Test Only"]})]}),"api"===m&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("button",{onClick:N,disabled:p,className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Testing Kai API..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Q.Z,{className:"w-4 h-4 mr-2"}),"Test Kai API"]})}),u&&(0,a.jsx)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4",children:u.success?(0,a.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 text-green-600 mr-2"}),(0,a.jsx)("div",{className:"text-green-600 font-medium",children:"✅ API Test Successful!"})]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-green-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Conversation ID:"})," ",null===(t=u.conversation)||void 0===t?void 0:t.id]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Status:"})," ",null===(s=u.conversation)||void 0===s?void 0:s.current_status]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("strong",{children:"Kai’s Welcome Message:"}),(0,a.jsxs)("div",{className:"mt-1 p-2 bg-white rounded border text-gray-800 text-xs",children:[null===(i=u.message)||void 0===i?void 0:i.substring(0,200),"..."]})]})]})]}):(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(F.Z,{className:"w-5 h-5 text-red-600 mr-2"}),(0,a.jsx)("div",{className:"text-red-600 font-medium",children:"❌ API Test Failed"})]}),(0,a.jsx)("div",{className:"text-red-700 text-sm mt-1",children:u.error})]})})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 mt-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-purple-50 rounded-lg",children:[(0,a.jsx)(D.Z,{className:"w-6 h-6 text-purple-600 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-purple-900",children:"Intelligent Analysis"}),(0,a.jsx)("p",{className:"text-sm text-purple-700",children:"Analyzes your contact database and business context"})]}),(0,a.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,a.jsx)(G.Z,{className:"w-6 h-6 text-blue-600 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-blue-900",children:"Natural Language"}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"Configure strategies through conversation"})]}),(0,a.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,a.jsx)(_.Z,{className:"w-6 h-6 text-green-600 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-green-900",children:"Autonomous Execution"}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:"Automatically schedules and manages outbound calls"})]})]})]}),"chat"===m&&(0,a.jsx)(Y,{organizationId:o,userId:d,onStrategyCreated:e=>{b(e),console.log("\uD83C\uDFAF Strategy created by Kai:",e)}}),y&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)(j.Z,{className:"w-6 h-6 text-green-600 mr-2"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Strategy Created Successfully!"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Target Audience"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:(null===(l=y.targetAudience)||void 0===l?void 0:l.join(", "))||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Communication Goals"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:(null===(c=y.communicationGoals)||void 0===c?void 0:c.join(", "))||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Frequency"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded",children:y.frequency||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Confidence Score"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded",children:[Math.round(100*(y.confidence||0)),"%"]})]})]}),y.specialInstructions&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Special Instructions"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded text-sm",children:y.specialInstructions})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-yellow-800",children:"How Kai Works"}),(0,a.jsxs)("div",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:[(0,a.jsx)("div",{children:"1. **Chat Interface**: Have a natural conversation about your outbound goals"}),(0,a.jsx)("div",{children:"2. **Smart Analysis**: Kai analyzes your contact database and business context"}),(0,a.jsx)("div",{children:"3. **Strategy Creation**: Automatically generates structured outbound strategies"}),(0,a.jsx)("div",{children:"4. **Execution Planning**: (Next phase) Schedules and manages outbound calls"})]}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-yellow-700",children:[(0,a.jsx)("strong",{children:"Try saying:"})," “I want to follow up with leads weekly” or “Help me create a sales outreach strategy”"]})]})]})}function $(e){let{onNavigate:t}=e,{state:s}=(0,i.q)(),{profile:c,subscription:o,agents:d,contacts:m}=s,[x,u]=(0,r.useState)(null),[h,g]=(0,r.useState)([]),[y,b]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(null==c?void 0:c.organization_id)&&N()},[c]);let N=async()=>{try{b(!0);let{data:e}=await l.OQ.rpc("get_organization_stats",{org_id:null==c?void 0:c.organization_id});if(e&&e.length>0){let t=e[0];u({totalCalls:t.total_calls||0,successfulCalls:t.successful_calls||0,totalMinutes:t.total_minutes||0,totalContacts:t.total_contacts||0,activeAgents:t.active_agents||0,minutesRemaining:t.minutes_remaining||0,callsToday:0,successRateToday:0})}let{data:t}=await l.OQ.from("calls").select("\n          id,\n          direction,\n          outcome,\n          duration_seconds,\n          started_at,\n          from_number,\n          to_number,\n          contacts (first_name, last_name),\n          agents (name)\n        ").eq("organization_id",null==c?void 0:c.organization_id).order("created_at",{ascending:!1}).limit(10);if(t){let e=t.map(e=>{let t=Array.isArray(e.contacts)?e.contacts[0]:e.contacts,s=Array.isArray(e.agents)?e.agents[0]:e.agents;return{id:e.id,contact_name:t?"".concat(t.first_name||""," ").concat(t.last_name||"").trim():"inbound"===e.direction?e.from_number:e.to_number,phone_number:"inbound"===e.direction?e.from_number:e.to_number,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,agent_name:(null==s?void 0:s.name)||"Unknown"}});g(e);let s=new Date().toDateString(),a=e.filter(e=>new Date(e.started_at).toDateString()===s),i=a.filter(e=>"success"===e.outcome).length;u(e=>e?{...e,callsToday:a.length,successRateToday:a.length>0?i/a.length*100:0}:null)}}catch(e){console.error("Error fetching dashboard data:",e)}finally{b(!1)}},v=[{title:"Total Calls",value:(null==x?void 0:x.totalCalls)||0,icon:U.Z,color:"primary",trend:(null==x?void 0:x.callsToday)?"+".concat(x.callsToday," today"):"No calls today"},{title:"Success Rate",value:x&&x.totalCalls>0?"".concat(Math.round(x.successfulCalls/x.totalCalls*100),"%"):"0%",icon:j.Z,color:"success",trend:"".concat(Math.round((null==x?void 0:x.successRateToday)||0),"% today")},{title:"Minutes Used",value:"".concat((null==x?void 0:x.totalMinutes)||0,"m"),icon:q.Z,color:"warning",trend:"".concat(Math.max(0,((null==o?void 0:o.minutes_included)||100)-((null==x?void 0:x.totalMinutes)||0)),"m remaining")},{title:"Contacts",value:(null==x?void 0:x.totalContacts)||0,icon:k.Z,color:"secondary",trend:"Total in CRM"}];return y?(0,a.jsx)("div",{className:"space-y-8",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"card animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-neutral-600 rounded w-1/2 mb-4"}),(0,a.jsx)("div",{className:"h-8 bg-neutral-600 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-neutral-600 rounded w-1/4"})]},e))})}):(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"dashboard-header",children:[(0,a.jsxs)(n.E.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"dashboard-title",children:["Welcome back, ",null==c?void 0:c.first_name,"! \uD83D\uDC4B"]}),(0,a.jsx)("p",{className:"dashboard-subtitle",children:"Here's what's happening with your AI voice agents today."})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"kpi-card p-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(s,{className:"w-6 h-6"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:e.title}),(0,a.jsx)("p",{className:"kpi-value",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-white/90",children:e.trend})]})]},e.title)})}),o&&(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"trial-banner p-6 rounded-2xl ".concat("trial"===o.status?"border-warning-200":"border-success-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(F.Z,{className:"w-6 h-6 ".concat("trial"===o.status?"text-warning-600":"text-success-600")}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-medium text-text-primary capitalize",children:[o.status," Account"]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"trial"===o.status?"Trial ends ".concat(new Date(o.trial_end_date).toLocaleDateString()):"Active subscription"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-text-primary",children:[(null==x?void 0:x.totalMinutes)||0," / ",o.minutes_included," minutes"]}),(0,a.jsx)("div",{className:"w-32 h-2 bg-neutral-200 rounded-full mt-1",children:(0,a.jsx)("div",{className:"h-full rounded-full ".concat("trial"===o.status?"bg-warning-500":"bg-success-500"),style:{width:"".concat(Math.min(((null==x?void 0:x.totalMinutes)||0)/o.minutes_included*100,100),"%")}})})]})]})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Recent Calls"}),(0,a.jsx)("button",{onClick:()=>t("calls"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View All"})]}),h.length>0?(0,a.jsx)("div",{className:"space-y-4",children:h.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"icon-box w-10 h-10 ".concat((e.direction,"bg-primary-600")),children:"inbound"===e.direction?(0,a.jsx)(J.Z,{className:"w-5 h-5 text-white"}):(0,a.jsx)(K.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.contact_name||e.phone_number}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:[e.agent_name," • ",(0,l.LU)(e.duration_seconds)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(e.outcome)),children:e.outcome.replace("_"," ")}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:new Date(e.started_at).toLocaleTimeString()})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(U.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Your call history will appear here"})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Your Agents"}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Manage Agents"})]}),d.length>0?(0,a.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-4 p-3 hover:bg-bg-secondary rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"icon-box w-10 h-10",children:(0,a.jsx)(_.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"font-medium text-text-primary truncate",children:e.name}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(e.is_active&&e.phone_number?"bg-success-500":"bg-neutral-400")})]}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:e.phone_number?(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(p.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:(0,l.un)(e.phone_number)})]}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:"Savannah"===e.voice_id?"Sandra":"Jackson"})]}):(0,a.jsx)("span",{className:"text-warning-600",children:"No phone number assigned"})})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(e.is_active&&e.phone_number?"text-success-100 bg-success-800":"text-warning-100 bg-warning-800"),children:e.is_active&&e.phone_number?"Active":"Setup Required"}),(0,a.jsxs)("p",{className:"text-xs text-text-tertiary mt-1",children:[e.total_calls," calls",e.total_calls>0&&(0,a.jsxs)(a.Fragment,{children:[" • ",Math.round(e.successful_calls/e.total_calls*100),"% success"]})]})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(_.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No agents configured"}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"text-sm text-primary-600 hover:text-primary-700 font-medium mt-2",children:"Create Your First Agent"})]})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary mb-6",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>t("contacts"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(k.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Manage Contacts"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"View detailed contact communication timeline"})]}),(0,a.jsxs)("button",{onClick:()=>t("agents"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(_.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Create Agent"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Set up a new AI voice agent with enhanced tracking"})]}),(0,a.jsxs)("button",{onClick:()=>t("reports"),className:"p-4 border border-border-subtle rounded-xl hover:border-primary-300 hover:bg-bg-secondary transition-all duration-200 text-left",children:[(0,a.jsx)(S.Z,{className:"w-6 h-6 text-primary-600 mb-2"}),(0,a.jsx)("h3",{className:"font-medium text-text-primary mb-1",children:"Analytics"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Advanced call performance metrics"})]})]})]}),!1,(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1},className:"card bg-gradient-to-r from-primary-600 to-primary-700 text-white",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-2",children:"\uD83D\uDE80 Enhanced Features Available"}),(0,a.jsx)("p",{className:"text-primary-100 mb-4",children:"Your platform now includes advanced call tracking, detailed contact timelines, and enhanced security."}),(0,a.jsxs)("ul",{className:"text-sm text-primary-100 space-y-1",children:[(0,a.jsx)("li",{children:"• Comprehensive contact communication history"}),(0,a.jsx)("li",{children:"• Call recordings with full transcripts"}),(0,a.jsx)("li",{children:"• Enhanced VAPI integration with secure webhooks"}),(0,a.jsx)("li",{children:"• Real-time call data synchronization"})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("button",{onClick:()=>t("contacts"),className:"px-4 py-2 bg-white rounded-lg font-medium hover:bg-purple-50 transition-colors btn-custom-purple",children:"Try New CRM"})})]})})]})}var ee=s(45131),et=s(17689),es=s(99397),ea=s(73247),ei=s(31047),er=s(48736),en=s(2207),el=s(18930),ec=s(94630),eo=s(17684),ed=s(54887),em=s(32489),ex=s(89227),eu=s(33276),eh=s(92735),ep=s(35471),eg=s(45274),ey=s(51548),ej=s(88623);function eb(e){let{call:t,variant:s="compact",className:i=""}=e,[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(0),[g,y]=(0,r.useState)(0),[j,b]=(0,r.useState)(1),[N,v]=(0,r.useState)(!1),[f,w]=(0,r.useState)(!1),C=(0,r.useRef)(null),_=(0,r.useRef)(null),k=t.recording_url||"success"===t.outcome;(0,r.useEffect)(()=>{let e=C.current;if(!e)return;let t=()=>p(e.currentTime),s=()=>y(e.duration),a=()=>{o(!1),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)},i=()=>{u("Failed to load recording"),o(!1),m(!1),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)};return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",s),e.addEventListener("ended",a),e.addEventListener("error",i),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",s),e.removeEventListener("ended",a),e.removeEventListener("error",i),e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)}},[]);let S=async function(){var e;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stream";if(!(null===(e=(await l.OQ.auth.getSession()).data.session)||void 0===e?void 0:e.access_token))throw Error("Authentication required");return"".concat("".concat("https://ixeqedgrusamxwsvwoho.supabase.co","/functions/v1"),"/call-recording-proxy/").concat(t.id,"?type=stereo&action=").concat(s)},Z=async()=>{if(C.current)try{if(m(!0),u(null),C.current.src&&(C.current.src.startsWith("blob:")||C.current.readyState>=1))await C.current.play(),o(!0);else{var e;let t=await S("stream"),s=await l.OQ.auth.getSession(),a=await fetch(t,{headers:{Authorization:"Bearer ".concat(null===(e=s.data.session)||void 0===e?void 0:e.access_token)}});if(!a.ok)throw Error("Failed to load recording: ".concat(a.status," ").concat(a.statusText));let i=await a.blob(),r=URL.createObjectURL(i);C.current.src=r,await C.current.play(),o(!0),C.current.onended=()=>{o(!1),URL.revokeObjectURL(r)}}}catch(e){console.error("Error playing recording:",e),u(e.message||"Failed to play recording"),console.error("Failed to play recording")}finally{m(!1)}},D=()=>{C.current&&(C.current.pause(),o(!1))},A=e=>{if(C.current){let t=Math.max(0,Math.min(g,h+e));C.current.currentTime=t,p(t)}},E=async()=>{try{var e,s;w(!0);let a=await l.OQ.auth.getSession();if(!(null===(e=a.data.session)||void 0===e?void 0:e.access_token))throw Error("Authentication required");let i="".concat("".concat("https://ixeqedgrusamxwsvwoho.supabase.co","/functions/v1"),"/call-recording-proxy/").concat(t.id,"?type=stereo&action=download"),r=await fetch(i,{headers:{Authorization:"Bearer ".concat(a.data.session.access_token)}});if(!r.ok)throw Error("Failed to download recording");let n=await r.blob(),c=window.URL.createObjectURL(n),o=document.createElement("a");o.href=c;let d=r.headers.get("Content-Disposition"),m=(null==d?void 0:null===(s=d.match(/filename="(.+)"/))||void 0===s?void 0:s[1])||"call-recording-".concat(new Date(t.started_at||t.created_at).toISOString().split("T")[0],".mp3");o.download=m,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(c),console.log("Recording downloaded successfully")}catch(e){console.error("Error downloading recording:",e),console.error(e.message||"Failed to download recording")}finally{w(!1)}},I=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return k?"compact"===s?(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,a.jsx)("button",{onClick:c?D:Z,disabled:d,className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-50",title:c?"Pause recording":"Play recording",children:d?(0,a.jsx)(M.Z,{className:"w-4 h-4 animate-spin"}):c?(0,a.jsx)(ex.Z,{className:"w-4 h-4"}):(0,a.jsx)(eu.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:E,disabled:f,className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors disabled:opacity-50",title:"Download recording",children:f?(0,a.jsx)(M.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(eh.Z,{className:"w-4 h-4"})}),x&&(0,a.jsx)("div",{title:x,children:(0,a.jsx)(F.Z,{className:"w-4 h-4 text-accent-error"})}),(0,a.jsx)("audio",{ref:C,preload:"none"})]}):(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-4 ".concat(i),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(ep.Z,{className:"w-5 h-5 text-indigo-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-text-primary",children:"Call Recording"}),(0,a.jsxs)("p",{className:"text-sm text-text-secondary",children:[new Date(t.started_at||t.created_at).toLocaleString()," • ",Math.floor(t.duration_seconds/60),"min"]})]})]}),x?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8 text-red-600",children:[(0,a.jsx)(F.Z,{className:"w-6 h-6 mr-2"}),(0,a.jsx)("span",{children:x})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>A(-10),className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"Skip back 10s",children:(0,a.jsx)(eg.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:c?D:Z,disabled:d,className:"p-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors disabled:opacity-50",title:c?"Pause":"Play",children:d?(0,a.jsx)(M.Z,{className:"w-6 h-6 animate-spin"}):c?(0,a.jsx)(ex.Z,{className:"w-6 h-6"}):(0,a.jsx)(eu.Z,{className:"w-6 h-6"})}),(0,a.jsx)("button",{onClick:()=>A(10),className:"p-2 text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"Skip forward 10s",children:(0,a.jsx)(ey.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("input",{ref:_,type:"range",min:0,max:g||0,value:h,onChange:e=>{let t=parseFloat(e.target.value);C.current&&(C.current.currentTime=t,p(t))},className:"w-full audio-slider"}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-text-secondary",children:[(0,a.jsx)("span",{children:I(h)}),(0,a.jsx)("span",{children:I(g)})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{if(C.current){let e=!N;v(e),C.current.volume=e?0:j}},className:"p-1 text-neutral-600 hover:bg-neutral-50 rounded transition-colors",title:N?"Unmute":"Mute",children:N?(0,a.jsx)(ej.Z,{className:"w-4 h-4"}):(0,a.jsx)(z.Z,{className:"w-4 h-4"})}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.1,value:N?0:j,onChange:e=>{let t=parseFloat(e.target.value);b(t),v(0===t),C.current&&(C.current.volume=t)},className:"w-20 volume-slider"})]}),(0,a.jsxs)("button",{onClick:E,disabled:f,className:"btn-secondary flex items-center text-sm disabled:opacity-50",children:[f?(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(eh.Z,{className:"w-4 h-4 mr-2"}),"Download"]})]})]}),(0,a.jsx)("audio",{ref:C,preload:"none"})]}):null}function eN(e){var t,s;let{call:i,onClose:c}=e,[o,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>(x(!0),document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"}),[]);let u=(e,t)=>{let s="w-5 h-5";return"inbound"===e?(0,a.jsx)(J.Z,{className:s}):(0,a.jsx)(K.Z,{className:s})},p=(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:9999},onClick:e=>{e.target===e.currentTarget&&c()},children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-bg-primary rounded-xl max-w-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"p-6 border-b border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl ".concat("inbound"===i.direction?"bg-blue-100":"bg-green-100"),children:u(i.direction,i.outcome)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-text-primary",children:"Call Details"}),(0,a.jsx)("p",{className:"text-text-secondary",children:new Date(i.started_at).toLocaleString()})]})]}),(0,a.jsx)("button",{onClick:c,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",title:"Close",children:(0,a.jsx)(em.Z,{className:"w-5 h-5 text-text-secondary"})})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[o&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary mt-2",children:"Loading complete call data..."})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Direction:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[u(i.direction,i.outcome),(0,a.jsx)("span",{className:"capitalize text-text-primary font-medium",children:i.direction})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Duration:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.LU)(i.duration_seconds)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Outcome:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"success":return(0,a.jsx)(j.Z,{className:"w-5 h-5 text-green-600"});case"failure":case"error":return(0,a.jsx)(ee.Z,{className:"w-5 h-5 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(F.Z,{className:"w-5 h-5 text-yellow-600"});case"in_progress":return(0,a.jsx)(q.Z,{className:"w-5 h-5 text-indigo-600"});case"voicemail":return(0,a.jsx)(Z.Z,{className:"w-5 h-5 text-blue-600"});default:return(0,a.jsx)(F.Z,{className:"w-5 h-5 text-neutral-500"})}})(i.outcome),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(i.outcome)),children:i.outcome.replace("_"," ")})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[i.agent_name&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Agent:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 text-indigo-600"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:i.agent_name})]})]}),i.contact_name&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Contact:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-neutral-600"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:i.contact_name})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Cost:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.xG)(i.cost_usd||0)})]}),(i.contact_phone||i.from_number||i.to_number)&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-secondary rounded-lg",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-text-secondary",children:"Phone:"}),(0,a.jsx)("span",{className:"text-text-primary font-medium",children:(0,l.un)(i.contact_phone||i.from_number||i.to_number||"")})]})]})]}),i.recording_url&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(q.Z,{className:"w-4 h-4 mr-2"}),"Call Recording"]}),(0,a.jsx)(eb,{call:{id:i.id,organization_id:"",agent_id:"",contact_id:i.contact_name||"",vapi_call_id:i.vapi_call_id,direction:i.direction,outcome:i.outcome,from_number:i.from_number,to_number:i.to_number,duration_seconds:i.duration_seconds,cost_usd:i.cost_usd,started_at:i.started_at,ended_at:i.ended_at,created_at:i.created_at,summary:i.summary,recording_url:i.recording_url,transcript:null===(s=i.transcript)||void 0===s?void 0:s.full_transcript},variant:"full"})]}),i.summary&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"Call Summary"]}),(0,a.jsx)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:(0,a.jsx)("p",{className:"text-text-secondary leading-relaxed",children:i.summary})})]}),(null===(t=i.transcript)||void 0===t?void 0:t.full_transcript)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-text-primary mb-3 flex items-center",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"Full Transcript"]}),(0,a.jsx)("div",{className:"bg-neutral-800 border border-neutral-700 rounded-lg p-4 max-h-64 overflow-y-auto",children:i.transcript.messages&&i.transcript.messages.length>0?(0,a.jsx)("div",{className:"space-y-3",children:i.transcript.messages.map((e,t)=>{let s=["assistant","agent","bot","system"].includes(String(e.role||"").toLowerCase());return(0,a.jsxs)("div",{className:"p-3 rounded-lg ".concat(s?"bg-blue-900/30 border border-blue-700/50":"bg-neutral-700/50 border border-neutral-600/50"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-neutral-200",children:s?"Agent":"Customer"}),(0,a.jsxs)("span",{className:"text-xs text-neutral-400",children:[Math.floor(e.time/1e3),"s"]})]}),(0,a.jsx)("p",{className:"text-sm text-neutral-100",children:e.message})]},t)})}):(0,a.jsx)("pre",{className:"text-sm text-neutral-200 whitespace-pre-wrap font-mono leading-relaxed",children:i.transcript.full_transcript})})]})]})]})});return m?(0,ed.createPortal)(p,document.body):null}function ev(e){let{calls:t,loading:s=!1,onRefresh:i,showContact:c=!0,showAgent:o=!0,variant:d="full",className:m=""}=e,[x,u]=(0,r.useState)(null),g=(e,t)=>{let s="w-4 h-4";return"inbound"===e?(0,a.jsx)(J.Z,{className:s}):(0,a.jsx)(K.Z,{className:s})},y=e=>{switch(e){case"success":return(0,a.jsx)(j.Z,{className:"w-4 h-4 text-green-600"});case"failure":case"error":return(0,a.jsx)(ee.Z,{className:"w-4 h-4 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-yellow-600"});case"in_progress":return(0,a.jsx)(q.Z,{className:"w-4 h-4 text-indigo-600"});case"voicemail":return(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-blue-600"});default:return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-neutral-500"})}};return s?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):"compact"===d?(0,a.jsxs)("div",{className:"space-y-3 ".concat(m),children:[t.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"card p-4 cursor-pointer hover:bg-bg-secondary transition-colors",onClick:()=>u(e),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat("inbound"===e.direction?"bg-blue-100":"bg-green-100"),children:g(e.direction,e.outcome)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary truncate",children:c&&e.contact_name?e.contact_name:o&&e.agent_name?e.agent_name:"".concat(e.direction," Call")}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[y(e.outcome),(0,a.jsx)("span",{className:"text-xs text-text-secondary",children:new Date(e.started_at).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(q.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:(0,l.LU)(e.duration_seconds)})]}),e.cost_usd>0&&(0,a.jsx)("span",{children:(0,l.xG)(e.cost_usd)})]}),e.summary&&(0,a.jsx)("p",{className:"mt-1 text-sm text-text-secondary line-clamp-1",children:e.summary})]})]})},e.id)),x&&(0,a.jsx)(eN,{call:x,onClose:()=>u(null)})]}):(0,a.jsxs)("div",{className:"card overflow-hidden ".concat(m),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-bg-tertiary flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Call History"}),i&&(0,a.jsxs)("button",{onClick:i,className:"btn-secondary flex items-center text-sm",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"min-w-full divide-y divide-bg-tertiary",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Date"}),c&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Contact"}),o&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Agent"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Direction"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Outcome"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Duration"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Cost"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-bg-primary divide-y divide-bg-tertiary",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-bg-secondary transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{children:[new Date(e.started_at).toLocaleDateString(),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-text-tertiary",children:new Date(e.started_at).toLocaleTimeString()})]})}),c&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 text-neutral-600 mr-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.contact_name||"Unknown"}),e.contact_phone&&(0,a.jsx)("div",{className:"text-xs text-text-tertiary",children:(0,l.un)(e.contact_phone)})]})]})}),o&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 text-indigo-600 mr-2"}),(0,a.jsx)("span",{children:e.agent_name||"Unknown"})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[g(e.direction,e.outcome),(0,a.jsx)("span",{className:"text-sm text-text-primary capitalize",children:e.direction})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[y(e.outcome),(0,a.jsx)("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat((0,l.lj)(e.outcome)),children:e.outcome.replace("_"," ")})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,l.LU)(e.duration_seconds)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-primary",children:(0,l.xG)(e.cost_usd||0)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>u(e),className:"text-indigo-600 hover:text-indigo-900",children:"View Details"})})]},e.id))})]}),0===t.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(p.Z,{className:"mx-auto h-12 w-12 text-text-tertiary"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-text-primary",children:"No calls found"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-text-secondary",children:"No calls have been made yet."})]})]}),x&&(0,a.jsx)(eN,{call:x,onClose:()=>u(null)})]})}function ef(e){var t;let{contactId:s,onBack:i}=e,[c,d]=(0,r.useState)(null),[m,u]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),[y,N]=(0,r.useState)("timeline"),[v,f]=(0,r.useState)(null),[w,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{_()},[s]);let _=async()=>{try{g(!0);let{data:e,error:t}=await l.OQ.from("contacts").select("*").eq("id",s).single();if(t)throw t;d(e);let{data:a,error:i}=await l.OQ.from("calls").select("\n          *,\n          agents (name),\n          call_transcripts (full_transcript, messages)\n        ").eq("contact_id",s).order("started_at",{ascending:!1});if(i)throw i;let r=a.map(e=>{var t,s;return{id:e.id,vapi_call_id:e.vapi_call_id,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,ended_at:e.ended_at,cost_usd:e.cost_usd,summary:e.summary,recording_url:e.recording_url,agent_name:(null===(t=e.agents)||void 0===t?void 0:t.name)||"Unknown",contact_name:"".concat((null==c?void 0:c.first_name)||""," ").concat((null==c?void 0:c.last_name)||"").trim()||"Unknown Contact",contact_phone:null==c?void 0:c.phone_number,from_number:e.from_number,to_number:e.to_number,created_at:e.created_at,transcript:(null===(s=e.call_transcripts)||void 0===s?void 0:s[0])?{full_transcript:e.call_transcripts[0].full_transcript,messages:e.call_transcripts[0].messages}:void 0}});u(r)}catch(e){console.error("Error fetching contact data:",e),x.ZP.error("Failed to load contact details")}finally{g(!1)}},k=async e=>{f(e),e.recording_url&&e.transcript||await S(e)},S=async e=>{if(e.vapi_call_id)try{C(!0);let t=await l.OQ.functions.invoke("call-data-retrieval",{body:{action:"getCall",callId:e.vapi_call_id,organizationId:null==c?void 0:c.organization_id}});if(t.error)throw Error(t.error.message||"Failed to fetch call data");let{call:s}=t.data;u(t=>t.map(t=>{var a,i,r,n;return t.id===e.id?{...t,outcome:"ended"===s.status?(null===(a=s.analysis)||void 0===a?void 0:a.successEvaluation)||"success":t.outcome,recording_url:(null===(i=s.recordings)||void 0===i?void 0:i.stereo)||(null===(r=s.recordings)||void 0===r?void 0:r.mono),transcript:{full_transcript:s.transcript,messages:s.messages||[]},summary:(null===(n=s.analysis)||void 0===n?void 0:n.summary)||t.summary}:t})),f(t=>{var a,i,r,n;return(null==t?void 0:t.id)===e.id?{...t,outcome:"ended"===s.status?(null===(a=s.analysis)||void 0===a?void 0:a.successEvaluation)||"success":t.outcome,recording_url:(null===(i=s.recordings)||void 0===i?void 0:i.stereo)||(null===(r=s.recordings)||void 0===r?void 0:r.mono),transcript:{full_transcript:s.transcript,messages:s.messages||[]},summary:(null===(n=s.analysis)||void 0===n?void 0:n.summary)||t.summary}:t})}catch(e){console.error("Error enriching call data:",e),x.ZP.error("Failed to load complete call data")}finally{C(!1)}},D=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),A=e=>{switch(e){case"success":return(0,a.jsx)(j.Z,{className:"w-4 h-4 text-green-600"});case"failure":return(0,a.jsx)(ee.Z,{className:"w-4 h-4 text-red-600"});case"no_answer":case"busy":return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-yellow-600"});case"in_progress":return(0,a.jsx)(q.Z,{className:"w-4 h-4 text-indigo-600"});case"voicemail":return(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-blue-600"});default:return(0,a.jsx)(F.Z,{className:"w-4 h-4 text-neutral-500"})}},E=(e,t)=>{let s="w-4 h-4";return"inbound"===e?(0,a.jsx)(J.Z,{className:s}):(0,a.jsx)(K.Z,{className:s})};return h?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):c?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:i,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:(0,a.jsx)(b.Z,{className:"w-5 h-5 text-text-secondary"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-text-primary",children:[c.first_name," ",c.last_name]}),(0,a.jsx)("p",{className:"text-text-secondary",children:c.company})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("button",{className:"btn-secondary",children:[(0,a.jsx)(ec.Z,{className:"w-4 h-4 mr-2"}),"Edit"]}),(0,a.jsx)("button",{className:"p-2 hover:bg-bg-secondary rounded-lg",children:(0,a.jsx)(eo.Z,{className:"w-5 h-5 text-text-secondary"})})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Phone"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:(0,l.un)(c.phone_number)})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Email"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:c.email||"Not provided"})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(U.Z,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Calls"}),(0,a.jsx)("p",{className:"font-medium text-text-primary",children:c.total_calls||0})]})]})}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[A(c.last_call_outcome||"unknown"),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Last Outcome"}),(0,a.jsx)("p",{className:"font-medium text-text-primary capitalize",children:(null===(t=c.last_call_outcome)||void 0===t?void 0:t.replace("_"," "))||"None"})]})]})})]}),(0,a.jsx)("div",{className:"border-b border-border-subtle",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{id:"timeline",label:"Timeline",icon:ei.Z},{id:"calls",label:"Call History",icon:U.Z},{id:"details",label:"Details",icon:er.Z}].map(e=>{let t=e.icon;return(0,a.jsxs)("button",{onClick:()=>N(e.id),className:"flex items-center space-x-2 py-4 px-1 border-b-2 transition-colors ".concat(y===e.id?"border-indigo-600 text-indigo-600":"border-transparent text-text-secondary hover:text-text-primary"),children:[(0,a.jsx)(t,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.label})]},e.id)})})}),(0,a.jsxs)("div",{className:"min-h-[400px]",children:["timeline"===y&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Communication Timeline"}),m.length>0?(0,a.jsx)("div",{className:"space-y-4",children:m.map((e,t)=>(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card p-4 cursor-pointer hover:bg-bg-secondary transition-colors",onClick:()=>k(e),children:(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat("inbound"===e.direction?"bg-blue-100":"bg-green-100"),children:E(e.direction,e.outcome)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-text-primary",children:"inbound"===e.direction?"Inbound Call":"Outbound Call"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[A(e.outcome||"unknown"),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:new Date(e.started_at).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,a.jsx)(q.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:D(e.duration_seconds)})]}),(0,a.jsxs)("span",{children:["Agent: ",e.agent_name]}),e.cost_usd>0&&(0,a.jsxs)("span",{children:["$",e.cost_usd.toFixed(3)]})]}),e.summary&&(0,a.jsx)("p",{className:"mt-2 text-sm text-text-secondary line-clamp-2",children:e.summary})]})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(U.Z,{className:"w-12 h-12 text-text-tertiary mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Call history will appear here"})]})]}),"calls"===y&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)(ev,{calls:m,loading:h,onRefresh:()=>{x.ZP.promise(l.OQ.functions.invoke("call-data-retrieval",{body:{action:"syncMissingCalls",organizationId:c.organization_id}}).then(e=>{if(e.error)throw Error(e.error.message);return e.data}),{loading:"Syncing call data...",success:"Call data synced successfully",error:"Failed to sync call data"}).then(()=>_())},showContact:!1,showAgent:!0,variant:"full"})}),"details"===y&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-text-primary",children:"Contact Details"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:c.first_name,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:c.last_name,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:c.company||"",className:"input",readOnly:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Phone Number"}),(0,a.jsx)("input",{type:"text",value:c.phone_number,className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:c.email||"",className:"input",readOnly:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Created"}),(0,a.jsx)("input",{type:"text",value:new Date(c.created_at).toLocaleDateString(),className:"input",readOnly:!0})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Notes"}),(0,a.jsx)("textarea",{value:c.notes||"",className:"input min-h-[100px]",readOnly:!0,placeholder:"No notes available"})]})]})]}),v&&(0,a.jsx)(eN,{call:v,onClose:()=>f(null)})]}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-text-secondary",children:"Contact not found"}),(0,a.jsx)("button",{onClick:i,className:"btn-secondary mt-4",children:"Go Back"})]})}function ew(e){let{onNavigate:t}=e,{state:s,actions:c,dispatch:o}=(0,i.q)(),{profile:d,contacts:m,agents:u}=s,[h,y]=(0,r.useState)(!1),[b,N]=(0,r.useState)(""),[v,f]=(0,r.useState)("all"),[w,C]=(0,r.useState)(!1),[_,S]=(0,r.useState)(!1),[Z,D]=(0,r.useState)(!1),[A,E]=(0,r.useState)([]),[I,P]=(0,r.useState)(""),[O,z]=(0,r.useState)(!1),[M,L]=(0,r.useState)(null),[R,J]=(0,r.useState)(null),[K,Q]=(0,r.useState)(null),[B,G]=(0,r.useState)(!1),[V,X]=(0,r.useState)(null),[W,Y]=(0,r.useState)({firstName:"",lastName:"",phoneNumber:"",email:"",company:""});(0,r.useEffect)(()=>{H(),c.fetchAgents()},[d]);let H=async()=>{if(null==d?void 0:d.organization_id)try{y(!0);let{data:e}=await l.OQ.from("contacts").select("*").eq("organization_id",d.organization_id).order("created_at",{ascending:!1});o({type:"UPDATE_CONTACTS",contacts:e||[]})}catch(e){console.error("Error fetching contacts:",e),x.ZP.error("Failed to load contacts")}finally{y(!1)}},$=async()=>{console.log("\uD83D\uDCE5 handleImportContacts called",{csvFile:!!M,importData:I.length});let e="";if(M)console.log("\uD83D\uDCC4 Processing CSV file:",M.name),e=await M.text();else if(I.trim())console.log("\uD83D\uDCDD Processing text input, length:",I.length),e=I;else{x.ZP.error("Please enter contact data or upload a CSV file");return}try{z(!0),console.log("\uD83D\uDCE4 Calling import-contacts API...");let t=await (0,l.k_)("import-contacts",{method:"POST",body:JSON.stringify({contacts:e,defaultCountryCode:"+1",format:"auto"})});console.log("✅ Import result:",t),x.ZP.success("Successfully imported ".concat(t.summary.imported," contacts")),t.summary.duplicates>0&&(0,x.ZP)("".concat(t.summary.duplicates," duplicates skipped"),{icon:"⚠️"}),t.summary.invalid>0&&x.ZP.error("".concat(t.summary.invalid," invalid entries")),C(!1),P(""),L(null),await H()}catch(e){console.error("Error importing contacts:",e),x.ZP.error(e.message||"Failed to import contacts")}finally{z(!1)}},ec=async()=>{if(console.log("\uD83D\uDC65 handleAddContact called",W),!W.phoneNumber.trim()){x.ZP.error("Phone number is required");return}try{console.log("\uD83D\uDCBE Inserting contact into database...");let{error:e}=await l.OQ.from("contacts").insert({organization_id:null==d?void 0:d.organization_id,first_name:W.firstName||null,last_name:W.lastName||null,phone_number:W.phoneNumber,email:W.email||null,company:W.company||null});if(e)throw console.error("❌ Database error:",e),e;console.log("✅ Contact added successfully"),x.ZP.success("Contact added successfully"),S(!1),Y({firstName:"",lastName:"",phoneNumber:"",email:"",company:""}),await H()}catch(e){console.error("Error adding contact:",e),x.ZP.error(e.message||"Failed to add contact")}},eo=async(e,t)=>{if(!t){E([e.id]),D(!0);return}try{let s=u.find(e=>e.id===t);if(!s){x.ZP.error("Selected agent not found");return}if(!s.vapi_assistant_id){x.ZP.error("Agent is not properly configured");return}let a=await (0,l.k_)("initiate-outbound-call",{method:"POST",body:JSON.stringify({assistantId:s.vapi_assistant_id,customerNumber:e.phone_number,contactId:e.id})});a.success?(x.ZP.success("Calling ".concat(e.first_name||e.phone_number,"...")),await H()):x.ZP.error(a.error||"Failed to initiate call")}catch(e){console.error("Error initiating outbound call:",e),x.ZP.error(e.message||"Failed to initiate call")}},ed=async e=>{if(0===A.length){x.ZP.error("No contacts selected");return}try{if(!u.find(t=>t.id===e)){x.ZP.error("Selected agent not found");return}let t=A.map(t=>{let s=m.find(e=>e.id===t);if(s)return eo(s,e)});await Promise.all(t),E([]),D(!1),x.ZP.success("Initiated calls for ".concat(A.length," contacts"))}catch(e){console.error("Error with bulk calling:",e),x.ZP.error("Failed to initiate some calls")}},em=async e=>{if(confirm("Are you sure you want to delete this contact? This action cannot be undone."))try{X(e);let t=await (0,l.k_)("edit-contact?contactId=".concat(e),{method:"DELETE"});if(!t.success)throw Error(t.error||"Failed to delete contact");x.ZP.success("Contact deleted successfully"),await H()}catch(e){console.error("Error deleting contact:",e),x.ZP.error(e.message||"Failed to delete contact")}finally{X(null)}},ex=m.filter(e=>{var t,s,a,i;let r=(null===(t=e.first_name)||void 0===t?void 0:t.toLowerCase().includes(b.toLowerCase()))||(null===(s=e.last_name)||void 0===s?void 0:s.toLowerCase().includes(b.toLowerCase()))||e.phone_number.includes(b)||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(b.toLowerCase()))||(null===(i=e.company)||void 0===i?void 0:i.toLowerCase().includes(b.toLowerCase())),n="all"===v||"contacted"===v&&e.total_calls>0||"never_contacted"===v&&0===e.total_calls||"success"===v&&"success"===e.last_call_outcome||"pending"===v&&"in_progress"===e.last_call_outcome;return r&&n}),eu=e=>{if(0===e.total_calls)return(0,a.jsx)(q.Z,{className:"w-4 h-4 text-neutral-400"});switch(e.last_call_outcome){case"success":return(0,a.jsx)(j.Z,{className:"w-4 h-4 text-success-500"});case"failure":return(0,a.jsx)(ee.Z,{className:"w-4 h-4 text-error-500"});case"in_progress":return(0,a.jsx)(q.Z,{className:"w-4 h-4 text-warning-500"});default:return(0,a.jsx)(q.Z,{className:"w-4 h-4 text-neutral-400"})}},eh=e=>{var t;let s=e.last_outbound_call||e.last_inbound_call;if(!s)return"Never contacted";let a=new Date(s).toLocaleDateString(),i=(null===(t=e.last_call_outcome)||void 0===t?void 0:t.replace("_"," "))||"Unknown";return"".concat(i," - ").concat(a)};return(0,a.jsx)("div",{className:"space-y-6",children:R?(0,a.jsx)(ef,{contactId:R,onBack:()=>J(null)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"CRM"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your contacts and track communication history"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"btn-secondary flex items-center",children:[(0,a.jsx)(et.Z,{className:"w-4 h-4 mr-2"}),"Import Contacts"]}),(0,a.jsxs)("button",{onClick:()=>S(!0),className:"btn-primary flex items-center",children:[(0,a.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,a.jsx)("div",{className:"flex-1 max-w-md",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ea.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-neutral-400"}),(0,a.jsx)("input",{type:"text",placeholder:"Search contacts...",value:b,onChange:e=>N(e.target.value),className:"input-field pl-10"})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("select",{value:v,onChange:e=>f(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"all",children:"All Contacts"}),(0,a.jsx)("option",{value:"contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"never_contacted",children:"Never Contacted"}),(0,a.jsx)("option",{value:"success",children:"Successful Calls"}),(0,a.jsx)("option",{value:"pending",children:"Pending Follow-up"})]}),(0,a.jsxs)("span",{className:"text-sm text-neutral-500",children:[ex.length," of ",m.length," contacts"]})]})]})}),(0,a.jsx)("div",{className:"card p-0 overflow-hidden",children:h?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-neutral-500 mt-2",children:"Loading contacts..."})]}):ex.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary border-b border-border-subtle",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Contact"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Phone"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Company"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Last Contact"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-4 px-6 font-medium text-text-primary",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-border-subtle",children:ex.map((e,t)=>{var s,i;return(0,a.jsxs)(n.E.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"hover:bg-bg-secondary transition-colors",children:[(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"icon-box w-10 h-10",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:(null===(s=e.first_name)||void 0===s?void 0:s[0])||(null===(i=e.last_name)||void 0===i?void 0:i[0])||e.phone_number[0]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-text-primary",children:e.first_name||e.last_name?"".concat(e.first_name||""," ").concat(e.last_name||"").trim():"Unknown"}),e.email&&(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:e.email})]})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-text-primary",children:(0,l.un)(e.phone_number)})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:e.company?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-text-primary",children:e.company})]}):(0,a.jsx)("span",{className:"text-text-secondary",children:"—"})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ei.Z,{className:"w-4 h-4 text-text-secondary"}),(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:e.last_outbound_call||e.last_inbound_call?new Date(e.last_outbound_call||e.last_inbound_call).toLocaleDateString():"Never"})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[eu(e),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:eh(e)})]})}),(0,a.jsx)("td",{className:"py-4 px-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>J(e.id),className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"View Details",children:(0,a.jsx)(er.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>eo(e),className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Call Contact",disabled:0===u.filter(e=>e.is_active&&e.phone_number).length,children:(0,a.jsx)(U.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{Q(e),G(!0)},className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Edit Contact",children:(0,a.jsx)(en.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>em(e.id),className:"p-2 text-neutral-400 hover:text-error-600 hover:bg-error-50 rounded-lg transition-colors",title:"Delete Contact",disabled:V===e.id,children:V===e.id?(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-error-200 border-t-error-600 rounded-full"}):(0,a.jsx)(el.Z,{className:"w-4 h-4"})})]})})]},e.id)})})]})}):(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)(k.Z,{className:"w-16 h-16 text-neutral-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:b||"all"!==v?"No contacts found":"No contacts yet"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-6",children:b||"all"!==v?"Try adjusting your search or filter criteria":"Import contacts or add them manually to get started"}),!b&&"all"===v&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"btn-secondary flex items-center justify-center",children:[(0,a.jsx)(et.Z,{className:"w-4 h-4 mr-2"}),"Import Contacts"]}),(0,a.jsxs)("button",{onClick:()=>S(!0),className:"btn-primary flex items-center justify-center",children:[(0,a.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Add Manually"]})]})]})}),(0,a.jsx)(T.M,{children:w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-lg shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Import Contacts"}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-primary-50 border border-primary-200 rounded-xl p-4",children:[(0,a.jsx)("h3",{className:"font-medium text-primary-900 mb-2",children:"Supported Formats"}),(0,a.jsxs)("div",{className:"text-sm text-primary-700 space-y-1",children:[(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Phone only:"})," One phone number per line"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Name + Phone:"})," John Doe +1234567890"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"Comma separated:"})," John Doe, +1234567890, john@email.com, Company"]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Upload CSV File"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-neutral-300 rounded-xl p-6 text-center hover:border-primary-400 transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&("text/csv"===s.type||s.name.endsWith(".csv")?(L(s),P("")):x.ZP.error("Please select a CSV file"))},className:"hidden",id:"csv-upload"}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[(0,a.jsx)(et.Z,{className:"w-8 h-8 text-neutral-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-neutral-600",children:M?M.name:"Click to upload CSV file"}),(0,a.jsx)("p",{className:"text-xs text-neutral-500 mt-1",children:"Support for CSV files with headers: Name, Phone, Email, Company"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"h-px bg-neutral-300 flex-1 w-16"}),(0,a.jsx)("span",{className:"text-sm text-neutral-500",children:"OR"}),(0,a.jsx)("div",{className:"h-px bg-neutral-300 flex-1 w-16"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Paste contact data"}),(0,a.jsx)("textarea",{value:I,onChange:e=>{P(e.target.value),e.target.value.trim()&&L(null)},placeholder:"John Smith +1234567890\nJane Doe, +1987654321, jane@company.com, Acme Corp\n+1555123456\nMichael Johnson +1444555666",className:"input-field resize-none h-32",disabled:!!M}),(0,a.jsx)("p",{className:"text-xs text-neutral-500 mt-1",children:"Each contact should be on a separate line. Phone numbers will be automatically formatted."})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{console.log("\uD83D\uDEAB Import cancel clicked"),C(!1)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Import button clicked",{disabled:O||!I.trim()&&!M,importing:O,hasData:!!I.trim(),hasFile:!!M}),$()},disabled:O||!I.trim()&&!M,className:"btn-primary",children:O?"Importing...":"Import Contacts"})]})]})]})})}),(0,a.jsx)(T.M,{children:_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Add Contact"}),(0,a.jsx)("button",{onClick:()=>S(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:W.firstName,onChange:e=>Y(t=>({...t,firstName:e.target.value})),className:"input-field",placeholder:"John"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:W.lastName,onChange:e=>Y(t=>({...t,lastName:e.target.value})),className:"input-field",placeholder:"Doe"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",value:W.phoneNumber,onChange:e=>Y(t=>({...t,phoneNumber:e.target.value})),className:"input-field",placeholder:"+1 (555) 123-4567",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:W.email,onChange:e=>Y(t=>({...t,email:e.target.value})),className:"input-field",placeholder:"john@company.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:W.company,onChange:e=>Y(t=>({...t,company:e.target.value})),className:"input-field",placeholder:"Acme Corp"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{console.log("\uD83D\uDEAB Cancel button clicked"),S(!1)},className:"btn-secondary",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),console.log("\uD83D\uDE80 Add contact button clicked",{disabled:!W.phoneNumber.trim()}),ec()},disabled:!W.phoneNumber.trim(),className:"btn-primary",children:"Add Contact"})]})]})]})})}),(0,a.jsx)(T.M,{children:Z&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Select Agent"}),(0,a.jsx)("button",{onClick:()=>D(!1),className:"p-2 hover:bg-neutral-100 rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("p",{className:"text-sm text-neutral-600",children:["Choose which agent will handle the outbound call",A.length>1?"s":""," to:"]}),(0,a.jsx)("div",{className:"bg-neutral-50 rounded-lg p-3",children:(0,a.jsx)("div",{className:"text-sm font-medium text-neutral-900",children:1===A.length?(()=>{let e=m.find(e=>e.id===A[0]);return e?"".concat(e.first_name||""," ").concat(e.last_name||"").trim()||e.phone_number:"Unknown contact"})():"".concat(A.length," selected contacts")})}),(0,a.jsx)("div",{className:"space-y-2",children:u.filter(e=>e.is_active&&e.phone_number).map(e=>(0,a.jsx)("button",{onClick:()=>{if(1===A.length){let t=m.find(e=>e.id===A[0]);t&&eo(t,e.id)}else ed(e.id);D(!1)},className:"w-full text-left p-3 border border-neutral-200 rounded-lg hover:border-primary-300 hover:bg-primary-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-neutral-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-neutral-600",children:["Savannah"===e.voice_id?"Sandra (Savannah)":"Jackson (Elliot)"," • ",(0,l.un)(e.phone_number)]})]}),(0,a.jsx)(U.Z,{className:"w-5 h-5 text-primary-600"})]})},e.id))}),0===u.filter(e=>e.is_active&&e.phone_number).length&&(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)(F.Z,{className:"w-12 h-12 text-warning-500 mx-auto mb-3"}),(0,a.jsx)("h3",{className:"font-medium text-neutral-900 mb-2",children:"No Active Agents"}),(0,a.jsx)("p",{className:"text-sm text-neutral-600 mb-4",children:"You need at least one active agent with a phone number to make outbound calls."}),(0,a.jsx)("button",{onClick:()=>t("agents"),className:"btn-primary text-sm",children:"Manage Agents"})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-3 pt-4",children:(0,a.jsx)("button",{onClick:()=>D(!1),className:"btn-secondary",children:"Cancel"})})]})]})})}),(0,a.jsx)(eC,{contact:K,isOpen:B,onClose:()=>{G(!1),Q(null)},onSave:async()=>{await H(),G(!1),Q(null),x.ZP.success("Contact updated successfully")}})]})})}function eC(e){let{contact:t,isOpen:s,onClose:i,onSave:c}=e,[o,d]=(0,r.useState)({firstName:"",lastName:"",phoneNumber:"",email:"",company:""}),[m,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&d({firstName:t.first_name||"",lastName:t.last_name||"",phoneNumber:t.phone_number||"",email:t.email||"",company:t.company||""})},[t]);let h=async()=>{if(t)try{u(!0);let e=await (0,l.k_)("edit-contact",{method:"POST",body:JSON.stringify({contactId:t.id,...o})});if(!e.success)throw Error(e.error||"Failed to update contact");await c()}catch(e){console.error("Error updating contact:",e),x.ZP.error("Failed to update contact")}finally{u(!1)}};return s&&t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-md shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Edit Contact"}),(0,a.jsx)("button",{onClick:i,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:o.firstName,onChange:e=>d(t=>({...t,firstName:e.target.value})),className:"input-field",placeholder:"John"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:o.lastName,onChange:e=>d(t=>({...t,lastName:e.target.value})),className:"input-field",placeholder:"Doe"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",value:o.phoneNumber,onChange:e=>d(t=>({...t,phoneNumber:e.target.value})),className:"input-field",placeholder:"+1 (555) 123-4567",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:o.email,onChange:e=>d(t=>({...t,email:e.target.value})),className:"input-field",placeholder:"john@company.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Company"}),(0,a.jsx)("input",{type:"text",value:o.company,onChange:e=>d(t=>({...t,company:e.target.value})),className:"input-field",placeholder:"Acme Corp"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:i,className:"btn-secondary",disabled:m,children:"Cancel"}),(0,a.jsx)("button",{onClick:h,className:"btn-primary",disabled:m||!o.phoneNumber.trim(),children:m?"Saving...":"Save Changes"})]})]})]})}):null}var e_=s(70525),ek=s(98728);function eS(e){let{onNavigate:t}=e,{state:s,actions:c,dispatch:o}=(0,i.q)(),{profile:d,agents:m}=s,[u,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(null),[b,N]=(0,r.useState)(!1),[v,f]=(0,r.useState)(null),[w,C]=(0,r.useState)(!1);(0,r.useEffect)(()=>{S()},[d]);let S=async()=>{if(null==d?void 0:d.organization_id)try{h(!0);let{data:e}=await l.OQ.from("agents").select("*").eq("organization_id",d.organization_id).order("created_at",{ascending:!1});o({type:"UPDATE_AGENTS",agents:e||[]})}catch(e){console.error("Error fetching agents:",e),x.ZP.error("Failed to load agents")}finally{h(!1)}},Z=async e=>{try{let t=!e.is_active,{error:s}=await l.OQ.from("agents").update({is_active:t}).eq("id",e.id);if(s)throw s;await S(),x.ZP.success("Agent ".concat(t?"activated":"deactivated"))}catch(e){console.error("Error toggling agent status:",e),x.ZP.error("Failed to update agent status")}},D=e=>{navigator.clipboard.writeText(e),x.ZP.success("Phone number copied to clipboard")},A=e=>e.phone_number?e.is_active?(0,a.jsx)(j.Z,{className:"w-5 h-5 text-success-500"}):(0,a.jsx)(ee.Z,{className:"w-5 h-5 text-neutral-400"}):(0,a.jsx)(F.Z,{className:"w-5 h-5 text-warning-500"}),E=e=>e.phone_number?e.is_active?"Active":"Inactive":"No Phone Number",I=e=>0===e.total_calls?0:Math.round(e.successful_calls/e.total_calls*100),P=e=>({Savannah:"Sandra (Savannah)",Elliot:"Jackson (Elliot)"})[e]||e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Voice Agents"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your AI voice agents and monitor their performance"})]}),(0,a.jsxs)("button",{onClick:()=>t("dashboard"),className:"btn-primary flex items-center",children:[(0,a.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Create New Agent"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Total Agents"}),(0,a.jsx)("p",{className:"kpi-value",children:m.length})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(_.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Active Agents"}),(0,a.jsx)("p",{className:"kpi-value",children:m.filter(e=>e.is_active&&e.phone_number).length})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(j.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Total Calls"}),(0,a.jsx)("p",{className:"kpi-value",children:m.reduce((e,t)=>e+t.total_calls,0)})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(U.Z,{className:"w-8 h-8 text-white"})})]})}),(0,a.jsx)("div",{className:"kpi-card p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"kpi-title",children:"Success Rate"}),(0,a.jsxs)("p",{className:"kpi-value",children:[m.length>0&&Math.round(m.reduce((e,t)=>e+t.successful_calls,0)/m.reduce((e,t)=>e+t.total_calls,0)*100)||0,"%"]})]}),(0,a.jsx)("div",{className:"icon-box",children:(0,a.jsx)(e_.Z,{className:"w-8 h-8 text-white"})})]})})]}),(0,a.jsx)("div",{className:"space-y-4",children:u?(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full mx-auto"}),(0,a.jsx)("p",{className:"text-text-secondary mt-2",children:"Loading agents..."})]}):m.length>0?m.map((e,t)=>(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card hover:shadow-lg transition-all duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-6 h-6 text-primary-700"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-neutral-900",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[A(e),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(e.phone_number?e.is_active?"text-success-600":"text-neutral-400":"text-warning-600"),children:E(e)})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 text-neutral-400"}),e.phone_number?(0,a.jsx)("button",{onClick:()=>D(e.phone_number),className:"text-sm text-neutral-600 hover:text-primary-600 transition-colors",title:"Click to copy",children:(0,l.un)(e.phone_number)}):(0,a.jsx)("span",{className:"text-sm text-neutral-400",children:"No phone number"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:P(e.voice_id)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsxs)("span",{className:"text-sm text-neutral-600",children:[e.total_calls," calls"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(e_.Z,{className:"w-4 h-4 text-neutral-400"}),(0,a.jsxs)("span",{className:"text-sm text-neutral-600",children:[I(e),"% success"]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.phone_number&&(0,a.jsx)("button",{onClick:()=>Z(e),className:"p-2 rounded-lg transition-colors ".concat(e.is_active?"text-warning-600 hover:bg-warning-50":"text-success-600 hover:bg-success-50"),title:e.is_active?"Deactivate Agent":"Activate Agent",children:e.is_active?(0,a.jsx)(ex.Z,{className:"w-4 h-4"}):(0,a.jsx)(eu.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{y(e),N(!0)},className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"View Details",children:(0,a.jsx)(ek.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{f(e),C(!0)},className:"p-2 text-neutral-400 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Edit Agent",children:(0,a.jsx)(en.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{className:"p-2 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors",title:"More Options",children:(0,a.jsx)(eo.Z,{className:"w-4 h-4"})})]})]}),e.business_objective&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-neutral-200",children:(0,a.jsxs)("p",{className:"text-sm text-neutral-600 line-clamp-2",children:[(0,a.jsx)("strong",{children:"Objective:"})," ",e.business_objective]})})]},e.id)):(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(_.Z,{className:"w-16 h-16 text-neutral-300 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-neutral-900 mb-2",children:"No agents configured yet"}),(0,a.jsx)("p",{className:"text-neutral-600 mb-6",children:"Create your first AI voice agent to start handling calls automatically"}),(0,a.jsxs)("button",{onClick:()=>t("dashboard"),className:"btn-primary flex items-center mx-auto",children:[(0,a.jsx)(es.Z,{className:"w-4 h-4 mr-2"}),"Create Your First Agent"]})]})}),(0,a.jsx)(T.M,{children:b&&g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Agent Details"}),(0,a.jsx)("button",{onClick:()=>N(!1),className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Name"}),(0,a.jsx)("p",{className:"text-text-primary font-medium",children:g.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voice"}),(0,a.jsx)("p",{className:"text-text-primary",children:P(g.voice_id)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Phone Number"}),(0,a.jsx)("p",{className:"text-text-primary",children:g.phone_number?(0,l.un)(g.phone_number):"Not assigned"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Status"}),(0,a.jsx)("p",{className:"font-medium ".concat(g.phone_number?g.is_active?"text-success-600":"text-neutral-400":"text-warning-600"),children:E(g)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-primary-600",children:g.total_calls}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Calls"})]})}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-success-600",children:[I(g),"%"]}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Success Rate"})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Business Objective"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:g.business_objective||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Target Audience"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:g.target_audience||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Value Proposition"}),(0,a.jsx)("p",{className:"text-text-primary text-sm card-light p-3 rounded-lg",children:g.value_proposition||"Not specified"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>N(!1),className:"btn-secondary",children:"Close"}),(0,a.jsxs)("button",{onClick:()=>{f(g),C(!0),N(!1)},className:"btn-primary flex items-center",children:[(0,a.jsx)(en.Z,{className:"w-4 h-4 mr-2"}),"Edit Agent"]})]})]})]})})}),(0,a.jsx)(eZ,{agent:v,isOpen:w,onClose:()=>{C(!1),f(null)},onSave:async()=>{await S(),C(!1),f(null),x.ZP.success("Agent updated successfully")}})]})}function eZ(e){let{agent:t,isOpen:s,onClose:i,onSave:c}=e,[o,d]=(0,r.useState)({name:"",description:"",voiceId:"Savannah",businessObjective:"",targetAudience:"",keyPainPoints:"",valuePropositon:"",callToAction:"",firstMessage:"",voicemailMessage:"",endCallMessage:""}),[m,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&d({name:t.name||"",description:t.description||"",voiceId:t.voice_id,businessObjective:t.business_objective||"",targetAudience:t.target_audience||"",keyPainPoints:t.key_pain_points||"",valuePropositon:t.value_proposition||"",callToAction:t.call_to_action||"",firstMessage:t.first_message||"",voicemailMessage:t.voicemail_message||"",endCallMessage:t.end_call_message||""})},[t]);let h=async()=>{if(t)try{u(!0);let e=await (0,l.k_)("edit-agent",{method:"POST",body:JSON.stringify({agentId:t.id,...o})});if(!e.success)throw Error(e.error||"Failed to update agent");await c()}catch(e){console.error("Error updating agent:",e),x.ZP.error("Failed to update agent")}finally{u(!1)}};return s&&t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"card rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-2xl shadow-primary-500/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-text-primary",children:"Edit Agent"}),(0,a.jsx)("button",{onClick:i,className:"p-2 hover:bg-bg-secondary rounded-lg transition-colors",children:"✕"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Agent Name *"}),(0,a.jsx)("input",{type:"text",value:o.name,onChange:e=>d(t=>({...t,name:e.target.value})),className:"input-field",placeholder:"Enter agent name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voice"}),(0,a.jsxs)("select",{value:o.voiceId,onChange:e=>d(t=>({...t,voiceId:e.target.value})),className:"input-field",children:[(0,a.jsx)("option",{value:"Savannah",children:"Sandra (Savannah)"}),(0,a.jsx)("option",{value:"Elliot",children:"Jackson (Elliot)"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Description"}),(0,a.jsx)("textarea",{value:o.description,onChange:e=>d(t=>({...t,description:e.target.value})),className:"input-field resize-none h-20",placeholder:"Brief description of this agent's purpose..."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"Business Context"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Business Objective"}),(0,a.jsx)("textarea",{value:o.businessObjective,onChange:e=>d(t=>({...t,businessObjective:e.target.value})),className:"input-field resize-none h-20",placeholder:"What is the main goal of your business?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Target Audience"}),(0,a.jsx)("textarea",{value:o.targetAudience,onChange:e=>d(t=>({...t,targetAudience:e.target.value})),className:"input-field resize-none h-20",placeholder:"Who are your ideal customers?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Key Pain Points"}),(0,a.jsx)("textarea",{value:o.keyPainPoints,onChange:e=>d(t=>({...t,keyPainPoints:e.target.value})),className:"input-field resize-none h-20",placeholder:"What problems does your business solve?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Value Proposition"}),(0,a.jsx)("textarea",{value:o.valuePropositon,onChange:e=>d(t=>({...t,valuePropositon:e.target.value})),className:"input-field resize-none h-20",placeholder:"What unique value do you provide?"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Call to Action"}),(0,a.jsx)("textarea",{value:o.callToAction,onChange:e=>d(t=>({...t,callToAction:e.target.value})),className:"input-field resize-none h-20",placeholder:"What should customers do next?"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary",children:"Call Messages"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"First Message (Introduction)"}),(0,a.jsx)("input",{type:"text",value:o.firstMessage,onChange:e=>d(t=>({...t,firstMessage:e.target.value})),className:"input-field",placeholder:"Hi there, my name is [Agent Name], from [Company]. How are you today?"}),(0,a.jsx)("p",{className:"text-xs text-text-secondary mt-1",children:"This is the first thing your agent will say when answering calls."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"Voicemail Message"}),(0,a.jsx)("input",{type:"text",value:o.voicemailMessage,onChange:e=>d(t=>({...t,voicemailMessage:e.target.value})),className:"input-field",placeholder:"Hello! This is [Agent Name] from [Company]..."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-1",children:"End Call Message"}),(0,a.jsx)("input",{type:"text",value:o.endCallMessage,onChange:e=>d(t=>({...t,endCallMessage:e.target.value})),className:"input-field",placeholder:"Thank you for your time today. Have a wonderful day!"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:i,className:"btn-secondary",disabled:m,children:"Cancel"}),(0,a.jsx)("button",{onClick:h,className:"btn-primary",disabled:m||!o.name.trim(),children:m?"Saving...":"Save Changes"})]})]})]})}):null}var eD=s(95252),eA=s(47625),eE=s(77031),eI=s(56940),eT=s(97059),eP=s(62994),eO=s(8147),ez=s(31699),eM=s(75169),eF=s(3574),eL=s(20407);function eR(e){let{onNavigate:t}=e,{state:s}=(0,i.q)(),{profile:c,subscription:o}=s,[d,m]=(0,r.useState)(!0),[x,u]=(0,r.useState)("7d"),[h,p]=(0,r.useState)(null),[g,y]=(0,r.useState)([]),[j,b]=(0,r.useState)([]),[N,v]=(0,r.useState)([]),[f,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{(null==c?void 0:c.organization_id)&&C()},[c,x]);let C=async()=>{try{m(!0);let e=parseInt(x.replace("d","")),t=new Date;t.setDate(t.getDate()-e+1);let{data:s,error:a}=await l.OQ.from("calls").select("\n          id,\n          outcome,\n          duration_seconds,\n          cost_usd,\n          started_at,\n          agent_id,\n          agents (\n            id,\n            name\n          )\n        ").eq("organization_id",null==c?void 0:c.organization_id).gte("started_at",t.toISOString()).not("outcome","is",null).order("started_at",{ascending:!0});if(a)throw Error("Failed to fetch calls data: ".concat(a.message));let i=Array.isArray(s)?s:[],{data:r}=await l.OQ.from("subscriptions").select("minutes_included, minutes_used").eq("organization_id",null==c?void 0:c.organization_id).single(),n=i.length,o=i.filter(e=>"success"===e.outcome).length,d=Math.round(i.reduce((e,t)=>e+(t.duration_seconds||0),0)/60),u=i.reduce((e,t)=>e+(t.cost_usd||0),0),h=((null==r?void 0:r.minutes_included)||0)-((null==r?void 0:r.minutes_used)||0);p({totalCalls:n,successfulCalls:o,failedCalls:n-o,totalMinutes:d,averageDuration:n>0?Math.round(i.reduce((e,t)=>e+(t.duration_seconds||0),0)/n):0,successRate:n>0?Math.round(o/n*100):0,costTotal:u,avgCostPerCall:n>0?u/n:0,minutesRemaining:h});let g=new Map;i.forEach(e=>{let t=new Date(e.started_at).toLocaleDateString(),s=g.get(t)||{date:t,calls:0,successful:0,minutes:0,cost:0};s.calls+=1,"success"===e.outcome&&(s.successful+=1),s.minutes+=Math.round((e.duration_seconds||0)/60),s.cost+=e.cost_usd||0,g.set(t,s)}),y(Array.from(g.values()).slice(-7));let j=new Map;i.forEach(e=>{let t=(Array.isArray(e.agents)?e.agents:e.agents?[e.agents]:[])[0]||null,s=(null==t?void 0:t.id)||e.agent_id||"unknown",a=(null==t?void 0:t.name)||"Unknown Agent",i=j.get(s)||{agentId:s,agentName:a,totalCalls:0,successfulCalls:0,successRate:0,avgDuration:0,costTotal:0};i.totalCalls+=1,"success"===e.outcome&&(i.successfulCalls+=1),i.avgDuration=(i.avgDuration*(i.totalCalls-1)+(e.duration_seconds||0))/i.totalCalls,i.successRate=Math.round(i.successfulCalls/i.totalCalls*100),i.costTotal+=e.cost_usd||0,j.set(s,i)}),b(Array.from(j.values()));let N=new Map,f={success:"#10b981",failure:"#ef4444",no_answer:"#f59e0b",busy:"#8b5cf6",voicemail:"#3b82f6",in_progress:"#6b7280"};i.forEach(e=>{let t=e.outcome||"unknown",s=N.get(t)||{count:0,color:"#6b7280"};s.count+=1,s.color=f[t]||"#6b7280",N.set(t,s)});let w=Array.from(N.entries()).map(e=>{let[t,s]=e;return{name:t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),value:s.count,percentage:n>0?Math.round(s.count/n*100):0,color:s.color}});v(w)}catch(e){console.error("Error fetching reports data:",e)}finally{m(!1)}},_=[{title:"Total Calls",value:(null==h?void 0:h.totalCalls)||0,icon:U.Z,color:"primary",change:"+12% vs last period"},{title:"Success Rate",value:"".concat((null==h?void 0:h.successRate)||0,"%"),icon:P.Z,color:"success",change:"+5% vs last period"},{title:"Total Minutes",value:"".concat((null==h?void 0:h.totalMinutes)||0,"m"),icon:q.Z,color:"warning",change:"".concat(((null==o?void 0:o.minutes_included)||0)-((null==o?void 0:o.minutes_used)||0),"m remaining")},{title:"Total Cost",value:(0,l.xG)((null==h?void 0:h.costTotal)||0),icon:eD.Z,color:"secondary",change:"".concat((0,l.xG)((null==h?void 0:h.avgCostPerCall)||0)," avg per call")}];return d?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"card animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-neutral-200 rounded w-1/2 mb-4"}),(0,a.jsx)("div",{className:"h-8 bg-neutral-200 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-neutral-200 rounded w-1/4"})]},e))})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Reports & Analytics"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Track performance and analyze your AI voice agent metrics"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("select",{value:x,onChange:e=>u(e.target.value),className:"input-field",children:[(0,a.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,a.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,a.jsx)("option",{value:"90d",children:"Last 90 days"})]}),(0,a.jsxs)("button",{className:"btn-secondary flex items-center",children:[(0,a.jsx)(eh.Z,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:_.map((e,t)=>{let s=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat("primary"===e.color?"bg-primary-600":"success"===e.color?"bg-success-600":"warning"===e.color?"bg-warning-600":"bg-secondary-600"),children:(0,a.jsx)(s,{className:"w-6 h-6 text-white"})}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)(e_.Z,{className:"w-4 h-4 text-success-500 mb-1"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-neutral-600 mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-neutral-900 mb-1",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-neutral-500",children:e.change})]})]},e.title)})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Daily Performance"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-primary-500 rounded-full"}),(0,a.jsx)("span",{className:"text-neutral-600",children:"Total Calls"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-success-500 rounded-full"}),(0,a.jsx)("span",{className:"text-neutral-600",children:"Successful"})]})]})]}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(eA.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eE.v,{data:g,children:[(0,a.jsx)(eI.q,{strokeDasharray:"3 3",stroke:"#f3f4f6"}),(0,a.jsx)(eT.K,{dataKey:"date",stroke:"#6b7280",fontSize:12}),(0,a.jsx)(eP.B,{stroke:"#6b7280",fontSize:12}),(0,a.jsx)(eO.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}}),(0,a.jsx)(ez.$,{dataKey:"calls",fill:"#0ea5e9",radius:[4,4,0,0]}),(0,a.jsx)(ez.$,{dataKey:"successful",fill:"#22c55e",radius:[4,4,0,0]})]})})})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-neutral-900",children:"Call Outcomes"})}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(eA.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eM.u,{children:[(0,a.jsx)(eF.b,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:t,percentage:s}=e;return"".concat(t,": ").concat(s,"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:N.map((e,t)=>(0,a.jsx)(eL.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(eO.u,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.3)",color:"#f9fafb"}})]})})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:N.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsx)("span",{className:"text-sm text-neutral-600",children:e.name}),(0,a.jsx)("span",{className:"text-sm font-medium text-neutral-900",children:e.value})]},e.name))})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Agent Performance"})}),j.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-bg-secondary border-b border-border-subtle",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Agent"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Total Calls"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Successful"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Success Rate"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Avg Duration"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-medium text-text-primary",children:"Total Cost"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-border-subtle",children:j.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-bg-secondary",children:[(0,a.jsx)("td",{className:"py-3 px-4 font-medium text-text-primary",children:e.agentName}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.totalCalls}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:e.successfulCalls}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex-1 bg-neutral-700 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-green-500 h-2 rounded-full",style:{width:"".concat(e.successRate,"%")}})}),(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[e.successRate,"%"]})]})}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:(0,l.LU)(Math.round(e.avgDuration))}),(0,a.jsx)("td",{className:"py-3 px-4 text-text-secondary",children:(0,l.xG)(e.costTotal)})]},e.agentName))})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(S.Z,{className:"w-16 h-16 text-neutral-600 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-2",children:"No Performance Data"}),(0,a.jsx)("p",{className:"text-text-secondary mb-1",children:"No agent performance data available for the selected period"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"Data will appear after your agents make calls"})]})]}),(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"card",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,a.jsx)("h2",{className:"text-lg font-bold text-text-primary",children:"Usage & Consumption"})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-500 mb-2",children:(null==o?void 0:o.minutes_used)||0}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Minutes Used"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-500 mb-2",children:(null==h?void 0:h.minutesRemaining)||0}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Minutes Remaining"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-yellow-500 mb-2",children:(0,l.xG)((null==h?void 0:h.costTotal)||0)}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Total Cost"})]})]}),o&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-text-secondary",children:"Usage Progress"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-text-primary",children:[(null==o?void 0:o.minutes_included)?Math.round((o.minutes_used||0)/o.minutes_included*100):0,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-neutral-700 rounded-full h-3",children:(0,a.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat(o&&o.minutes_used/o.minutes_included>.8?"bg-red-500":o&&o.minutes_used/o.minutes_included>.6?"bg-yellow-500":"bg-green-500"),style:{width:(null==o?void 0:o.minutes_included)?"".concat(Math.min((o.minutes_used||0)/o.minutes_included*100,100),"%"):"0%"}})})]})]})]})}function eU(e){let{stats:t,loading:s=!1,className:i=""}=e;if(s)return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 ".concat(i),children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"card p-6 animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-xl"}),(0,a.jsxs)("div",{className:"ml-4 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-20"}),(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-16"})]})]})},t))});let r=[{title:"Total Calls",value:t.total_calls,icon:p.Z,color:"indigo",bgColor:"bg-indigo-100",iconColor:"text-indigo-600"},{title:"Success Rate",value:"".concat(Math.round(t.success_rate),"%"),icon:e_.Z,color:"green",bgColor:"bg-green-100",iconColor:"text-green-600"},{title:"Total Minutes",value:t.total_minutes,icon:q.Z,color:"yellow",bgColor:"bg-yellow-100",iconColor:"text-yellow-600"},{title:"Total Cost",value:(0,l.xG)(t.total_cost),icon:eD.Z,color:"red",bgColor:"bg-red-100",iconColor:"text-red-600"}];return void 0!==t.total_contacts&&r.splice(3,0,{title:"Total Contacts",value:t.total_contacts,icon:k.Z,color:"purple",bgColor:"bg-purple-100",iconColor:"text-purple-600"}),void 0!==t.active_agents&&r.splice(4,0,{title:"Active Agents",value:t.active_agents,icon:_.Z,color:"blue",bgColor:"bg-blue-100",iconColor:"text-blue-600"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-".concat(Math.min(r.length,4)," gap-6 ").concat(i),children:r.map((e,t)=>{let s=e.icon;return(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"card p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 ".concat(e.bgColor," rounded-xl flex items-center justify-center"),children:(0,a.jsx)(s,{className:"w-6 h-6 ".concat(e.iconColor)})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-text-secondary",children:e.title}),(0,a.jsx)("p",{className:"text-2xl font-bold text-text-primary",children:e.value})]})]})},e.title)})})}function eq(e){let{onNavigate:t}=e,[s,i]=(0,r.useState)([]),[c,o]=(0,r.useState)(!0),[d,m]=(0,r.useState)(""),[u,h]=(0,r.useState)({total_calls:0,successful_calls:0,total_minutes:0,total_cost:0,success_rate:0});(0,r.useEffect)(()=>{g()},[]);let g=async()=>{try{o(!0);let{data:e,error:t}=await l.OQ.from("calls").select("\n          *,\n          agents!inner(id, name, phone_number),\n          contacts(id, first_name, last_name, phone_number),\n          call_transcripts(full_transcript, messages)\n        ").order("started_at",{ascending:!1}).limit(100);if(t){console.error("Error fetching calls:",t),x.ZP.error("Failed to load call history");return}let s=(e||[]).map(e=>{var t,s,a;return{id:e.id,vapi_call_id:e.vapi_call_id,direction:e.direction,outcome:e.outcome,duration_seconds:e.duration_seconds,started_at:e.started_at,ended_at:e.ended_at,cost_usd:e.cost_usd,summary:e.summary,recording_url:e.recording_url,agent_name:(null===(t=e.agents)||void 0===t?void 0:t.name)||"Unknown Agent",contact_name:e.contacts&&"".concat(e.contacts.first_name||""," ").concat(e.contacts.last_name||"").trim()||"Unknown Contact",contact_phone:null===(s=e.contacts)||void 0===s?void 0:s.phone_number,from_number:e.from_number,to_number:e.to_number,created_at:e.created_at,transcript:(null===(a=e.call_transcripts)||void 0===a?void 0:a[0])?{full_transcript:e.call_transcripts[0].full_transcript,messages:e.call_transcripts[0].messages}:void 0}});if(i(s),s.length>0){let e=s.length,t=s.filter(e=>"success"===e.outcome).length,a=s.reduce((e,t)=>e+Math.ceil(t.duration_seconds/60),0),i=s.reduce((e,t)=>e+(t.cost_usd||0),0);h({total_calls:e,successful_calls:t,total_minutes:a,total_cost:i,success_rate:t/e*100})}}catch(e){console.error("Error in fetchCalls:",e),x.ZP.error("Failed to load call history")}finally{o(!1)}},y=s.filter(e=>{var t,s,a;return!d||(null===(t=e.summary)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(s=e.contact_name)||void 0===s?void 0:s.toLowerCase().includes(d.toLowerCase()))||(null===(a=e.agent_name)||void 0===a?void 0:a.toLowerCase().includes(d.toLowerCase()))});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Call History"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"View and analyze all voice agent calls"})]}),(0,a.jsxs)("button",{onClick:g,className:"btn-secondary flex items-center",children:[(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),(0,a.jsx)(eU,{stats:u,loading:c}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card p-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ea.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-tertiary w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by contact, agent, or summary...",value:d,onChange:e=>m(e.target.value),className:"input-field pl-10"})]})}),(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:(0,a.jsx)(ev,{calls:y,loading:c,onRefresh:g,showContact:!0,showAgent:!0,variant:"full"})}),!c&&0===s.length&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12",children:[(0,a.jsx)(p.Z,{className:"mx-auto h-12 w-12 text-text-tertiary mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-2",children:"No calls yet"}),(0,a.jsx)("p",{className:"text-text-secondary mb-6",children:"Your call history will appear here once you start making calls with your voice agents."}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,a.jsx)("button",{onClick:()=>t("agents"),className:"btn-primary",children:"View Agents"}),(0,a.jsx)("button",{onClick:()=>t("contacts"),className:"btn-secondary",children:"Manage Contacts"})]})]})]})}var eJ=s(40875),eK=s(10407),eQ=s(29525),eB=s(50091);function eG(e){let{organizationId:t,agentId:s}=e,[i,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)({}),[d,m]=(0,r.useState)("crm_lookup"),[x,u]=(0,r.useState)({crm_lookup:{lookup_type:"contact",search_value:"+1234567890"},check_availability:{date_range:"next week",duration:60,meeting_type:"demo"},search_knowledge_base:{query:"pricing information",category:"pricing"}}),h=[{name:"crm_lookup",title:"CRM Lookup",description:"Search contacts, companies, and call history",icon:eB.Z,color:"blue"},{name:"check_availability",title:"Check Availability",description:"Calendar integration for scheduling",icon:ei.Z,color:"green"},{name:"search_knowledge_base",title:"Knowledge Search",description:"Search knowledge base by category",icon:ea.Z,color:"purple"}],p=async e=>{if(!s){alert("Please select an agent first");return}l(!0);try{let a=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/execute-agent-tool",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify({toolName:e,parameters:x[e],organizationId:t,agentId:s})}),i=await a.json();o(t=>({...t,[e]:i}))}catch(t){console.error("Tool test error:",t),o(s=>({...s,[e]:{success:!1,error:t instanceof Error?t.message:String(t)}}))}finally{l(!1)}},g=async()=>{if(!s){alert("Please select an agent first");return}for(let e of(l(!0),o({}),h))await p(e.name),await new Promise(e=>setTimeout(e,500));l(!1)},y=(e,t,s)=>{u(a=>({...a,[e]:{...a[e],[t]:s}}))};return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(eQ.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Tool Integration System Test"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Test voice agent tools for real-time data retrieval"})]})]}),(0,a.jsx)("button",{onClick:g,disabled:i||!s,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(X.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Testing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eQ.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Test All Tools"})]})})]}),!s&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,a.jsx)("p",{className:"text-yellow-800 text-sm",children:"⚠️ Please add an agent first to test the tool integration system."})}),(0,a.jsx)("div",{className:"grid md:grid-cols-3 gap-6",children:h.map(e=>{let t=c[e.name],r=e.icon;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(r,{className:"w-5 h-5 text-".concat(e.color,"-600")}),(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.title})]}),t&&(0,a.jsx)("div",{className:"flex items-center",children:t.success?(0,a.jsx)(j.Z,{className:"w-4 h-4 text-green-600"}):(0,a.jsx)(ee.Z,{className:"w-4 h-4 text-red-600"})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,a.jsx)("div",{className:"space-y-2 mb-4",children:Object.entries(x[e.name]||{}).map(t=>{let[s,r]=t;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:[s.replace("_"," "),":"]}),(0,a.jsx)("input",{type:"text",value:r,onChange:t=>y(e.name,s,t.target.value),className:"w-full px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",disabled:i})]},s)})}),(0,a.jsxs)("button",{onClick:()=>p(e.name),disabled:i||!s,className:"w-full px-3 py-2 bg-".concat(e.color,"-600 text-white text-sm rounded hover:bg-").concat(e.color,"-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"),children:[i?(0,a.jsx)(X.Z,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(r,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Test Tool"})]}),t&&(0,a.jsx)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-3 pt-3 border-t border-gray-200",children:t.success?(0,a.jsxs)("div",{className:"text-xs text-green-800 bg-green-50 p-2 rounded",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"✅ Success"}),t.executionTimeMs&&(0,a.jsxs)("div",{className:"text-green-600 mb-1",children:["⏱️ ",t.executionTimeMs,"ms"]}),(0,a.jsx)("div",{className:"break-words",children:t.result&&t.result.length>100?"".concat(t.result.substring(0,100),"..."):t.result})]}):(0,a.jsxs)("div",{className:"text-xs text-red-800 bg-red-50 p-2 rounded",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"❌ Error"}),(0,a.jsx)("div",{className:"break-words",children:t.error})]})})]},e.name)})}),(0,a.jsxs)("div",{className:"mt-6 text-xs text-gray-500 bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-700 mb-2",children:"\uD83D\uDCA1 How Tool Integration Works:"}),(0,a.jsxs)("ul",{className:"space-y-1",children:[(0,a.jsx)("li",{children:"• Voice agents can call these tools during conversations"}),(0,a.jsx)("li",{children:"• Tools provide real-time data from your CRM, calendar, and knowledge base"}),(0,a.jsx)("li",{children:"• VAPI automatically determines when to use tools based on conversation context"}),(0,a.jsx)("li",{children:"• All tool executions are logged for monitoring and debugging"})]})]})]})}function eV(e){let{organizationId:t}=e,[s,i]=(0,r.useState)(null),[l,c]=(0,r.useState)({}),[o,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!0),u=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(e),d(!0);try{console.log("\uD83E\uDDEA Testing Kai execution: ".concat(e),{organizationId:t,dryRun:m,...s});let a="",i={organizationId:t,dryRun:m,...s};switch(e){case"analyze_organization":a="kai-controller",i.action="analyze_organization";break;case"execute_strategy":a="kai-controller",i.action="execute_strategy";break;case"process_queue":a="kai-controller",i.action="process_outbound_queue";break;case"get_insights":a="kai-controller",i.action="get_insights",i.dryRun=!1;break;case"cron_full":a="kai-cron",i={mode:"full",dryRun:m,organizationId:t};break;case"cron_analysis":a="kai-cron",i={mode:"analysis",dryRun:m,organizationId:t};break;default:throw Error("Unknown test action")}let r=await fetch("https://ixeqedgrusamxwsvwoho.supabase.co/functions/v1/".concat(a),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc")},body:JSON.stringify(i)}),n=await r.json();c(t=>({...t,[e]:n})),n.success?console.log("✅ ".concat(e," test successful!"),n):console.error("❌ ".concat(e," test failed:"),n.error)}catch(t){console.error("❌ ".concat(e," test error:"),t),c(s=>({...s,[e]:{success:!1,error:t instanceof Error?t.message:String(t)}}))}finally{d(!1),i(null)}},h=[{key:"analyze_organization",label:"Analyze Organization",description:"Run full organizational analysis and strategy execution",icon:S.Z,color:"purple"},{key:"process_queue",label:"Process Queue",description:"Process ready outbound calls from the queue",icon:eu.Z,color:"blue"},{key:"get_insights",label:"Get Insights",description:"Retrieve Kai's latest insights and recommendations",icon:P.Z,color:"green"},{key:"cron_analysis",label:"Cron Analysis",description:"Test the cron job in analysis mode",icon:q.Z,color:"orange"},{key:"cron_full",label:"Cron Full Execution",description:"Test the complete cron job execution",icon:ek.Z,color:"red"}],p=e=>({purple:"bg-purple-600 hover:bg-purple-700",blue:"bg-blue-600 hover:bg-blue-700",green:"bg-green-600 hover:bg-green-700",orange:"bg-orange-600 hover:bg-orange-700",red:"bg-red-600 hover:bg-red-700"})[e]||"bg-gray-600 hover:bg-gray-700",g=(e,t)=>t?(0,a.jsx)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-4 p-4 border rounded-lg",children:t.success?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,a.jsx)(j.Z,{className:"w-5 h-5 mr-2"}),(0,a.jsx)("span",{className:"font-medium",children:"✅ Test Successful"}),t.executionDuration&&(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",t.executionDuration,")"]})]}),t.results&&(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-sm",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Execution Results:"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[void 0!==t.results.strategiesAnalyzed&&(0,a.jsxs)("div",{children:["Strategies: ",t.results.strategiesAnalyzed]}),void 0!==t.results.contactsAnalyzed&&(0,a.jsxs)("div",{children:["Contacts: ",t.results.contactsAnalyzed]}),void 0!==t.results.outboundOpportunitiesFound&&(0,a.jsxs)("div",{children:["Opportunities: ",t.results.outboundOpportunitiesFound]}),void 0!==t.results.callsQueued&&(0,a.jsxs)("div",{children:["Calls Queued: ",t.results.callsQueued]}),void 0!==t.results.callsInitiated&&(0,a.jsxs)("div",{children:["Calls Initiated: ",t.results.callsInitiated]}),void 0!==t.results.callsFailed&&(0,a.jsxs)("div",{children:["Calls Failed: ",t.results.callsFailed]})]}),t.results.insights&&t.results.insights.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("h5",{className:"font-medium",children:"Insights Generated:"}),(0,a.jsx)("ul",{className:"list-disc list-inside ml-2 text-xs",children:t.results.insights.map((e,t)=>(0,a.jsx)("li",{children:e.insight||e.type},t))})]}),t.results.queuedCalls&&t.results.queuedCalls.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("h5",{className:"font-medium",children:"Queued Calls:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside ml-2 text-xs",children:[t.results.queuedCalls.slice(0,3).map((e,t)=>(0,a.jsxs)("li",{children:[e.contactName," - ",e.action," (Priority: ",e.priority,")"]},t)),t.results.queuedCalls.length>3&&(0,a.jsxs)("li",{children:["... and ",t.results.queuedCalls.length-3," more"]})]})]})]}),t.summary&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded text-sm",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Cron Execution Summary:"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{children:["Organizations: ",t.summary.organizationsProcessed]}),(0,a.jsxs)("div",{children:["Success Rate: ",t.summary.successRate,"%"]}),(0,a.jsxs)("div",{children:["Strategies: ",t.summary.totalStrategiesExecuted]}),(0,a.jsxs)("div",{children:["Calls Queued: ",t.summary.totalCallsQueued]}),(0,a.jsxs)("div",{children:["Insights: ",t.summary.totalInsightsGenerated]}),(0,a.jsxs)("div",{children:["Errors: ",t.summary.errorsCount]})]})]}),t.insights&&(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded text-sm",children:[(0,a.jsxs)("h4",{className:"font-medium mb-2",children:["Kai Insights (",t.insights.length,"):"]}),t.insights.length>0?(0,a.jsx)("ul",{className:"space-y-1",children:t.insights.slice(0,3).map((e,t)=>(0,a.jsxs)("li",{className:"text-xs",children:[(0,a.jsxs)("strong",{children:[e.insight_type,":"]})," ",e.insight_data.insight,(0,a.jsxs)("span",{className:"text-gray-500",children:[" (Confidence: ",Math.round(100*e.confidence_score),"%)"]})]},t))}):(0,a.jsx)("p",{className:"text-gray-500",children:"No insights available yet"})]})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,a.jsx)(F.Z,{className:"w-5 h-5 mr-2"}),(0,a.jsx)("span",{className:"font-medium",children:"❌ Test Failed"})]}),(0,a.jsx)("div",{className:"text-red-700 text-sm bg-red-50 p-2 rounded",children:t.error})]})}):null;return(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Kai Execution Engine Test"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Test the autonomous execution capabilities of Controller Agent “Kai” including strategy analysis, contact prioritization, and outbound call queueing."}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsx)("input",{type:"checkbox",id:"dryRun",checked:m,onChange:e=>x(e.target.checked),className:"rounded"}),(0,a.jsx)("label",{htmlFor:"dryRun",className:"text-sm font-medium text-yellow-800",children:"Dry Run Mode (recommended for testing)"}),(0,a.jsx)("div",{className:"text-xs text-yellow-700",children:m?"No actual calls will be made":"⚠️ Will make real outbound calls!"})]}),(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:h.map(e=>{let t=e.icon,i=s===e.key,r=l[e.key];return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>u(e.key),disabled:o,className:"w-full p-4 rounded-lg text-white font-medium transition-colors flex items-center ".concat(i?"opacity-75":""," ").concat(p(e.color)," disabled:opacity-50"),children:[i?(0,a.jsx)(X.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(t,{className:"w-4 h-4 mr-2"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-xs opacity-90",children:e.description})]})]}),r&&g(e.key,l[e.key])]},e.key)})}),Object.keys(l).length>0&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Test Summary"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:Object.values(l).filter(e=>e.success).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Passed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:Object.values(l).filter(e=>!e.success).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Failed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:Object.keys(l).length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total"})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-800",children:"Kai Execution Engine Features"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[(0,a.jsx)("div",{children:"• **Strategy Analysis**: Analyzes contact database and identifies outbound opportunities"}),(0,a.jsx)("div",{children:"• **Smart Queueing**: Automatically queues calls with optimal timing and context"}),(0,a.jsx)("div",{children:"• **Queue Processing**: Executes queued calls using your existing agents"}),(0,a.jsx)("div",{children:"• **Insights Generation**: Provides actionable recommendations for improvement"}),(0,a.jsx)("div",{children:"• **Cron Automation**: Can run autonomously on a schedule"})]}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-blue-700",children:[(0,a.jsx)("strong",{children:"Test with existing strategies:"})," Create strategies through Kai chat first, then test execution"]})]})]})}function eX(e){var t,s,l,c,o,d,m,x,u,h;let{onNavigate:p}=e,{state:g}=(0,i.q)(),[y,j]=(0,r.useState)(null),b=e=>{j(y===e?null:e)},N=(null===(t=g.profile)||void 0===t?void 0:t.role)==="admin"||(null===(l=g.user)||void 0===l?void 0:null===(s=l.email)||void 0===s?void 0:s.includes("@gritsa.com"));return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-text-primary",children:"Settings"}),(0,a.jsx)("p",{className:"text-text-secondary mt-1",children:"Manage your account preferences and platform configurations"})]})}),(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,a.jsx)(ek.Z,{className:"w-6 h-6 text-primary-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:"Account Settings"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:[(0,a.jsx)(k.Z,{className:"w-5 h-5 text-primary-600 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-1",children:"Profile"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Update your personal information"}),(0,a.jsx)("div",{className:"mt-2 text-xs text-text-tertiary",children:null===(c=g.user)||void 0===c?void 0:c.email})]}),(0,a.jsxs)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:[(0,a.jsx)(eD.Z,{className:"w-5 h-5 text-success-500 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-1",children:"Billing"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Manage subscription and usage"}),(0,a.jsx)("div",{className:"mt-2 text-xs text-success-600",children:(null===(o=g.subscription)||void 0===o?void 0:o.plan_type)||"Trial"})]}),(0,a.jsxs)("div",{className:"bg-bg-secondary p-4 rounded-lg",children:[(0,a.jsx)(_.Z,{className:"w-5 h-5 text-blue-600 mb-2"}),(0,a.jsx)("h4",{className:"font-medium text-text-primary mb-1",children:"Integrations"}),(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:"Configure external services"}),(0,a.jsx)("div",{className:"mt-2 text-xs text-blue-600",children:"VAPI • Twilio"})]})]})]}),N&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,a.jsx)(Q.Z,{className:"w-6 h-6 text-purple-600"}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:"Testing & Development"}),(0,a.jsx)("div",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full",children:"ADMIN"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>b("kai"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Controller Agent “Kai” Test"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Test the AI chat interface for strategy creation"})]})]}),"kai"===y?(0,a.jsx)(eJ.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(eK.Z,{className:"w-5 h-5 text-gray-400"})]}),"kai"===y&&(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsx)(H,{organizationId:(null===(d=g.organization)||void 0===d?void 0:d.id)||"",userId:(null===(m=g.user)||void 0===m?void 0:m.id)||""})})]}),(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>b("context"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(B.Z,{className:"w-6 h-6 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Call Context System Test"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Test rich context generation for voice calls"})]})]}),"context"===y?(0,a.jsx)(eJ.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(eK.Z,{className:"w-5 h-5 text-gray-400"})]}),"context"===y&&(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsx)(V,{organizationId:(null===(x=g.organization)||void 0===x?void 0:x.id)||""})})]}),(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>b("tools"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(eQ.Z,{className:"w-6 h-6 text-green-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Tool Integration Test"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Test dynamic tool integration for voice agents"})]})]}),"tools"===y?(0,a.jsx)(eJ.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(eK.Z,{className:"w-5 h-5 text-gray-400"})]}),"tools"===y&&(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsx)(eG,{organizationId:(null===(u=g.organization)||void 0===u?void 0:u.id)||""})})]}),(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg",children:[(0,a.jsxs)("button",{onClick:()=>b("execution"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(E.Z,{className:"w-6 h-6 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:"Kai Execution Engine Test"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Test autonomous strategy execution and call queueing"})]})]}),"execution"===y?(0,a.jsx)(eJ.Z,{className:"w-5 h-5 text-gray-400"}):(0,a.jsx)(eK.Z,{className:"w-5 h-5 text-gray-400"})]}),"execution"===y&&(0,a.jsx)("div",{className:"border-t border-gray-200 p-4",children:(0,a.jsx)(eV,{organizationId:(null===(h=g.organization)||void 0===h?void 0:h.id)||""})})]})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"\uD83D\uDE80 Quick Access to Controller Agent “Kai”"}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"The Controller Agent “Kai” chat interface is available in the first test section above. Use it to create outbound communication strategies through natural conversation."})]})]}),g.organization&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-text-primary mb-4",children:"Organization"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization Name"}),(0,a.jsx)("div",{className:"text-text-primary",children:g.organization.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Industry"}),(0,a.jsx)("div",{className:"text-text-primary",children:g.organization.industry||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Website"}),(0,a.jsx)("div",{className:"text-text-primary",children:g.organization.website||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Default Country Code"}),(0,a.jsx)("div",{className:"text-text-primary",children:g.organization.default_country_code})]})]})]})]})]})}var eW=s(99637),eY=s(98617),eH=s(58293);function e$(e){let{currentView:t,onNavigate:s}=e,[l,c]=(0,r.useState)(!1),{state:o,actions:d}=(0,i.q)(),{user:m,profile:x,organization:u,subscription:h}=o,g=[{id:"dashboard",label:"Dashboard",icon:eW.Z,view:"dashboard"},{id:"agents",label:"Voice Agents",icon:_.Z,view:"agents"},{id:"contacts",label:"CRM",icon:k.Z,view:"contacts"},{id:"calls",label:"Call History",icon:p.Z,view:"calls"},{id:"reports",label:"Reports",icon:S.Z,view:"reports"},{id:"settings",label:"Settings",icon:ek.Z,view:"settings"}],y=async()=>{await d.logout(),c(!1),s("auth")},j=()=>{var e,i;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-bg-secondary border-r border-bg-tertiary",children:[(0,a.jsx)("div",{className:"p-6 border-b border-bg-tertiary",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-xl flex items-center justify-center shadow-primary",children:(0,a.jsx)(Z.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg text-text-primary",children:"Kai"}),(0,a.jsx)("p",{className:"text-sm text-text-tertiary",children:"AI Voice Platform"})]})]}),(0,a.jsx)("button",{onClick:()=>c(!1),className:"md:hidden p-2 rounded-lg hover:bg-bg-tertiary",children:(0,a.jsx)(em.Z,{className:"w-5 h-5 text-text-tertiary"})})]})}),(0,a.jsx)("nav",{className:"flex-1 p-4 space-y-2",children:g.map(e=>{let i=t===e.view,r=e.icon;return(0,a.jsxs)("button",{onClick:()=>{s(e.view),c(!1)},className:"w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-left transition-all duration-200 nav-item ".concat(i?"bg-bg-tertiary text-text-primary border border-primary-solid shadow-primary":"text-text-secondary hover:bg-bg-tertiary hover:text-text-primary"),disabled:!1,children:[(0,a.jsx)(r,{className:"w-5 h-5 ".concat(i?"text-primary-solid":"text-text-tertiary")}),(0,a.jsx)("span",{className:"flex-1",children:e.label})]},e.id)})}),h&&(0,a.jsx)("div",{className:"p-4 border-t border-bg-tertiary",children:(0,a.jsxs)("div",{className:"bg-bg-tertiary rounded-xl p-4 border border-bg-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)(eY.Z,{className:"w-4 h-4 text-accent-warning"}),(0,a.jsxs)("span",{className:"text-sm text-text-primary capitalize",children:[h.status," Plan"]})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-text-secondary",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Minutes Used:"}),(0,a.jsxs)("span",{className:"font-medium",children:[h.minutes_used," / ",h.minutes_included]})]}),"trial"===h.status&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Trial Ends:"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(h.trial_end_date).toLocaleDateString()})]})]}),"trial"===h.status&&(0,a.jsx)("button",{onClick:()=>console.log("Upgrade feature coming soon..."),className:"btn-primary w-full mt-2 text-xs",children:"Upgrade Plan"})]})}),(0,a.jsxs)("div",{className:"p-4 border-t border-bg-tertiary",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-primary rounded-xl flex items-center justify-center shadow-primary",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-white",children:[null==x?void 0:null===(e=x.first_name)||void 0===e?void 0:e[0],null==x?void 0:null===(i=x.last_name)||void 0===i?void 0:i[0]]})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("p",{className:"text-sm text-text-primary truncate",children:[null==x?void 0:x.first_name," ",null==x?void 0:x.last_name]}),(0,a.jsx)("p",{className:"text-xs text-text-tertiary truncate",children:null==u?void 0:u.name})]})]}),(0,a.jsxs)("button",{onClick:y,className:"w-full flex items-center space-x-2 px-3 py-2 text-sm text-text-secondary hover:text-text-primary hover:bg-bg-tertiary rounded-lg transition-colors",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Sign Out"})]})]})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>c(!0),className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-bg-secondary rounded-lg shadow-primary border border-bg-tertiary",children:(0,a.jsx)(eH.Z,{className:"w-6 h-6 text-text-secondary"})}),(0,a.jsx)("div",{className:"hidden md:flex w-80 h-screen fixed left-0 top-0 z-40",children:(0,a.jsx)(j,{})}),(0,a.jsx)(T.M,{children:l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>c(!1)}),(0,a.jsx)(n.E.div,{initial:{x:-320},animate:{x:0},exit:{x:-320},transition:{type:"spring",damping:25,stiffness:200},className:"md:hidden fixed left-0 top-0 w-80 h-screen z-50",children:(0,a.jsx)(j,{})})]})})]})}var e0=s(40257);let e1={"/":"dashboard","/auth":"auth","/welcome":"welcome","/setup":"setup","/dashboard":"dashboard","/contacts":"contacts","/agents":"agents","/reports":"reports","/calls":"calls","/settings":"settings"},e2={auth:"/auth",welcome:"/welcome",setup:"/setup",dashboard:"/dashboard",contacts:"/contacts",agents:"/agents",reports:"/reports",calls:"/calls",settings:"/settings"};function e4(){var e;let{state:t,actions:s}=(0,i.q)(),{currentPath:c,navigate:o,replace:d}=function(){let[e,t]=(0,r.useState)("");return(0,r.useEffect)(()=>{let e=()=>{let e=window.location.pathname,t=e0.env.NEXT_PUBLIC_BASE_PATH||"";return e.replace(t,"")||"/"},s=sessionStorage.getItem("redirect-path");if(s){console.log("\uD83D\uDD04 Handling 404 redirect to:",s),sessionStorage.removeItem("redirect-path");let e="/"+s.split("?")[0].split("#")[0];t(e);let a=e0.env.NEXT_PUBLIC_BASE_PATH||"";window.history.replaceState({},"",a+e)}else t(e());let a=()=>{t(e())};return window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)},[]),{currentPath:e,navigate:e=>{let s=e0.env.NEXT_PUBLIC_BASE_PATH||"";window.history.pushState({},"",s+e),t(e),document.title=({"/auth":"Sign In - Kai Agent","/welcome":"Welcome - Kai Agent","/setup":"Agent Setup - Kai Agent","/dashboard":"Dashboard - Kai Agent","/contacts":"CRM - Kai Agent","/agents":"Voice Agents - Kai Agent","/reports":"Reports - Kai Agent","/calls":"Call History - Kai Agent","/settings":"Settings - Kai Agent"})[e]||"Kai Agent"},replace:e=>{let s=e0.env.NEXT_PUBLIC_BASE_PATH||"";window.history.replaceState({},"",s+e),t(e)}}}(),m=e=>e1[e]||"auth",[x,u]=(0,r.useState)(()=>m(c)),[h,p]=(0,r.useState)(!1),g=(0,r.useRef)(!1),y=(0,r.useCallback)(async()=>{var e;if(!g.current&&(null===(e=t.user)||void 0===e?void 0:e.id)){g.current=!0,console.log("\uD83D\uDD27 Auto-fixing onboarding status...");try{await l.OQ.from("user_profiles").update({onboarding_completed:!0}).eq("id",t.user.id),console.log("\uD83D\uDD04 Refreshing profile data after auto-fix..."),await s.fetchUserData()}catch(e){console.error("Auto-fix failed:",e),g.current=!1}}},[null===(e=t.user)||void 0===e?void 0:e.id]),j=(0,r.useCallback)(e=>{console.log("\uD83E\uDDED Navigating to:",e);let t=e2[e];p(!0),o(t),u(e),setTimeout(()=>p(!1),100)},[o]);return((0,r.useEffect)(()=>{if(!t.initialized||h)return;let e=m(c);e!==x&&(console.log("\uD83C\uDF10 URL changed, updating view:",c,"->",e),u(e))},[c,t.initialized,h,x]),(0,r.useEffect)(()=>{var e;if(!t.initialized||h)return;console.log("\uD83E\uDDED Determining view:",{currentUrl:c,hasUser:!!t.user,hasProfile:!!t.profile,hasOrg:!!t.organization,agentsCount:t.agents.length,onboardingComplete:null===(e=t.profile)||void 0===e?void 0:e.onboarding_completed,isLoading:t.loading});let s=m(c),a=s;if(t.user){if(t.profile&&t.organization){if(t.profile.onboarding_completed)0===t.agents.length?"setup"!==s&&(console.log("\uD83E\uDD16 No agents, redirecting to setup"),a="setup"):("auth"===s||"welcome"===s)&&(console.log("\uD83D\uDCCA User setup complete, redirecting to dashboard"),a="dashboard");else{if(t.agents.length>0){y();return}"welcome"!==s&&"setup"!==s&&(console.log("\uD83E\uDD16 Onboarding incomplete, redirecting to setup"),a="setup")}}else"welcome"!==s&&(console.log("\uD83D\uDC4B No profile/org, redirecting to welcome"),a="welcome")}else"auth"!==s&&(console.log("\uD83D\uDD10 User not authenticated, redirecting to auth"),a="auth");a!==s?(console.log("\uD83C\uDFAF Redirecting from",s,"to",a),d(e2[a]),u(a)):a!==x&&(console.log("\uD83C\uDFAF Setting view to:",a),u(a))},[t.initialized,t.user,t.profile,t.organization,t.agents.length,t.loading,c,x,h,d,y]),t.initialized)?t.loading?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-6"}),(0,a.jsx)("h2",{className:"text-xl text-text-primary mb-3",children:"Loading Kai"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Loading your data..."})]})}):(()=>{switch(x){case"auth":return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,a.jsx)(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:(0,a.jsx)(C,{onAuthSuccess:()=>{console.log("\uD83C\uDFAF Auth success - fetchUserData will be triggered by auth state change")}})})});case"welcome":return(0,a.jsx)(I,{onGetStarted:()=>j("setup")});case"setup":return(0,a.jsx)(R,{onComplete:async()=>{await s.fetchUserData(),j("dashboard")},onBack:()=>j("welcome")});default:return(0,a.jsxs)("div",{className:"page-container",children:[(0,a.jsx)(e$,{currentView:x,onNavigate:j}),(0,a.jsx)("div",{className:"md:ml-80",children:(0,a.jsxs)("main",{className:"p-4 md:p-8",children:["dashboard"===x&&(0,a.jsx)($,{onNavigate:j}),"contacts"===x&&(0,a.jsx)(ew,{onNavigate:j}),"agents"===x&&(0,a.jsx)(eS,{onNavigate:j}),"reports"===x&&(0,a.jsx)(eR,{onNavigate:j}),"calls"===x&&(0,a.jsx)(eq,{onNavigate:j}),"settings"===x&&(0,a.jsx)(eX,{onNavigate:j})]})})]})}})():(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsxs)(n.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[(0,a.jsx)("div",{className:"loading-spinner mx-auto mb-6"}),(0,a.jsx)("h2",{className:"text-xl text-text-primary mb-3",children:"Loading Kai"}),(0,a.jsx)("p",{className:"text-text-secondary",children:"Initializing your AI voice platform..."})]})})}},5526:function(e,t,s){"use strict";s.d(t,{LU:function(){return c},OQ:function(){return r},k_:function(){return n},lj:function(){return d},un:function(){return l},xG:function(){return o}});var a=s(57557);let i="https://ixeqedgrusamxwsvwoho.supabase.co",r=(0,a.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),n=async function(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=null===(t=(await r.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,n={headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)}}},l=await fetch("".concat(i,"/functions/v1/").concat(e),{...n,...s,headers:{...n.headers,...s.headers}});if(!l.ok)throw Error(await l.text());return l.json()},l=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},c=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),d=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,s){"use strict";s.d(t,{q:function(){return o},w:function(){return d}});var a=s(14623),i=s(2265),r=s(5526);let n={user:null,profile:null,organization:null,subscription:null,agents:[],contacts:[],loading:!1,initialized:!1,error:null};function l(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,error:null};case"RESET_STATE":return{...n,initialized:!0};case"UPDATE_AGENTS":return{...e,agents:t.agents};case"UPDATE_CONTACTS":return{...e,contacts:t.contacts};case"SET_ERROR":return{...e,error:t.error,loading:!1};default:return e}}let c=(0,i.createContext)(void 0);function o(){let e=(0,i.useContext)(c);if(!e)throw Error("useApp must be used within AppProvider");return e}function d(e){let{children:t}=e,[s,o]=(0,i.useReducer)(l,n),d=(0,i.useRef)(null),m=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d.current)return console.log("\uD83D\uDD04 fetchUserData already in progress, waiting..."),d.current;let t=(async()=>{try{e||o({type:"SET_LOADING",loading:!0}),console.log("\uD83D\uDD04 Starting fetchUserData...",{skipLoading:e}),e&&await new Promise(e=>setTimeout(e,500));let{data:{user:t},error:s}=await r.OQ.auth.getUser();if(s||!t){console.log("\uD83D\uDC64 No user found:",(null==s?void 0:s.message)||"No user"),o({type:"RESET_STATE"});return}console.log("\uD83D\uDC64 User found, fetching profile...",t.id);let{data:a,error:i}=await r.OQ.from("user_profiles").select("*").eq("id",t.id).single();if(i||!a){console.log("⚠️ No profile found:",(null==i?void 0:i.message)||"No profile data"),o({type:"AUTH_SUCCESS",payload:{user:t}});return}console.log("\uD83D\uDC64 Profile found:",a.first_name,a.last_name);let n=null,l=null,c=[];if(null==a?void 0:a.organization_id){console.log("\uD83C\uDFE2 Fetching organization data...");let[e,t,s]=await Promise.allSettled([r.OQ.from("organizations").select("*").eq("id",a.organization_id).single(),r.OQ.from("subscriptions").select("*").eq("organization_id",a.organization_id).single(),r.OQ.from("agents").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1})]);n="fulfilled"===e.status?e.value.data:null,l="fulfilled"===t.status?t.value.data:null,c="fulfilled"===s.status&&s.value.data||[],console.log("✅ Organization data fetched:",{organization:!!n,subscription:!!l,agentsCount:c.length})}o({type:"AUTH_SUCCESS",payload:{user:t,profile:a,organization:n,subscription:l,agents:c}}),console.log("✅ fetchUserData completed successfully")}catch(e){var t,s;console.error("❌ Error fetching user data:",e),(null==e?void 0:null===(t=e.message)||void 0===t?void 0:t.includes("auth"))||(null==e?void 0:null===(s=e.message)||void 0===s?void 0:s.includes("JWT"))?(console.log("\uD83D\uDD10 Auth error detected, resetting state"),o({type:"RESET_STATE"})):o({type:"SET_ERROR",error:"Failed to load user data"})}finally{d.current=null}})();return d.current=t,t},x=async()=>{try{var e;if(!s.user||!(null===(e=s.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch agents: missing user or organization");return}console.log("\uD83E\uDD16 Fetching agents...");let{data:t,error:a}=await r.OQ.from("agents").select("*").eq("organization_id",s.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;o({type:"UPDATE_AGENTS",agents:t||[]}),console.log("✅ Agents fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching agents:",e)}},u=async()=>{try{var e;if(!s.user||!(null===(e=s.profile)||void 0===e?void 0:e.organization_id)){console.log("❌ Cannot fetch contacts: missing user or organization");return}console.log("\uD83D\uDC65 Fetching contacts...");let{data:t,error:a}=await r.OQ.from("contacts").select("*").eq("organization_id",s.profile.organization_id).order("created_at",{ascending:!1});if(a)throw a;o({type:"UPDATE_CONTACTS",contacts:t||[]}),console.log("✅ Contacts fetched:",(null==t?void 0:t.length)||0)}catch(e){console.error("❌ Error fetching contacts:",e)}},h=async()=>{try{console.log("\uD83D\uDEAA Logging out..."),await r.OQ.auth.signOut(),o({type:"RESET_STATE"}),sessionStorage.removeItem("redirect-path"),console.log("✅ Logout complete")}catch(e){console.error("❌ Error during logout:",e)}};return(0,i.useEffect)(()=>{let e=!0;(async()=>{console.log("\uD83D\uDE80 Initializing app..."),console.log("\uD83D\uDD0D Checking for session...");let{data:{session:t}}=await r.OQ.auth.getSession();(null==t?void 0:t.user)?(console.log("✅ Found existing session, fetching user data..."),await m(!0)):(console.log("\uD83D\uDD10 No session found"),o({type:"RESET_STATE"})),e&&o({type:"SET_INITIALIZED",initialized:!0})})();let{data:{subscription:t}}=r.OQ.auth.onAuthStateChange(async(t,s)=>{console.log("\uD83D\uDD10 Auth state change:",{event:t,hasUser:!!(null==s?void 0:s.user)}),e&&("SIGNED_IN"===t&&(null==s?void 0:s.user)?(console.log("\uD83D\uDD04 Auth SIGNED_IN - fetching user data..."),setTimeout(async()=>{e&&await m()},200)):"SIGNED_OUT"===t?(console.log("\uD83D\uDD04 Auth SIGNED_OUT - resetting state"),o({type:"RESET_STATE"})):"INITIAL_SESSION"===t&&console.log("\uD83D\uDD04 Auth event ignored:",t))});return()=>{e=!1,t.unsubscribe()}},[]),(0,i.useEffect)(()=>{if(!s.loading)return;let e=setTimeout(()=>{s.loading&&(console.warn("\uD83D\uDED1 Emergency loader timeout - clearing localStorage and reloading..."),localStorage.clear(),sessionStorage.clear(),window.location.href="/auth")},3e4);return()=>clearTimeout(e)},[s.loading]),(0,a.jsx)(c.Provider,{value:{state:s,dispatch:o,actions:{fetchUserData:m,fetchAgents:x,fetchContacts:u,logout:h}},children:t})}}},function(e){e.O(0,[216,744],function(){return e(e.s=22511)}),_N_E=e.O()}]);