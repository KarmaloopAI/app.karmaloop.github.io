"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[860],{5526:function(e,t,n){n.d(t,{LU:function(){return c},OQ:function(){return o},k_:function(){return a},lj:function(){return l},un:function(){return s},xG:function(){return u}});var r=n(57557);let i="https://ixeqedgrusamxwsvwoho.supabase.co",o=(0,r.eI)(i,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4ZXFlZGdydXNhbXh3c3Z3b2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDUwODcsImV4cCI6MjA2NTMyMTA4N30.tCb8nATBWRQrbhMXKT-omop5ZLNA954ObbGbQcKjxCc"),a=async function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null===(t=(await o.auth.getSession()).data.session)||void 0===t?void 0:t.access_token,a={headers:{"Content-Type":"application/json",...r&&{Authorization:"Bearer ".concat(r)}}},s=await fetch("".concat(i,"/functions/v1/").concat(e),{...a,...n,headers:{...a.headers,...n.headers}});if(!s.ok)throw Error(await s.text());return s.json()},s=e=>{if(e.startsWith("+1")&&12===e.length){let t=e.slice(2);return"(".concat(t.slice(0,3),") ").concat(t.slice(3,6),"-").concat(t.slice(6))}return e},c=e=>"".concat(Math.floor(e/60),":").concat((e%60).toString().padStart(2,"0")),u=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),l=e=>{switch(e){case"success":return"text-white bg-success-600 border border-success-500";case"failure":case"error":return"text-white bg-error-600 border border-error-500";case"no_answer":case"busy":return"text-white bg-warning-600 border border-warning-500";case"voicemail":return"text-white bg-secondary-600 border border-secondary-500";case"in_progress":return"text-white bg-primary-600 border border-primary-500";default:return"text-white bg-neutral-600 border border-neutral-500"}}},43860:function(e,t,n){n.d(t,{q:function(){return l},w:function(){return d}});var r=n(14623),i=n(2265),o=n(5526),a=n(69064);let s={user:null,profile:null,organization:null,subscription:null,loading:!0,initialized:!1,agents:[],contacts:[],selectedAgent:null,isNavigating:!1};function c(e,t){switch(t.type){case"SET_LOADING":return{...e,loading:t.loading};case"SET_INITIALIZED":return{...e,initialized:t.initialized};case"SET_NAVIGATING":return{...e,isNavigating:t.isNavigating};case"SET_USER":return{...e,user:t.user};case"SET_PROFILE":return{...e,profile:t.profile};case"SET_ORGANIZATION":return{...e,organization:t.organization};case"SET_SUBSCRIPTION":return{...e,subscription:t.subscription};case"SET_AGENTS":return{...e,agents:t.agents};case"SET_CONTACTS":return{...e,contacts:t.contacts};case"SET_SELECTED_AGENT":return{...e,selectedAgent:t.agent};case"RESET_STATE":return{...s,initialized:!0,loading:!1};case"AUTH_SUCCESS":return{...e,user:t.payload.user,profile:t.payload.profile||null,organization:t.payload.organization||null,subscription:t.payload.subscription||null,agents:t.payload.agents||[],loading:!1,initialized:!0,isNavigating:!1};default:return e}}let u=(0,i.createContext)(void 0);function l(){let e=(0,i.useContext)(u);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}function d(e){var t;let{children:n}=e,[l,d]=(0,i.useReducer)(c,s),g=(0,i.useRef)(l);g.current=l;let f=(0,i.useRef)(!1),h=(0,i.useRef)(null),p=(0,i.useRef)(!1),D=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(f.current){console.log("\uD83D\uDD04 fetchUserData already in progress, skipping...");return}f.current=!0,h.current&&clearTimeout(h.current),e||(h.current=setTimeout(()=>{console.log("⏰ fetchUserData timeout - forcing loading to false"),d({type:"SET_LOADING",loading:!1}),f.current=!1},1e4));try{console.log("\uD83D\uDD04 Starting fetchUserData...",{skipLoading:e}),e||d({type:"SET_LOADING",loading:!0});let{data:{user:t},error:n}=await o.OQ.auth.getUser();if(n||!t){console.log("\uD83D\uDC64 No user found:",(null==n?void 0:n.message)||"No user"),d({type:"RESET_STATE"});return}console.log("✅ User found:",t.email);let{data:r,error:i}=await o.OQ.from("user_profiles").select("*").eq("id",t.id).single();if(i){console.log("⚠️ No profile found, creating basic session..."),d({type:"AUTH_SUCCESS",payload:{user:t}});return}console.log("✅ Profile found:",r.first_name);let a=null,s=null,c=[];if(null==r?void 0:r.organization_id){console.log("\uD83C\uDFE2 Fetching organization data...");let[e,t,n]=await Promise.allSettled([o.OQ.from("organizations").select("*").eq("id",r.organization_id).single(),o.OQ.from("subscriptions").select("*").eq("organization_id",r.organization_id).single(),o.OQ.from("agents").select("*").eq("organization_id",r.organization_id).order("created_at",{ascending:!1})]);a="fulfilled"===e.status?e.value.data:null,s="fulfilled"===t.status?t.value.data:null,c="fulfilled"===n.status&&n.value.data||[],console.log("✅ Organization data fetched:",{organization:!!a,subscription:!!s,agentsCount:c.length})}d({type:"AUTH_SUCCESS",payload:{user:t,profile:r,organization:a,subscription:s,agents:c}}),console.log("✅ fetchUserData completed successfully")}catch(e){console.error("\uD83D\uDCA5 Error in fetchUserData:",e),d({type:"RESET_STATE"})}finally{f.current=!1,h.current&&(clearTimeout(h.current),h.current=null)}},[]),E=(0,i.useMemo)(()=>({setLoading:e=>d({type:"SET_LOADING",loading:e}),setNavigating:e=>d({type:"SET_NAVIGATING",isNavigating:e}),fetchUserData:()=>D(),fetchAgents:async()=>{try{var e;if(!(null===(e=l.profile)||void 0===e?void 0:e.organization_id))return console.log("⚠️ No organization_id, cannot fetch agents"),[];let{data:t,error:n}=await o.OQ.from("agents").select("*").eq("organization_id",l.profile.organization_id).order("created_at",{ascending:!1});if(n)throw n;return d({type:"SET_AGENTS",agents:t||[]}),t||[]}catch(e){return console.error("\uD83D\uDCF4 Error fetching agents:",e),d({type:"SET_AGENTS",agents:[]}),[]}},fetchContacts:async()=>{try{var e;if(!(null===(e=l.profile)||void 0===e?void 0:e.organization_id))return;let{data:t}=await o.OQ.from("contacts").select("*").eq("organization_id",l.profile.organization_id).order("created_at",{ascending:!1});d({type:"SET_CONTACTS",contacts:t||[]})}catch(e){console.error("Error fetching contacts:",e),d({type:"SET_CONTACTS",contacts:[]})}},logout:async()=>{f.current=!1,h.current&&(clearTimeout(h.current),h.current=null),await o.OQ.auth.signOut(),d({type:"RESET_STATE"})}}),[null===(t=l.profile)||void 0===t?void 0:t.organization_id,D]);return(0,i.useEffect)(()=>{let e=async()=>{try{console.log("\uD83D\uDE80 Initializing app..."),d({type:"SET_LOADING",loading:!0});let e=new URLSearchParams(window.location.search),t="Email confirmed"===e.get("message"),n=e.get("error_description");t?(a.ZP.success("Email verified successfully!"),window.history.replaceState({},document.title,window.location.pathname)):n&&(a.ZP.error("Authentication error: ".concat(n)),window.history.replaceState({},document.title,window.location.pathname)),console.log("\uD83D\uDD0D Checking for session...");let{data:{session:r}}=await o.OQ.auth.getSession();(null==r?void 0:r.user)?(console.log("\uD83D\uDC64 Session found, fetching user data..."),await D()):(console.log("\uD83D\uDD10 No session found"),d({type:"RESET_STATE"})),d({type:"SET_INITIALIZED",initialized:!0})}catch(e){console.error("\uD83D\uDCA5 App initialization error:",e),d({type:"RESET_STATE"})}};l.initialized||e()},[D]),(0,i.useEffect)(()=>{let e=()=>{if(g.current,"visible"===document.visibilityState){console.log("\uD83D\uDC41️ Tab became visible");let e=sessionStorage.getItem("last-user-data-fetch"),t=Date.now()-18e5;!e||parseInt(e)<t?(console.log("\uD83D\uDC41️ It has been a while since last session check"),sessionStorage.setItem("should-check-session","true")):console.log("\uD83D\uDC41️ Recent session check - no action needed")}else console.log("\uD83D\uDC41️ Tab became hidden")};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,i.useEffect)(()=>{let{data:{subscription:e}}=o.OQ.auth.onAuthStateChange(async(e,t)=>{if(p.current){console.log("\uD83D\uDD10 Auth state change ignored - handling tab visibility");return}console.log("\uD83D\uDD10 Auth state change:",{event:e,hasUser:!!(null==t?void 0:t.user)}),"SIGNED_IN"===e&&(null==t?void 0:t.user)?f.current||await D():"SIGNED_OUT"===e&&(f.current=!1,h.current&&(clearTimeout(h.current),h.current=null),d({type:"RESET_STATE"}))});return()=>e.unsubscribe()},[D]),(0,i.useEffect)(()=>()=>{h.current&&clearTimeout(h.current)},[]),(0,r.jsx)(u.Provider,{value:{state:l,dispatch:d,actions:E},children:n})}}}]);